
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	СхемаКомпоновкиДанных.НаборыДанных.НаборДанных.Запрос = ПолучитьТекстЗапроса();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПолучитьТекстЗапроса()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ДокументРаспределения.Организация КАК Организация,
		|	ДокументРаспределения.Подразделение КАК Подразделение,
		|	ДокументРаспределения.Ссылка КАК Документ,
		|	ЗНАЧЕНИЕ(Справочник.ЭтапыПроизводства.ПустаяСсылка) КАК Этап,
		|	ТЧВыпускиБезРаспоряжения.Номенклатура КАК Продукция,
		|	ТЧВыпускиБезРаспоряжения.Характеристика КАК ХарактеристикаПродукции,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) КАК Полуфабрикат,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК ХарактеристикаПолуфабриката,
		|	ДокументРаспределения.Номенклатура КАК Номенклатура,
		|	ДокументРаспределения.Характеристика КАК Характеристика,
		|	ДокументРаспределения.Серия КАК Серия,
		|	0 КАК Произведено,
		|	0 КАК Норматив,
		|	0 КАК Отклонение,
		|	ТЧВыпускиБезРаспоряжения.Количество КАК РаспределеноНаПроизводство,
		|	ДокументРаспределения.Назначение КАК Назначение
		|ИЗ
		|	Документ.РаспределениеПроизводственныхЗатрат КАК ДокументРаспределения
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеПроизводственныхЗатрат.ВыпускиБезРаспоряжения КАК ТЧВыпускиБезРаспоряжения
		|		ПО ДокументРаспределения.Ссылка = ТЧВыпускиБезРаспоряжения.Ссылка
		|ГДЕ
		|	ДокументРаспределения.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДокументРаспределения.Проведен
		|	И ТЧВыпускиБезРаспоряжения.Количество <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗатратыСписанияПоНормативам.Организация,
		|	ЗатратыСписанияПоНормативам.Подразделение,
		|	СписаниеЗатратНаВыпуск.Ссылка,
		|	ЗНАЧЕНИЕ(Справочник.ЭтапыПроизводства.ПустаяСсылка),
		|	СписаниеЗатратНаВыпуск.Номенклатура,
		|	СписаниеЗатратНаВыпуск.Характеристика,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
		|	ЗатратыСписанияПоНормативам.Номенклатура,
		|	ЗатратыСписанияПоНормативам.Характеристика,
		|	ЗатратыСписанияПоНормативам.Серия,
		|	СписаниеЗатратНаВыпуск.Количество,
		|	ЗатратыСписанияПоНормативам.КоличествоРасход,
		|	0,
		|	0,
		|	ЗатратыСписанияПоНормативам.Назначение
		|ИЗ
		|	РегистрНакопления.МатериалыИРаботыВПроизводстве.Обороты(, , Регистратор, ) КАК ЗатратыСписанияПоНормативам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СписаниеЗатратНаВыпуск КАК СписаниеЗатратНаВыпуск
		|		ПО (СписаниеЗатратНаВыпуск.Ссылка = ЗатратыСписанияПоНормативам.Регистратор)
		|ГДЕ
		|	ЗатратыСписанияПоНормативам.Регистратор ССЫЛКА Документ.СписаниеЗатратНаВыпуск
		|
		|";
		
	
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

#КонецЕсли

