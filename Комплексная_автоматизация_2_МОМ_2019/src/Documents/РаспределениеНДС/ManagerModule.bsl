#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Определяет список команд создания на основании.
//
// Параметры:
//   КомандыСозданияНаОсновании - ТаблицаЗначений - Таблица с командами создания на основании. Для изменения.
//       См. описание 1 параметра процедуры СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании().
//   Параметры - Структура - Вспомогательные параметры. Для чтения.
//       См. описание 2 параметра процедуры СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании().
//
Процедура ДобавитьКомандыСозданияНаОсновании(КомандыСозданияНаОсновании, Параметры) Экспорт
	
	БизнесПроцессы.Задание.ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании);
	
КонецПроцедуры

// Добавляет команду создания документа "Распределение НДС".
//
// Параметры:
//   КомандыСозданияНаОсновании - ТаблицаЗначений - Таблица с командами создания на основании. Для изменения.
//       См. описание 1 параметра процедуры СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании().
//
Функция ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании) Экспорт
	Если ПравоДоступа("Добавление", Метаданные.Документы.РаспределениеНДС) Тогда
		КомандаСоздатьНаОсновании = КомандыСозданияНаОсновании.Добавить();
		КомандаСоздатьНаОсновании.Менеджер = Метаданные.Документы.РаспределениеНДС.ПолноеИмя();
		КомандаСоздатьНаОсновании.Представление = ОбщегоНазначенияУТ.ПредставлениеОбъекта(Метаданные.Документы.РаспределениеНДС);
		КомандаСоздатьНаОсновании.РежимЗаписи = "Проводить";
		КомандаСоздатьНаОсновании.ФункциональныеОпции = "ИспользоватьРаздельныйУчетПоНалогообложению,УправлениеПредприятием,КомплекснаяАвтоматизация";
		
		Возврат КомандаСоздатьНаОсновании;
	КонецЕсли;

	Возврат Неопределено;
КонецФункции

// Определяет список команд отчетов.
//
// Параметры:
//   КомандыОтчетов - ТаблицаЗначений - Таблица с командами отчетов. Для изменения.
//       См. описание 1 параметра процедуры ВариантыОтчетовПереопределяемый.ПередДобавлениемКомандОтчетов().
//   Параметры - Структура - Вспомогательные параметры. Для чтения.
//       См. описание 2 параметра процедуры ВариантыОтчетовПереопределяемый.ПередДобавлениемКомандОтчетов().
//
Процедура ДобавитьКомандыОтчетов(КомандыОтчетов, Параметры) Экспорт
	
	ВариантыОтчетовУТПереопределяемый.ДобавитьКомандуСтруктураПодчиненности(КомандыОтчетов);
	
	
	
КонецПроцедуры

// Заполняет список команд печати.
// 
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати.
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт

КонецПроцедуры

//++ НЕ УТ

// Функция возвращает текст запроса для отражения документа в регламентированном учете.
//
// Возвращаемое значение:
//	Строка - Текст запроса отражения в регл. учете.
//
Функция ТекстОтраженияВРеглУчете() Экспорт

#Область ПередачаНДСВСтоимостьОС                 // (Дт <08.04.2> :: Кт <19.1, 19.3>)
	ПередачаНДСВСтоимостьОС = "
	|ВЫБРАТЬ //// Передача НДС в стоимость ОС (Дт <08.04.2> :: Кт <19.1, 19.3>) @НДСпредъявленный
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма,
	|	ПартииНДСКРаспределению.НДСУпр КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК АналитикаУчетаДт,
	|	ПартииНДСКРаспределению.Подразделение КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ПартииНДСКРаспределению.Подразделение КАК ПодразделениеДт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК СубконтоДт1,
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоДт2,
	|	ВЫБОР КОГДА ОбъектыСтроительства.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка) 
	|		ТОГДА ОбъектыСтроительства.СпособСтроительства
	|	ИНАЧЕ 
	|		ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный) 
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСпоПриобретеннымЦенностям) КАК ВидСчетаКт,
	|	ПартииНДСКРаспределению.НалогообложениеФинПартии КАК АналитикаУчетаКт, 
	|	ПартииНДСКРаспределению.ВидЦенности КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	ВЫБОР КОГДА ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ДАТАВРЕМЯ(1,1,1)) >= &ДатаНачалаУчетаНДСПоНаправлениямДеятельности
	|		ТОГДА ЕСТЬNULL(ВводСобственныхСредств.НаправлениеДеятельности, ПартииНДСКРаспределению.НаправлениеДеятельности)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	КОНЕЦ КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	ПартииНДСКРаспределению.Поставщик КАК СубконтоКт1,
	|	ПартииНДСКРаспределению.ДокументПоступленияРасходов КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Передача НДС в стоимость ОС"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК Статьи
	|	ПО
	|		ПартииНДСКРаспределению.СтатьяРасходов = Статьи.Ссылка
	|		И Статьи.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО 
	|		ОбъектыСтроительства.Ссылка = ПартииНДСКРаспределению.АналитикаРасходов
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = ПартииНДСКРаспределению.Организация
	|		И ДанныеПервичныхДокументов.Документ = ПартииНДСКРаспределению.ДокументПоступленияРасходов
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТВводСобственныхСредств КАК ВводСобственныхСредств
	|	ПО ПартииНДСКРаспределению.Регистратор = ВводСобственныхСредств.Ссылка
	|		И ПартииНДСКРаспределению.ДокументПоступленияРасходов = ВводСобственныхСредств.СчетФактура
	|ГДЕ
	|	ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии <> ПартииНДСКРаспределению.НалогообложениеПартии
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) В (
	|		ТИП(Справочник.ОбъектыЭксплуатации),
	|		ТИП(Справочник.ОбъектыСтроительства),
	|		ТИП(Справочник.НематериальныеАктивы))
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти
	
#Область ИсключениеНДСИзСтоимостиОС              // (Дт <19.1, 19.3> :: Кт <08.04.2>)
	ИсключениеНДСИзСтоимостиОС = "
	|ВЫБРАТЬ //// Исключение НДС из стоимости ОС (Дт <19.1, 19.3> :: Кт <08.04.2>) @НДСпредъявленный
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма,
	|	ПартииНДСКРаспределению.НДСУпр КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСпоПриобретеннымЦенностям) КАК ВидСчетаДт,
	|	ПартииНДСКРаспределению.НалогообложениеПартии КАК АналитикаУчетаДт,
	|	ПартииНДСКРаспределению.ВидЦенности КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеДт,
	|	ВЫБОР КОГДА ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ДАТАВРЕМЯ(1,1,1)) >= &ДатаНачалаУчетаНДСПоНаправлениямДеятельности
	|		ТОГДА ЕСТЬNULL(ВводСобственныхСредств.НаправлениеДеятельности, ПартииНДСКРаспределению.НаправлениеДеятельности)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	КОНЕЦ КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	
	|	ПартииНДСКРаспределению.Поставщик КАК СубконтоДт1,
	|	ПартииНДСКРаспределению.ДокументПоступленияРасходов КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаКт,
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК АналитикаУчетаКт,
	|	ПартииНДСКРаспределению.Подразделение КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	ПартииНДСКРаспределению.Подразделение КАК ПодразделениеКт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Исключение НДС из стоимости ОС"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК Статьи
	|	ПО
	|		ПартииНДСКРаспределению.СтатьяРасходов = Статьи.Ссылка
	|		И Статьи.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = ПартииНДСКРаспределению.Организация
	|		И ДанныеПервичныхДокументов.Документ = ПартииНДСКРаспределению.ДокументПоступленияРасходов
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТВводСобственныхСредств КАК ВводСобственныхСредств
	|	ПО ПартииНДСКРаспределению.Регистратор = ВводСобственныхСредств.Ссылка
	|		И ПартииНДСКРаспределению.ДокументПоступленияРасходов = ВводСобственныхСредств.СчетФактура
	|ГДЕ
	|	ПартииНДСКРаспределению.НалогообложениеФинПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии <> ПартииНДСКРаспределению.НалогообложениеПартии
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) В (
	|			ТИП(Справочник.ОбъектыЭксплуатации), 
	|			ТИП(Справочник.ОбъектыСтроительства),
	|			ТИП(Справочник.НематериальныеАктивы))
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти

#Область УчетВнеоборотныхАктивов2_2

#Область СтоимостьОСНаСчетУчета                  // (Дт <СчетУчетаОС/НМА> :: Кт <08.04.2>)
	СтоимостьОСНаСчетУчета_2_2 = "
	|ВЫБРАТЬ ////Стоимость ОС на счет учета (Дт <СчетУчетаОС/НМА> :: Кт <08.04.2>)
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ЕСТЬNULL(МестонахождениеОС.Местонахождение, МестонахождениеНМА.Местонахождение) КАК ПодразделениеДт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР 
	|		КОГДА ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) = ТИП(Справочник.ОбъектыЭксплуатации)
	|			ТОГДА ЕСТЬNULL(СчетаОтражения.ГруппаФинансовогоУчета.СчетУчета, СчетаОтражения.СчетУчета)
	|		ИНАЧЕ СчетаОтраженияНМА.СчетУчета
	|	КОНЕЦ КАК СчетДт,
	|	
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаКт,
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК АналитикаУчетаКт,
	|	ПартииНДСКРаспределению.Подразделение КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	ПартииНДСКРаспределению.Подразделение КАК ПодразделениеКт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Стоимость ОС на счет учета"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиСтроительства
	|	ПО
	|		ПартииНДСКРаспределению.СтатьяРасходов = СтатьиСтроительства.Ссылка
	|		И СтатьиСтроительства.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаОС.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтражения
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = СчетаОтражения.ОсновноеСредство
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаНМА.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, НематериальныйАктив) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтраженияНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = СчетаОтраженияНМА.НематериальныйАктив
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК МестонахождениеОС
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = МестонахождениеОС.ОсновноеСредство
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		(ВЫБРАТЬ
	|			ПУ.НематериальныйАктив,
	|			ПУ.Подразделение КАК Местонахождение
	|		ИЗ
	|			Документ.ПринятиеКУчетуНМА КАК ПУ
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияНМАБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				Организация В 
	|					(ВЫБРАТЬ
	|						Т.Организация
	|					ИЗ
	|						ПартииНДСКРаспределению_ВНА КАК Т)
	|				И Регистратор ССЫЛКА Документ.ПринятиеКУчетуНМА) КАК ПервоначальныеСведения
	|			ПО ПУ.Ссылка = ПервоначальныеСведения.Регистратор
	|				И ПУ.НематериальныйАктив = ПервоначальныеСведения.НематериальныйАктив
	|		) КАК МестонахождениеНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = МестонахождениеНМА.НематериальныйАктив
	|
	|ГДЕ
	|	&ИспользоватьВнеоборотныеАктивы2_2 
	|	И (&Дата < &ДатаНачалаУчетаВнеоборотныхАктивов2_4 ИЛИ НЕ &ИспользоватьВнеоборотныеАктивы2_4)
	|	И НЕ (СчетаОтражения.СчетУчета ЕСТЬ NULL И СчетаОтраженияНМА.СчетУчета ЕСТЬ NULL)
	|	И ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|	И ПартииНДСКРаспределению.НалогообложениеПартии <> ПартииНДСКРаспределению.НалогообложениеФинПартии
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) В (
	|		ТИП(Справочник.ОбъектыЭксплуатации), 
	|		ТИП(Справочник.НематериальныеАктивы))
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти

#Область СтоимостьОСВРасходыНУ                  // (Дт <СчетРасходов> :: Кт <01>)
	СтоимостьОСВРасходыНУ_2_2 = "
	|ВЫБРАТЬ ////Стоимость ОС на счет учета (Дт <СчетУчетаОС/НМА> :: Кт <01>)
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	ЕСТЬNULL(ПринятиеКУчетуОС.СтатьяРасходов, ПринятиеКУчетуНМА.СтатьяРасходов) КАК АналитикаУчетаДт,
	|	ЕСТЬNULL(ПринятиеКУчетуОС.Местонахождение, ПринятиеКУчетуНМА.Подразделение) КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ЕСТЬNULL(ПринятиеКУчетуОС.Местонахождение, ПринятиеКУчетуНМА.Подразделение) КАК ПодразделениеДт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	
	|	ЕСТЬNULL(ПринятиеКУчетуОС.СтатьяРасходов, ПринятиеКУчетуНМА.СтатьяРасходов) КАК СубконтоДт1,
	|	ЕСТЬNULL(ПринятиеКУчетуОС.АналитикаРасходов, ПринятиеКУчетуНМА.АналитикаРасходов) КАК СубконтоДт2,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее) КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	ПартииНДСКРаспределению.НДСРегл КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	-ПартииНДСКРаспределению.НДСРегл КАК СуммаВРДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	ЕСТЬNULL(ПринятиеКУчетуОС.Местонахождение, ПринятиеКУчетуНМА.Подразделение) КАК ПодразделениеКт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ВЫБОР 
	|		КОГДА ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) = ТИП(Справочник.ОбъектыЭксплуатации)
	|			ТОГДА ЕСТЬNULL(СчетаОтражения.ГруппаФинансовогоУчета.СчетУчета, СчетаОтражения.СчетУчета)
	|		ИНАЧЕ СчетаОтраженияНМА.СчетУчета
	|	КОНЕЦ КАК СчетКт,
	|	
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ПартииНДСКРаспределению.НДСРегл КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	-ПартииНДСКРаспределению.НДСРегл КАК СуммаВРКт,
	|	""Включение в расходы при принятии к учету"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаОС.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|			) КАК СчетаОтражения
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = СчетаОтражения.ОсновноеСредство
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаНМА.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, НематериальныйАктив) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтраженияНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = СчетаОтраженияНМА.НематериальныйАктив
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ПервоначальныеСведенияНМАНалоговыйУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(НематериальныйАктив, Организация) В 
	|						(ВЫБРАТЬ
	|							Т.Актив,
	|							Т.Организация
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|				И Регистратор ССЫЛКА Документ.ПринятиеКУчетуНМА
	|				) КАК ПервоначальныеСведенияНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = ПервоначальныеСведенияНМА.НематериальныйАктив
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.ПринятиеКУчетуНМА КАК ПринятиеКУчетуНМА
	|	ПО
	|		ПервоначальныеСведенияНМА.Регистратор = ПринятиеКУчетуНМА.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ПервоначальныеСведенияОСНалоговыйУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(ОсновноеСредство, Организация) В 
	|					(ВЫБРАТЬ
	|						Т.Актив,
	|						Т.Организация
	|					ИЗ
	|						ПартииНДСКРаспределению_ВНА КАК Т)
	|				И Регистратор ССЫЛКА Документ.ПринятиеКУчетуОС
	|				) КАК ПервоначальныеСведенияОС
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = ПервоначальныеСведенияОС.ОсновноеСредство
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.ПринятиеКУчетуОС КАК ПринятиеКУчетуОС
	|	ПО
	|		ПервоначальныеСведенияОС.Регистратор = ПринятиеКУчетуОС.Ссылка
	|		
	|ГДЕ
	|	&ИспользоватьВнеоборотныеАктивы2_2
	|	И (&Дата < &ДатаНачалаУчетаВнеоборотныхАктивов2_4 ИЛИ НЕ &ИспользоватьВнеоборотныеАктивы2_4)
	|	И НЕ (СчетаОтражения.СчетУчета ЕСТЬ NULL И СчетаОтраженияНМА.СчетУчета ЕСТЬ NULL)
	|	И НЕ (ПринятиеКУчетуОС.Ссылка ЕСТЬ NULL И ПринятиеКУчетуНМА.Ссылка ЕСТЬ NULL)
	|	И ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии <> ПартииНДСКРаспределению.НалогообложениеПартии
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) В (
	|		ТИП(Справочник.ОбъектыЭксплуатации), 
	|		ТИП(Справочник.НематериальныеАктивы))
	|	И ВЫБОР 
	|		КОГДА НЕ ПринятиеКУчетуОС.Ссылка ЕСТЬ NULL
	|				И ПринятиеКУчетуОС.ПорядокУчетаНУ = ЗНАЧЕНИЕ(Перечисление.ПорядокВключенияСтоимостиОСВСоставРасходовНУ.ВключениеВРасходыПриПринятииКУчету)
	|				И ПринятиеКУчетуОС.СтатьяРасходов.ПринятиеКналоговомуУчету
	|			ТОГДА ИСТИНА
	|		КОГДА НЕ ПринятиеКУчетуНМА.Ссылка ЕСТЬ NULL
	|				И ПринятиеКУчетуНМА.ПорядокСписанияНИОКРНаРасходыНУ = ЗНАЧЕНИЕ(Перечисление.ПорядокСписанияНИОКРНУ.ПриПринятииКУчету)
	|				И ПринятиеКУчетуНМА.СтатьяРасходов.ПринятиеКналоговомуУчету
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти

#Область ИсключениеНДССоСчетаУчетаОС             // (Дт <08.04.2> :: Кт <СчетУчетаОС/НМА>)
	ИсключениеНДССоСчетаУчетаОС_2_2 = "
	|ВЫБРАТЬ ////Исключение НДС со счета учета ОС (Дт <08.04.2> :: Кт <СчетУчетаОС/НМА>)
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК АналитикаУчетаДт,
	|	ПартииНДСКРаспределению.Подразделение КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	ПартииНДСКРаспределению.Подразделение КАК ПодразделениеДт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК СубконтоДт1,
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоДт2,
	|	ВЫБОР КОГДА ОбъектыСтроительства.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка) 
	|		ТОГДА ОбъектыСтроительства.СпособСтроительства
	|	ИНАЧЕ 
	|		ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный) 
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	ЕСТЬNULL(МестонахождениеОС.Местонахождение, МестонахождениеНМА.Местонахождение) КАК ПодразделениеКт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ВЫБОР 
	|		КОГДА ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) = ТИП(Справочник.ОбъектыЭксплуатации)
	|			ТОГДА ЕСТЬNULL(СчетаОтражения.ГруппаФинансовогоУчета.СчетУчета, СчетаОтражения.СчетУчета)
	|		ИНАЧЕ СчетаОтраженияНМА.СчетУчета
	|	КОНЕЦ КАК СчетКт,
	|	
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Исключение НДС со счета учета ОС"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиСтроительства
	|	ПО
	|		ПартииНДСКРаспределению.СтатьяРасходов = СтатьиСтроительства.Ссылка
	|		И СтатьиСтроительства.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаОС.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтражения
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = СчетаОтражения.ОсновноеСредство
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаНМА.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, НематериальныйАктив) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтраженияНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = СчетаОтраженияНМА.НематериальныйАктив
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК МестонахождениеОС
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = МестонахождениеОС.ОсновноеСредство
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		(ВЫБРАТЬ
	|			ПУ.НематериальныйАктив,
	|			ПУ.Подразделение КАК Местонахождение
	|		ИЗ
	|			Документ.ПринятиеКУчетуНМА КАК ПУ
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияНМАБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				Организация В 
	|					(ВЫБРАТЬ
	|						Т.Организация
	|					ИЗ
	|						ПартииНДСКРаспределению_ВНА КАК Т)
	|				И Регистратор ССЫЛКА Документ.ПринятиеКУчетуНМА) КАК ПервоначальныеСведения
	|			ПО ПУ.Ссылка = ПервоначальныеСведения.Регистратор
	|				И ПУ.НематериальныйАктив = ПервоначальныеСведения.НематериальныйАктив
	|		) КАК МестонахождениеНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = МестонахождениеНМА.НематериальныйАктив
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО 
	|		ОбъектыСтроительства.Ссылка = ПартииНДСКРаспределению.АналитикаРасходов
	|ГДЕ
	|	&ИспользоватьВнеоборотныеАктивы2_2
	|	И (&Дата < &ДатаНачалаУчетаВнеоборотныхАктивов2_4 ИЛИ НЕ &ИспользоватьВнеоборотныеАктивы2_4)
	|	И НЕ (СчетаОтражения.СчетУчета ЕСТЬ NULL И СчетаОтраженияНМА.СчетУчета ЕСТЬ NULL)
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|	И ПартииНДСКРаспределению.НалогообложениеПартии <> ПартииНДСКРаспределению.НалогообложениеФинПартии
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) В (
	|			ТИП(Справочник.ОбъектыЭксплуатации), 
	|			ТИП(Справочник.НематериальныеАктивы))
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти
	
#Область КорректировкаАмортизационнойПремии      // (Дт <КВ> :: Кт <ПустаяСсылка>)
	КорректировкаАмортизационнойПремии_2_2 = "
	|ВЫБРАТЬ ////Корректировка амортизационной премии с учетом изменения стоимости ОС (Дт <КВ> :: Кт <ПустаяСсылка>)
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	МестонахождениеОС.Местонахождение КАК ПодразделениеДт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасходыНаКапитальныеВложения) КАК СчетДт,
	|
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК СубконтоДт1,
	|	Операция.Ссылка КАК СубконтоДт2,
	|	ВЫБОР КОГДА ОбъектыСтроительства.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка) 
	|		ТОГДА ОбъектыСтроительства.СпособСтроительства
	|	ИНАЧЕ 
	|		ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный) 
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	ВЫБОР КОГДА ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|			И ПартииНДСКРаспределению.НалогообложениеПартии <> ПартииНДСКРаспределению.НалогообложениеФинПартии ТОГДА
	|		// Увеличиваем амортизационную премию
	|		ВЫРАЗИТЬ((ПартииНДСКРаспределению.НДСРегл)*(Операция.ПроцентКапитальныхВложенийВключаемыхВРасходыНУ / 100) КАК ЧИСЛО(31,2))
	|	ИНАЧЕ
	|		// Уменьшаем амортизационную премию
	|		-ВЫРАЗИТЬ((ПартииНДСКРаспределению.НДСРегл)*(Операция.ПроцентКапитальныхВложенийВключаемыхВРасходыНУ / 100) КАК ЧИСЛО(31,2))
	|	КОНЕЦ КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Корректировка амортизационной премии с учетом изменения стоимости ОС"" КАК Содержание
	|	
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПринятиеКУчетуОС.ОС КАК Строки
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПринятиеКУчетуОС КАК Операция
	|			ПО Строки.Ссылка = Операция.Ссылка
	|			И Операция.Дата МЕЖДУ НАЧАЛОПЕРИОДА(&Дата, МЕСЯЦ) И КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ)
	|			И Операция.Проведен
	|		ПО ПартииНДСКРаспределению.АналитикаРасходов = Строки.ОсновноеСредство
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|		ПО ПартииНДСКРаспределению.СтатьяРасходов = СтатьиРасходов.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК МестонахождениеОС
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаРасходов = МестонахождениеОС.ОсновноеСредство
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО 
	|		ОбъектыСтроительства.Ссылка = ПартииНДСКРаспределению.АналитикаРасходов
	|
	|ГДЕ
	|	&ИспользоватьВнеоборотныеАктивы2_2
	|	И (&Дата < &ДатаНачалаУчетаВнеоборотныхАктивов2_4 ИЛИ НЕ &ИспользоватьВнеоборотныеАктивы2_4)
	|	И Операция.ВключитьАмортизационнуюПремиюВСоставРасходов
	|	И Операция.ПроцентКапитальныхВложенийВключаемыхВРасходыНУ <> 0
	|	И СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) = ТИП(Справочник.ОбъектыЭксплуатации)
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии <> ПартииНДСКРаспределению.НалогообложениеПартии 
	|	И (ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ ПартииНДСКРаспределению.НалогообложениеФинПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС))
	|";
#КонецОбласти

#Область СтоимостьПрочегоАктиваНаОСиНМА              // (Дт <СчетУчетаОС/НМА> :: Кт <08.04.2>)
	СтоимостьПрочегоАктиваНаОСиНМА_2_2 = "
	|ВЫБРАТЬ ////Стоимость ОС на счет учета (Дт <СчетУчетаОС/НМА> :: Кт <08.04.2>)
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ЕСТЬNULL(МестонахождениеОС.Местонахождение, МестонахождениеНМА.Местонахождение) КАК ПодразделениеДт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР 
	|		КОГДА ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаАктивовПассивов) = ТИП(Справочник.ОбъектыЭксплуатации)
	|			ТОГДА ЕСТЬNULL(СчетаОтражения.ГруппаФинансовогоУчета.СчетУчета, СчетаОтражения.СчетУчета)
	|		ИНАЧЕ СчетаОтраженияНМА.СчетУчета
	|	КОНЕЦ КАК СчетДт,
	|	
	|	ПартииНДСКРаспределению.АналитикаАктивовПассивов КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	ПартииНДСКРаспределению.Подразделение КАК ПодразделениеКт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	СчетаУчетаПрочихАктивов.СчетУчета КАК СчетКт,
	|
	|	СчетаУчетаПрочихАктивов.Субконто1 КАК СубконтоКт1,
	|	СчетаУчетаПрочихАктивов.Субконто2 КАК СубконтоКт2,
	|	СчетаУчетаПрочихАктивов.Субконто3 КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""НДС в стоимость актива"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиАктивовПассивов КАК СтатьиАктивовПассивов
	|	ПО
	|		ПартииНДСКРаспределению.СтатьяРасходов = СтатьиАктивовПассивов.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаОС.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтражения
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаАктивовПассивов = СчетаОтражения.ОсновноеСредство
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СчетаБухгалтерскогоУчетаНМА.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, НематериальныйАктив) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК СчетаОтраженияНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаАктивовПассивов = СчетаОтраженияНМА.НематериальныйАктив
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				(Организация, ОсновноеСредство) В
	|						(ВЫБРАТЬ
	|							Т.Организация,
	|							Т.Актив
	|						ИЗ
	|							ПартииНДСКРаспределению_ВНА КАК Т)
	|		) КАК МестонахождениеОС
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаАктивовПассивов = МестонахождениеОС.ОсновноеСредство
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		(ВЫБРАТЬ
	|			ПУ.НематериальныйАктив,
	|			ПУ.Подразделение КАК Местонахождение
	|		ИЗ
	|			Документ.ПринятиеКУчетуНМА КАК ПУ
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияНМАБухгалтерскийУчет.СрезПоследних(
	|				КОНЕЦПЕРИОДА(&Дата, МЕСЯЦ),
	|				Организация В 
	|					(ВЫБРАТЬ
	|						Т.Организация
	|					ИЗ
	|						ПартииНДСКРаспределению_ВНА КАК Т)
	|				И Регистратор ССЫЛКА Документ.ПринятиеКУчетуНМА) КАК ПервоначальныеСведения
	|			ПО ПУ.Ссылка = ПервоначальныеСведения.Регистратор
	|				И ПУ.НематериальныйАктив = ПервоначальныеСведения.НематериальныйАктив
	|		) КАК МестонахождениеНМА
	|	ПО
	|		ПартииНДСКРаспределению.АналитикаАктивовПассивов = МестонахождениеНМА.НематериальныйАктив
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СчетаУчетаПрочихАктивов КАК СчетаУчетаПрочихАктивов
	|	ПО
	|		ПартииНДСКРаспределению.Организация = СчетаУчетаПрочихАктивов.Организация
	|		И ПартииНДСКРаспределению.Подразделение = СчетаУчетаПрочихАктивов.Подразделение
	|		И ПартииНДСКРаспределению.СтатьяРасходов = СчетаУчетаПрочихАктивов.Статья
	|		И ПартииНДСКРаспределению.АналитикаАктивовПассивов = СчетаУчетаПрочихАктивов.АналитикаАктивовПассивов
	|		И ПартииНДСКРаспределению.ДокументПоступленияРасходов = СчетаУчетаПрочихАктивов.ДокументПоступленияРасходов
	|		И ПартииНДСКРаспределению.Поставщик = СчетаУчетаПрочихАктивов.Поставщик
	|		И ПартииНДСКРаспределению.ВидЦенности = СчетаУчетаПрочихАктивов.ВидЦенности
	|		И ПартииНДСКРаспределению.НаправлениеДеятельности = СчетаУчетаПрочихАктивов.НаправлениеДеятельности
	|		И ПартииНДСКРаспределению.СтавкаНДС = СчетаУчетаПрочихАктивов.СтавкаНДС
	|	
	|ГДЕ
	|	&ИспользоватьВнеоборотныеАктивы2_2
	|	И (&Дата < &ДатаНачалаУчетаВнеоборотныхАктивов2_4 ИЛИ НЕ &ИспользоватьВнеоборотныеАктивы2_4)
	|	И НЕ (СчетаОтражения.СчетУчета ЕСТЬ NULL И СчетаОтраженияНМА.СчетУчета ЕСТЬ NULL)
	|	И ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС) 
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии <> ПартииНДСКРаспределению.НалогообложениеПартии
	|	И ПартииНДСКРаспределению.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|	И ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаАктивовПассивов) В (
	|				ТИП(Справочник.ОбъектыЭксплуатации), 
	|				ТИП(Справочник.НематериальныеАктивы))
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти

#КонецОбласти

#Область УчетВнеоборотныхАктивов2_4

	#Область УвеличениеСтоимостиОС_Дт_СчетУчета__Кт_08_04_2_или_08_03
	
	УвеличениеСтоимостиОС_2_4 =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Принятие к учету ОС (Дт СчетУчета:: Кт 08.04.2, 08.03)
	|//
	|ВЫБРАТЬ
	|	
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	Строки.СтоимостьРегл КАК Сумма,
	|	Строки.Стоимость КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СтоимостьВНА) КАК ВидСчетаДт,
	|	Строки.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.СтоимостьНУ КАК СуммаНУДт,
	|	Строки.СтоимостьПР КАК СуммаПРДт,
	|	Строки.СтоимостьВР КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаКт,
	|	Строки.КорСтатьяРасходов КАК АналитикаУчетаКт,
	|	Строки.КорПодразделение КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.КорПодразделение КАК ПодразделениеКт,
	|	Строки.КорНаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	Строки.КорАналитикаРасходов КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.СтоимостьРегл - Строки.КорПостояннаяРазница - Строки.КорВременнаяРазница КАК СуммаНУКт,
	|	Строки.КорПостояннаяРазница КАК СуммаПРКт,
	|	Строки.КорВременнаяРазница КАК СуммаВРКт,
	|	""НДС в стоимость актива"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьОС КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|ГДЕ
	|	Строки.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеНДС)
	|	И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)";
	
	#КонецОбласти

	#Область  УвеличениеСтоимостиНМА_Дт_СчетУчета__Кт_СчетаКапитальныхЗатрат
	
	УвеличениеСтоимостиНМА_2_4 =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Принятие к учету  (Дт СчетУчета:: Кт СчетаКапитальныхЗатрат)
	|
	|ВЫБРАТЬ
	|	
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	Строки.СтоимостьРегл КАК Сумма,
	|	Строки.Стоимость КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СтоимостьВНА) КАК ВидСчетаДт,
	|	Строки.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	
	|	Строки.НематериальныйАктив КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.СтоимостьНУ КАК СуммаНУДт,
	|	Строки.СтоимостьПР КАК СуммаПРДт,
	|	Строки.СтоимостьВР КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаКт,
	|	Строки.КорСтатьяРасходов КАК АналитикаУчетаКт,
	|	Строки.КорПодразделение КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.КорПодразделение КАК ПодразделениеКт,
	|	Строки.КорНаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	Строки.НематериальныйАктив КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.СтоимостьНУ КАК СуммаНУКт,
	|	Строки.СтоимостьПР КАК СуммаПРКт,
	|	Строки.СтоимостьВР КАК СуммаВРКт,
	|	""НДС в стоимость актива"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьНМА КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|ГДЕ
	|	Строки.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеНДС)
	|	И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)";
	
	#КонецОбласти

	#Область АмортизационнаяПремия_Дт_КВ__Кт_ПустаяСсылка
	
	АмортизационнаяПремия2_4_ДтКВ =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Амортизационная премия (Дт КВ :: Кт <ПустаяСсылка>)
	|//
	|ВЫБРАТЬ
	|
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасходыНаКапитальныеВложения) КАК СчетДт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоДт1,
	|	ПервоначальныеСведенияОС.ДокументВводаВЭксплуатациюБУ КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.АмортизационнаяПремия КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Амортизационная премия"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьОС КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияОС.СрезПоследних КАК ПервоначальныеСведенияОС
	|	ПО ПервоначальныеСведенияОС.ОсновноеСредство = Строки.ОсновноеСредство
	|		И ПервоначальныеСведенияОС.Организация = Строки.Организация
	|
	|ГДЕ
	|	Строки.АмортизационнаяПремия <> 0
	|	И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)";
	
	#КонецОбласти
	
	#Область АмортизационнаяПремия_Дт_ПустаяСсылка__Кт_КВ
	
	АмортизационнаяПремия2_4_КтКВ =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Амортизационная премия (Дт <ПустаяСсылка> :: Кт КВ)
	|//
	|ВЫБРАТЬ
	|
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.Подразделение КАК ПодразделениеКт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасходыНаКапитальныеВложения) КАК СчетКт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоКт1,
	|	ПервоначальныеСведенияОС.ДокументВводаВЭксплуатациюБУ КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.АмортизационнаяПремия КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Амортизационная премия"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьОС КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияОС.СрезПоследних КАК ПервоначальныеСведенияОС
	|	ПО ПервоначальныеСведенияОС.ОсновноеСредство = Строки.ОсновноеСредство
	|		И ПервоначальныеСведенияОС.Организация = Строки.Организация
	|
	|ГДЕ
	|	Строки.АмортизационнаяПремия <> 0
	|	И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";
	
	#КонецОбласти
	
	#Область АмортизационнаяПремияМодернизации_Дт_СчетЗатрат_Кт_СчетУчетаОС
	АмортизационнаяПремияМодернизации =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Амортизационная премия (Дт 20, 25, 44 :: Кт Счет учета ОС)
	|
	|ВЫБРАТЬ
	|	
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	Строки.КорСтатьяРасходов КАК АналитикаУчетаДт,
	|	Строки.Подразделение КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|
	|	Строки.КорСтатьяРасходов КАК СубконтоДт1,
	|	Строки.КорАналитикаРасходов КАК СубконтоДт2,
	|	ВЫБОР КОГДА СтатьиСтроительства.Ссылка ЕСТЬ НЕ NULL ТОГДА
	|			ВЫБОР КОГДА ОбъектыСтроительства.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка) 
	|					ТОГДА ОбъектыСтроительства.СпособСтроительства
	|				ИНАЧЕ 
	|					ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный) 
	|			КОНЕЦ
	|	ИНАЧЕ
	|		ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее)
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.АмортизационнаяПремия КАК СуммаНУДт,
	|	ВЫБОР КОГДА Строки.КорСтатьяРасходов.ПринятиеКНалоговомуУчету
	|		ТОГДА 0
	|		ИНАЧЕ -Строки.АмортизационнаяПремия
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР КОГДА Строки.КорСтатьяРасходов.ПринятиеКНалоговомуУчету
	|		ТОГДА -Строки.АмортизационнаяПремия
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СтоимостьВНА) КАК ВидСчетаКт,
	|	Строки.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	Строки.Подразделение КАК ПодразделениеКт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.АмортизационнаяПремия КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	-Строки.АмортизационнаяПремия КАК СуммаВРКт,
	|	""Амортизационная премия"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьОС КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|		И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиСтроительства
	|	ПО Строки.КорСтатьяРасходов = СтатьиСтроительства.Ссылка
	|		И СтатьиСтроительства.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО ОбъектыСтроительства.Ссылка = Строки.КорАналитикаРасходов
	|ГДЕ
	|	Строки.АмортизационнаяПремия <> 0";
	#КонецОбласти
	
	#Область ВключениеСтоимостиОСВРасходы // (Дт <СчетРасходов> :: Кт <01>)
	
	ВключениеСтоимостиОСВРасходы_2_4 =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Включение в расходы при принятии к учету (Дт <СчетРасходов> :: Кт <01>)
	|//
	|ВЫБРАТЬ
	|	
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	Строки.КорСтатьяРасходов КАК АналитикаУчетаДт,
	|	Строки.КорПодразделение КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.КорПодразделение КАК ПодразделениеДт,
	|	Строки.КорНаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.СтоимостьНУ КАК СуммаНУДт,
	|	Строки.СтоимостьПР КАК СуммаПРДт,
	|	Строки.СтоимостьВР КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СтоимостьВНА) КАК ВидСчетаКт,
	|	Строки.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.Подразделение КАК ПодразделениеКт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.СтоимостьНУ КАК СуммаНУКт,
	|	Строки.СтоимостьПР КАК СуммаПРКт,
	|	Строки.СтоимостьВР КАК СуммаВРКт,
	|	""Включение в расходы при принятии к учету"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьОС КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|ГДЕ
	|	Строки.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеСтоимостиОС)";
	
	#КонецОбласти
	
	#Область ВключениеСтоимостиНМАВРасходы // (Дт <СчетРасходов> :: Кт <04>)
	
	ВключениеСтоимостиНМАВРасходы_2_4 =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Включение в расходы при принятии к учету (Дт <СчетРасходов> :: Кт <04>)
	|//
	|ВЫБРАТЬ
	|	
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	Строки.КорСтатьяРасходов КАК АналитикаУчетаДт,
	|	Строки.КорПодразделение КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.КорПодразделение КАК ПодразделениеДт,
	|	Строки.КорНаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	
	|	Строки.НематериальныйАктив КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.СтоимостьНУ КАК СуммаНУДт,
	|	Строки.СтоимостьПР КАК СуммаПРДт,
	|	Строки.СтоимостьВР КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СтоимостьВНА) КАК ВидСчетаКт,
	|	Строки.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.Подразделение КАК ПодразделениеКт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	Строки.НематериальныйАктив КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.СтоимостьНУ КАК СуммаНУКт,
	|	Строки.СтоимостьПР КАК СуммаПРКт,
	|	Строки.СтоимостьВР КАК СуммаВРКт,
	|	""Включение в расходы при принятии к учету"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьНМА КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|ГДЕ
	|	Строки.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеСтоимостиНМА)";
	
	#КонецОбласти
	
	#Область КорректировкаСтоимостиАрендованногоОС_Дт_01_К__Кт_08_04_2_или_08_03
	КорректировкаСтоимостиАрендованногоИмущества =
	"////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Принятие к учету ОС (Дт 01.К:: Кт 08.04.2, 08.03)
	|//
	|ВЫБРАТЬ
	|	
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	0 КАК Сумма,
	|	0 КАК СуммаУУ,
	|	
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаФинансовогоУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.КорректировкаСтоимостиАрендованногоИмущества) КАК СчетДт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.КорректировкаСтоимостиНУ КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	-Строки.КорректировкаСтоимостиНУ КАК СуммаВРДт,
	|	
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаКт,
	|	Строки.КорСтатьяРасходов КАК АналитикаУчетаКт,
	|	Строки.КорПодразделение КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.КорПодразделение КАК ПодразделениеКт,
	|	Строки.КорНаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	Строки.ОсновноеСредство КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Корректировка стоимости арендованного имущества по НУ"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьОС КАК Строки
	|	ПО Строки.Регистратор = ДокументыКОтражению.Ссылка
	|
	|ГДЕ
	|	Строки.КорректировкаСтоимостиНУ <> 0
	|	И Строки.КорСтатьяРасходов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|	И Строки.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеНДС)
	|	И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)";
	#КонецОбласти
	
#КонецОбласти

#Область ПередачаНДСВСтоимостьПрочегоАктива               // (Дт <08.04.2>, ХХ :: Кт <19.1, 19.3>)
	ПередачаНДСВСтоимостьПрочегоАктива_2_2 = "
	|ВЫБРАТЬ //// Передача НДС в стоимость ОС (Дт <08.04.2>, ХХ :: Кт <19.1, 19.3>) @НДСпредъявленный
	|	ПартииНДСКРаспределению.Регистратор КАК Ссылка,
	|	ПартииНДСКРаспределению.Период КАК Период,
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма,
	|	ПартииНДСКРаспределению.НДСУпр КАК СуммаУУ,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ПартииНДСКРаспределению.Подразделение КАК ПодразделениеДт,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	СчетаУчетаПрочихАктивов.СчетУчета КАК СчетДт,
	|
	|	СчетаУчетаПрочихАктивов.Субконто1 КАК СубконтоДт1,
	|	СчетаУчетаПрочихАктивов.Субконто2 КАК СубконтоДт2,
	|	СчетаУчетаПрочихАктивов.Субконто3 КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСпоПриобретеннымЦенностям) КАК ВидСчетаКт,
	|	ПартииНДСКРаспределению.НалогообложениеФинПартии КАК АналитикаУчетаКт,
	|	ПартииНДСКРаспределению.ВидЦенности КАК МестоУчетаКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	ВЫБОР КОГДА ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ДАТАВРЕМЯ(1,1,1)) >= &ДатаНачалаУчетаНДСПоНаправлениямДеятельности
	|		ТОГДА ЕСТЬNULL(ВводСобственныхСредств.НаправлениеДеятельности, ПартииНДСКРаспределению.НаправлениеДеятельности)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	КОНЕЦ КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	ПартииНДСКРаспределению.Поставщик КАК СубконтоКт1,
	|	ПартииНДСКРаспределению.ДокументПоступленияРасходов КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Передача НДС в стоимость активы"" КАК Содержание
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиАктивовПассивов КАК Статьи
	|	ПО
	|		ПартииНДСКРаспределению.СтатьяРасходов = Статьи.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = ПартииНДСКРаспределению.Организация
	|		И ДанныеПервичныхДокументов.Документ = ПартииНДСКРаспределению.ДокументПоступленияРасходов
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СчетаУчетаПрочихАктивов КАК СчетаУчетаПрочихАктивов
	|	ПО
	|		ПартииНДСКРаспределению.Организация = СчетаУчетаПрочихАктивов.Организация
	|		И ПартииНДСКРаспределению.Подразделение = СчетаУчетаПрочихАктивов.Подразделение
	|		И ПартииНДСКРаспределению.СтатьяРасходов = СчетаУчетаПрочихАктивов.Статья
	|		И ПартииНДСКРаспределению.АналитикаАктивовПассивов = СчетаУчетаПрочихАктивов.АналитикаАктивовПассивов
	|		И ПартииНДСКРаспределению.ДокументПоступленияРасходов = СчетаУчетаПрочихАктивов.ДокументПоступленияРасходов
	|		И ПартииНДСКРаспределению.Поставщик = СчетаУчетаПрочихАктивов.Поставщик
	|		И ПартииНДСКРаспределению.ВидЦенности = СчетаУчетаПрочихАктивов.ВидЦенности
	|		И ПартииНДСКРаспределению.НаправлениеДеятельности = СчетаУчетаПрочихАктивов.НаправлениеДеятельности
	|		И ПартииНДСКРаспределению.СтавкаНДС = СчетаУчетаПрочихАктивов.СтавкаНДС
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТВводСобственныхСредств КАК ВводСобственныхСредств
	|	ПО ПартииНДСКРаспределению.Регистратор = ВводСобственныхСредств.Ссылка
	|		И ПартииНДСКРаспределению.ДокументПоступленияРасходов = ВводСобственныхСредств.СчетФактура
	|
	|ГДЕ
	|	ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС) 
	|	И ПартииНДСКРаспределению.НалогообложениеФинПартии <> ПартииНДСКРаспределению.НалогообложениеПартии
	|	И ПартииНДСКРаспределению.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
#КонецОбласти

	ТекстыОтражения = Новый Массив;
	// Общие фрагменты
	ТекстыОтражения.Добавить(ПередачаНДСВСтоимостьОС);
	ТекстыОтражения.Добавить(ИсключениеНДСИзСтоимостиОС);
	// Учет внеоборотных активов 2_2
	ТекстыОтражения.Добавить(СтоимостьОСНаСчетУчета_2_2);
	ТекстыОтражения.Добавить(ИсключениеНДССоСчетаУчетаОС_2_2);
	ТекстыОтражения.Добавить(КорректировкаАмортизационнойПремии_2_2);
	ТекстыОтражения.Добавить(ПередачаНДСВСтоимостьПрочегоАктива_2_2);
	ТекстыОтражения.Добавить(СтоимостьПрочегоАктиваНаОСиНМА_2_2);
	ТекстыОтражения.Добавить(СтоимостьОСВРасходыНУ_2_2);
	// Учет внеоборотных активов 2_4
	ТекстыОтражения.Добавить(УвеличениеСтоимостиОС_2_4);
	ТекстыОтражения.Добавить(УвеличениеСтоимостиНМА_2_4);
	ВнеоборотныеАктивыЛокализация.ТекстЗапросаНачислениеАмортизацииОС(ТекстыОтражения);
	ТекстыОтражения.Добавить(АмортизационнаяПремия2_4_ДтКВ);
	ТекстыОтражения.Добавить(АмортизационнаяПремия2_4_КтКВ);
	ТекстыОтражения.Добавить(АмортизационнаяПремияМодернизации);
	ТекстыОтражения.Добавить(ВключениеСтоимостиОСВРасходы_2_4);
	ТекстыОтражения.Добавить(ВключениеСтоимостиНМАВРасходы_2_4);
	ТекстыОтражения.Добавить(КорректировкаСтоимостиАрендованногоИмущества);
	
	Возврат СтрСоединить(ТекстыОтражения, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц, 
// необходимых для отражения в регламентированном учете.
//
// Возвращаемое значение:
//	ТекстЗапроса - Строка - Текст запроса создания временных таблиц.
//
Функция ТекстЗапросаВТОтраженияВРеглУчете() Экспорт
	
	СписокЗапросов = Новый Массив;
	
	ВнеоборотныеАктивыЛокализация.ТекстЗапросаВТНачислениеАмортизацииОС(СписокЗапросов);
	
	#Область ПартииНДСКРаспределению
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Партии.Регистратор                 КАК Регистратор,
	|	Партии.Период                      КАК Период,
	|	Партии.Организация                 КАК Организация,
	|	Партии.Подразделение               КАК Подразделение,
	|	Партии.НаправлениеДеятельности     КАК НаправлениеДеятельности,
	|	Партии.СтатьяРасходов              КАК СтатьяРасходов,
	|	Партии.АналитикаРасходов           КАК АналитикаРасходов,
	|	Партии.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
	|	Партии.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|	ВЫБОР
	|		КОГДА Партии.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортНесырьевыхТоваров)
	|				И ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ДАТАВРЕМЯ(1,1,1)) >= &ДатаНачалаДействия150ФЗ
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС)
	|		КОГДА Партии.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИНАЧЕ Партии.КорВидДеятельностиНДС
	|	КОНЕЦ КАК НалогообложениеПартии,
	|	ВЫБОР
	|		КОГДА Партии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортНесырьевыхТоваров)
	|				И ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ДАТАВРЕМЯ(1,1,1)) >= &ДатаНачалаДействия150ФЗ
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС)
	|		КОГДА Партии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИНАЧЕ Партии.ВидДеятельностиНДС
	|	КОНЕЦ                              КАК НалогообложениеФинПартии,
	|	Партии.СтатьяОтраженияРасходов     КАК СтатьяОтраженияРасходов,
	|	Партии.Поставщик                   КАК Поставщик,
	|	Партии.ВидЦенности                 КАК ВидЦенности,
	|	Партии.СтавкаНДС                   КАК СтавкаНДС,
	|	Партии.НДСРегл                     КАК НДСРегл,
	|	Партии.НДСУпр                      КАК НДСУпр
	|ПОМЕСТИТЬ ПартииНДСКРаспределению
	|ИЗ
	|	РегистрНакопления.ПартииНДСКРаспределению КАК Партии
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = Партии.Организация
	|		И ДанныеПервичныхДокументов.Документ = Партии.ДокументПоступленияРасходов
	|
	|ГДЕ
	|	Партии.Регистратор = &Ссылка
	|;
	|
	|///////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	ПартииНДСКРаспределению.АналитикаРасходов КАК Актив
	|ПОМЕСТИТЬ ПартииНДСКРаспределению_ВНА
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаРасходов) В (
	|			ТИП(Справочник.ОбъектыЭксплуатации),
	|			ТИП(Справочник.НематериальныеАктивы))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	ПартииНДСКРаспределению.АналитикаАктивовПассивов КАК Актив
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(ПартииНДСКРаспределению.АналитикаАктивовПассивов) В (
	|			ТИП(Справочник.ОбъектыЭксплуатации),
	|			ТИП(Справочник.НематериальныеАктивы))
	|;
	|
	|ВЫБРАТЬ
	|	ПартииНДСКРаспределению.Организация КАК Организация,
	|	ПартииНДСКРаспределению.Подразделение КАК Подразделение,
	|	ПартииНДСКРаспределению.СтатьяРасходов КАК Статья,
	|	ПартииНДСКРаспределению.АналитикаАктивовПассивов КАК АналитикаАктивовПассивов,
	|	ПартииНДСКРаспределению.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|	ПартииНДСКРаспределению.Поставщик КАК Поставщик,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	ПартииНДСКРаспределению.ВидЦенности КАК ВидЦенности,
	|	ПартииНДСКРаспределению.СтавкаНДС КАК СтавкаНДС,
	|	МАКСИМУМ(ЕСТЬNULL(ПриобретениеУслугПрочихАктивов.СчетУчета, ЕСТЬNULL(КорректировкаПриобретения.СчетУчета,
	|		ЕСТЬNULL(ВнутреннееПотреблениеТоваров.СчетУчета, ЕСТЬNULL(АвансовыйОтчет.СчетУчета, ЕСТЬNULL(ПрочиеДоходы.СчетУчета,
	|		ЕСТЬNULL(РасходныйКассовыйОрдер.СчетУчета, СписаниеБезналичныхДенежныхСредств.СчетУчета))))))) КАК СчетУчета,
	|	МАКСИМУМ(ЕСТЬNULL(ПриобретениеУслугПрочихАктивов.Субконто1, ЕСТЬNULL(КорректировкаПриобретения.Субконто1,
	|		ЕСТЬNULL(ВнутреннееПотреблениеТоваров.Субконто1, ЕСТЬNULL(АвансовыйОтчет.Субконто1,
	|		ЕСТЬNULL(ПрочиеДоходы.Субконто1, ЕСТЬNULL(РасходныйКассовыйОрдер.Субконто1, СписаниеБезналичныхДенежныхСредств.Субконто1))))))) КАК Субконто1,
	|	МАКСИМУМ(ЕСТЬNULL(ПриобретениеУслугПрочихАктивов.Субконто2, ЕСТЬNULL(КорректировкаПриобретения.Субконто2,
	|		ЕСТЬNULL(ВнутреннееПотреблениеТоваров.Субконто2, ЕСТЬNULL(АвансовыйОтчет.Субконто2,
	|		ЕСТЬNULL(ПрочиеДоходы.Субконто2, ЕСТЬNULL(РасходныйКассовыйОрдер.Субконто2, СписаниеБезналичныхДенежныхСредств.Субконто2))))))) КАК Субконто2,
	|	МАКСИМУМ(ЕСТЬNULL(ПриобретениеУслугПрочихАктивов.Субконто3, ЕСТЬNULL(КорректировкаПриобретения.Субконто3,
	|		ЕСТЬNULL(ВнутреннееПотреблениеТоваров.Субконто3, ЕСТЬNULL(АвансовыйОтчет.Субконто3,
	|		ЕСТЬNULL(ПрочиеДоходы.Субконто3, ЕСТЬNULL(РасходныйКассовыйОрдер.Субконто3, СписаниеБезналичныхДенежныхСредств.Субконто3))))))) КАК Субконто3
	|ПОМЕСТИТЬ СчетаУчетаПрочихАктивов
	|ИЗ
	|	ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПартииНДСКРаспределению КАК ПартииНДСКРаспределениюПриход
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Организация = ПартииНДСКРаспределению.Организация
	|		И ПартииНДСКРаспределениюПриход.Подразделение = ПартииНДСКРаспределению.Подразделение
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = ПартииНДСКРаспределению.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = ПартииНДСКРаспределению.АналитикаАктивовПассивов
	|		И ПартииНДСКРаспределениюПриход.ДокументПоступленияРасходов = ПартииНДСКРаспределению.ДокументПоступленияРасходов
	|		И ПартииНДСКРаспределениюПриход.ВидЦенности = ПартииНДСКРаспределению.ВидЦенности
	|		И ПартииНДСКРаспределениюПриход.Поставщик = ПартииНДСКРаспределению.Поставщик
	|		И ПартииНДСКРаспределениюПриход.НаправлениеДеятельности = ПартииНДСКРаспределению.НаправлениеДеятельности
	|		И ПартииНДСКРаспределениюПриход.СтавкаНДС = ПартииНДСКРаспределению.СтавкаНДС
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.ПриобретениеУслугПрочихАктивов.Расходы КАК ПриобретениеУслугПрочихАктивов
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = ПриобретениеУслугПрочихАктивов.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = ПриобретениеУслугПрочихАктивов.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = ПриобретениеУслугПрочихАктивов.АналитикаАктивовПассивов
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК КорректировкаПриобретения
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = КорректировкаПриобретения.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = КорректировкаПриобретения.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = КорректировкаПриобретения.АналитикаАктивовПассивов
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.ВнутреннееПотреблениеТоваров.Товары КАК ВнутреннееПотреблениеТоваров
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = ВнутреннееПотреблениеТоваров.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = ВнутреннееПотреблениеТоваров.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = ВнутреннееПотреблениеТоваров.АналитикаАктивовПассивов
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.АвансовыйОтчет.ПрочиеРасходы КАК АвансовыйОтчет
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = АвансовыйОтчет.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = АвансовыйОтчет.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = АвансовыйОтчет.АналитикаАктивовПассивов
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.ПрочиеДоходыРасходы.ПрочиеДоходы КАК ПрочиеДоходы
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = ПрочиеДоходы.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = ПрочиеДоходы.СтатьяАктивовПассивов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = ПрочиеДоходы.АналитикаАктивовПассивов
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.РасходныйКассовыйОрдер.РасшифровкаПлатежа КАК РасходныйКассовыйОрдер
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = РасходныйКассовыйОрдер.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = РасходныйКассовыйОрдер.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = РасходныйКассовыйОрдер.АналитикаАктивовПассивов
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СписаниеБезналичныхДенежныхСредств.РасшифровкаПлатежа КАК СписаниеБезналичныхДенежныхСредств
	|	ПО
	|		ПартииНДСКРаспределениюПриход.Регистратор = СписаниеБезналичныхДенежныхСредств.Ссылка
	|		И ПартииНДСКРаспределениюПриход.СтатьяРасходов = СписаниеБезналичныхДенежныхСредств.СтатьяРасходов
	|		И ПартииНДСКРаспределениюПриход.АналитикаАктивовПассивов = СписаниеБезналичныхДенежныхСредств.АналитикаАктивовПассивов
	|	
	|ГДЕ
	|	ПартииНДСКРаспределению.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|	И ПартииНДСКРаспределению.СтатьяОтраженияРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|	И ПартииНДСКРаспределению.НалогообложениеПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииНДСКРаспределению.Организация,
	|	ПартииНДСКРаспределению.Подразделение,
	|	ПартииНДСКРаспределению.СтатьяРасходов,
	|	ПартииНДСКРаспределению.АналитикаАктивовПассивов,
	|	ПартииНДСКРаспределению.ДокументПоступленияРасходов,
	|	ПартииНДСКРаспределению.Поставщик,
	|	ПартииНДСКРаспределению.ВидЦенности,
	|	ПартииНДСКРаспределению.СтавкаНДС,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности";
	СписокЗапросов.Добавить(ТекстЗапроса);
	#КонецОбласти
	
	СписокЗапросов.Добавить(Символы.ПС);
	
	Возврат СтрСоединить(СписокЗапросов, ОбщегоНазначенияУТ.РазделительЗапросовВПакете());
	
КонецФункции

//-- НЕ УТ

// Возвращает признак необходимости распределения НДС по товарам
//
// Параметры:
// 	Организация -  СправочникСсылка.Организации - Организация, в которой выполняется распределение НДС.
// 	Период -  Дата - Период выполнения распределения НДС.
//
// Возвращаемое значение:
// 	Булево - Признак необходимости распределения НДС по товарам.
//
Функция НеобходимоРаспределениеНДСПоТоварам(Организация, Знач Период) Экспорт
	
	Если Не ЗначениеЗаполнено(Период) Тогда
		Период = ТекущаяДатаСеанса();
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	1
	|ИЗ
	|	РегистрНакопления.ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|ГДЕ
	|	ПартииНДСКРаспределению.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ПартииНДСКРаспределению.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ПартииНДСКРаспределению.Организация = &Организация
	|	И ПартииНДСКРаспределению.СтатьяРасходов = НЕОПРЕДЕЛЕНО
	|	И ПартииНДСКРаспределению.НДСРегл <> 0
	|";
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоКвартала(Период));
	Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(Период));
	
	Результат = НЕ Запрос.Выполнить().Пустой();
	
	Возврат Результат;
	
КонецФункции

// Возвращает признак необходимости распределения НДС за период
//
// Параметры:
// 	Организация -  СправочникСсылка.Организации - Организация, в которой выполняется распределение НДС.
// 	Период -  Дата - Период выполнения распределения НДС.
//
// Возвращаемое значение:
// 	Результат - Булево - Признак необходимости распределения НДС.
//
Функция НеобходимоРаспределениеНДС(Организация, Знач Период) Экспорт
	
	Если Не ЗначениеЗаполнено(Период) Тогда
		Период = ТекущаяДатаСеанса();
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ ПЕРВЫЕ 1 
	|	1
	|ИЗ
	|	РегистрНакопления.ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|ГДЕ
	|	ПартииНДСКРаспределению.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ПартииНДСКРаспределению.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ПартииНДСКРаспределению.Организация = &Организация
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ ПЕРВЫЕ 1
	|	ПартииНДСКРаспределениюОстатки.Организация
	|ИЗ
	|	РегистрНакопления.ПартииНДСКРаспределению.Остатки(
	|			&НачалоПериода,
	|			Организация = &Организация) КАК ПартииНДСКРаспределениюОстатки
	|";
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоКвартала(Период));
	Запрос.УстановитьПараметр("КонецПериода", КонецКвартала(Период));
	
	Результат = НЕ Запрос.Выполнить().Пустой();
	
	Возврат Результат;
	
КонецФункции

// Возвращают данные для оценки возможности применения "правила 5%"
//
// Параметры:
// 	 МассивОрганизаций - Массив, СправочникСсылка.Организация - организации, для которых надо выполнить оценку
// 	 Период - Дата - квартал для оценки.
//
// Возвращаемое значение:
// 	 Оценка - Таблица значений с колонками
//		* Организация - СправочникСсылка.Организации
// 	 	* РасходыПоДеятельностиНеОблагаемойНДС - Число - Расходы по реализации не облагаемой НДС.
// 		* РасходыВсего - Число - Обшая сумма расходов.
// 		* Доля - Число - Процент расходов, относящихся к реализации не облагаемой НДС.
//
Функция ОценкаПримененияПравила5Процентов(МассивОрганизаций, Период) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	АналитикаУчета.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА СебестоимостьПродаж.НалогообложениеНДС В (ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС), ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД))
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК НеОблагаетсяНДС,
	|	СУММА(СебестоимостьПродаж.СтоимостьРегл 
	|		+ СебестоимостьПродаж.ДопРасходыРегл 
	|		+ СебестоимостьПродаж.ТрудозатратыРегл 
	|		+ СебестоимостьПродаж.ПостатейныеПостоянныеРегл
	|		+ СебестоимостьПродаж.ПостатейныеПеременныеРегл) КАК Себестоимость
	|ПОМЕСТИТЬ СебестоимостьПродаж
	|ИЗ
	|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК СебестоимостьПродаж
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		Справочник.КлючиАналитикиУчетаПоПартнерам КАК АналитикаУчета
	|	ПО 
	|		СебестоимостьПродаж.АналитикаУчетаПоПартнерам = АналитикаУчета.Ссылка
	|ГДЕ
	|	СебестоимостьПродаж.Период МЕЖДУ НАЧАЛОПЕРИОДА(&Период, КВАРТАЛ) И КОНЕЦПЕРИОДА(&Период, КВАРТАЛ)
	|	И АналитикаУчета.Организация В(&МассивОрганизаций)
	|	И СебестоимостьПродаж.СтоимостьРегл <> 0
	|	И СебестоимостьПродаж.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга))
	|
	|СГРУППИРОВАТЬ ПО
	|	АналитикаУчета.Организация,
	|	ВЫБОР
	|		КОГДА СебестоимостьПродаж.НалогообложениеНДС В (ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС), ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД))
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СебестоимостьПродаж.Организация КАК Организация,
	|	СебестоимостьПродаж.РасходыПоДеятельностиНеОблагаемойНДС КАК РасходыПоДеятельностиНеОблагаемойНДС,
	|	СебестоимостьПродаж.РасходыВсего КАК РасходыВсего,
	|	ВЫБОР
	|		КОГДА СебестоимостьПродаж.РасходыВсего = 0
	|			ТОГДА 0
	|		ИНАЧЕ 100 * СебестоимостьПродаж.РасходыПоДеятельностиНеОблагаемойНДС / СебестоимостьПродаж.РасходыВсего
	|	КОНЕЦ КАК Доля
	|ИЗ
	|	(ВЫБРАТЬ
	|		Организации.Ссылка КАК Организация,
	|		ЕСТЬNULL(СУММА(ВЫБОР
	|					КОГДА СебестоимостьПродаж.НеОблагаетсяНДС
	|						ТОГДА СебестоимостьПродаж.Себестоимость
	|					ИНАЧЕ 0
	|				КОНЕЦ), 0) КАК РасходыПоДеятельностиНеОблагаемойНДС,
	|		ЕСТЬNULL(СУММА(СебестоимостьПродаж.Себестоимость), 0) КАК РасходыВсего
	|	ИЗ
	|		Справочник.Организации КАК Организации
	|			ЛЕВОЕ СОЕДИНЕНИЕ СебестоимостьПродаж КАК СебестоимостьПродаж
	|			ПО Организации.Ссылка = СебестоимостьПродаж.Организация
	|	ГДЕ
	|		Организации.Ссылка В(&МассивОрганизаций)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Организации.Ссылка) КАК СебестоимостьПродаж";
	
	Запрос.УстановитьПараметр("Период", Период);
	Запрос.УстановитьПараметр("МассивОрганизаций", ОбщегоНазначенияУТКлиентСервер.Массив(МассивОрганизаций));
	
	Результат = Запрос.Выполнить().Выгрузить();
	Результат.Индексы.Добавить("Организация");
	
	Возврат Результат;
	
КонецФункции

// Выполняет распределение НДС за указанный период в указанных организациях. Предназначена для вызова в рамках.
//
// Параметры:
//	Период - Дата - месяц, за который необходимо создать документы РаспределениеНДС.
//	Организация - Массив, СправочникСсылка.Организации, Неопределено - отбор организаций, по которым создаются документы.
//		Если передан пустой параметр, то документы будут созданы по всем организациям.
//	ИмяСобытияЖР - Строка - имя события об ошибке для записи журнала регистрации
//	МенеджерВТКэшейРегистров - МенеджерВременныхТаблиц - содержит кэш оборотов/остатков регистров.
//		Используется только при вызове этого метода в ходе выполнения расчета механизмом партионного учета версии 2.2.
//	ИдетРасчетСебестоимости - Булево - признак вызова распределения НДС из механизма расчета партий и себестоимости.
//
// Возвращаемое значение:
//		Структура - результат распределения НДС; ключи структуры
//		  - МассивДокументов - Массив - ссылки на все обработанные документы распределения НДС (независимо от наличия в них ошибок)
//		  - РассчитанныеОрганизации - Массив - ссылки на организации, по которым распределение НДС было выполнено без ошибок
//		  - ТекстОшибки - Строка - текст всех ошибок, зафиксированных при распределении НДС.
//
Функция РаспределитьНДС(Период, Организация, ИмяСобытияЖР = "", МенеджерВТКэшейРегистров = Неопределено, ИдетРасчетСебестоимости = Ложь) Экспорт
	
	РезультатРаспределенияНДС = Новый Структура;
	РезультатРаспределенияНДС.Вставить("МассивДокументов", 		  Новый Массив);
	РезультатРаспределенияНДС.Вставить("РассчитанныеОрганизации", Новый Массив);
	РезультатРаспределенияНДС.Вставить("ТекстОшибки", 	   		  "");
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ДанныеСправочника.Ссылка КАК Организация
	|ПОМЕСТИТЬ ВТОрганизации
	|ИЗ
	|	Справочник.Организации КАК ДанныеСправочника
	|ГДЕ
	|	(ДанныеСправочника.Ссылка В (&МассивОрганизаций)
	|		ИЛИ &ПоВсемОрганизациям)
	|	И (ДанныеСправочника.Ссылка <> ЗНАЧЕНИЕ(Справочник.Организации.УправленческаяОрганизация)
	|		ИЛИ &УчитыватьУпрОрганизацию)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТОрганизации.Организация	 	 КАК Организация,
	|	МАКСИМУМ(ЕСТЬNULL(РаспределениеНДСПроведен.Ссылка, РаспределениеНДССоздан.Ссылка)) КАК Документ
	|ИЗ
	|	ВТОрганизации КАК ВТОрганизации
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РаспределениеНДС КАК РаспределениеНДСПроведен
	|		ПО ВТОрганизации.Организация = РаспределениеНДСПроведен.Организация
	|			И РаспределениеНДСПроведен.Проведен
	|			И РаспределениеНДСПроведен.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РаспределениеНДС КАК РаспределениеНДССоздан
	|		ПО ВТОрганизации.Организация = РаспределениеНДССоздан.Организация
	|			И НЕ РаспределениеНДССоздан.ПометкаУдаления
	|			И РаспределениеНДССоздан.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|	
	|СГРУППИРОВАТЬ ПО
	|	ВТОрганизации.Организация
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация";
	
	Запрос.УстановитьПараметр("ДатаНачала",    			 НачалоМесяца(Период));
	Запрос.УстановитьПараметр("ДатаОкончания", 			 КонецМесяца(Период));
	Запрос.УстановитьПараметр("УчитыватьУпрОрганизацию", ПолучитьФункциональнуюОпцию("ИспользоватьУправленческуюОрганизацию"));
	Запрос.УстановитьПараметр("МассивОрганизаций",  	 ОбщегоНазначенияУТКлиентСервер.Массив(Организация));
	Запрос.УстановитьПараметр("ПоВсемОрганизациям", 	 НЕ ЗначениеЗаполнено(Организация));
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	ОшибкиДатЗапретаИзменения = "";
	ОшибкиПроверкиЗаполнения  = "";
	ОшибкиПроведения		  = "";
	
	Пока Выборка.Следующий() Цикл 
		
		Состояние = ЗакрытиеМесяцаСервер.ОпределитьСостояниеЭтаповРасчета(
			Перечисления.ОперацииЗакрытияМесяца.РаспределениеНДС,
			Период,
			Выборка.Организация,
			НЕ ИдетРасчетСебестоимости,
			,
			Перечисления.ОперацииЗакрытияМесяца.РаспределениеНДС);
		
		Если Состояние <> Перечисления.СостоянияОперацийЗакрытияМесяца.НеВыполнено
		 И Состояние <> Перечисления.СостоянияОперацийЗакрытияМесяца.ВыполненоСОшибками Тогда
			Продолжить;
		КонецЕсли;
		
		ПараметрыРегистрации = ЗакрытиеМесяцаСервер.ИнициализироватьПараметрыРегистрацииПроблемыРасчета(
			?(ИдетРасчетСебестоимости,
				Перечисления.ОперацииЗакрытияМесяца.РасчетПартийИСебестоимости,
				Перечисления.ОперацииЗакрытияМесяца.РаспределениеНДС),
			Выборка.Организация,
			НачалоМесяца(Период));
			
		ТекстРегистрацииОшибки = СтрЗаменить(
			НСтр("ru='При %операция% по организации ""%1"" за период %2 были диагностированы ошибки'"),
			"%операция%",
			?(ИдетРасчетСебестоимости, НСтр("ru='распределении НДС'"), НСтр("ru='выполнении расчета'")));
			
		НачатьТранзакцию();
		
		Попытка
		
			Если НЕ ЗначениеЗаполнено(Выборка.Документ) Тогда
				
				ДокументОбъект = Документы.РаспределениеНДС.СоздатьДокумент();
				ДокументОбъект.Дата 		 = КонецМесяца(Период);
				ДокументОбъект.Организация 	 = Выборка.Организация;
				ДокументОбъект.НачалоПериода = ПолучитьНачалоРасширенногоНалоговогоПериода(Период, Выборка.Организация);
				ДокументОбъект.Ответственный = Пользователи.ТекущийПользователь();
				
				ПравилаСписанияНДС = Документы.РаспределениеНДС.ЗаполнитьПравилаСписанияНДС(Выборка.Организация);
				ЗаполнитьЗначенияСвойств(ДокументОбъект, ПравилаСписанияНДС);
				
			Иначе
				
				Блокировка = Новый БлокировкаДанных;
				ЭлементБлокировки = Блокировка.Добавить("Документ.РаспределениеНДС");
				ЭлементБлокировки.УстановитьЗначение("Ссылка", Выборка.Документ);
				Блокировка.Заблокировать();
				
				ДокументОбъект = Выборка.Документ.ПолучитьОбъект();
				
			КонецЕсли;
		
			// Проверим, что документ находится в доступном для изменения периоде.
			ОписаниеОшибкиДаты = "";
			
			Если ДатыЗапретаИзменения.ИзменениеЗапрещено(ДокументОбъект, , ОписаниеОшибкиДаты) Тогда
				
				ОшибкиДатЗапретаИзменения = ОшибкиДатЗапретаИзменения + ?(ОшибкиДатЗапретаИзменения = "", "", "
					|") + РасчетСебестоимостиПротоколРасчета.ПредставлениеМногострочногоТекста(ОписаниеОшибкиДаты);
				
				ЗакрытиеМесяцаСервер.ЗарегистрироватьПроблемуВыполненияРасчета(
					ПараметрыРегистрации,
					ТекстРегистрацииОшибки,
					,
					ОписаниеОшибкиДаты);
				
				ОтменитьТранзакцию();
				
				Продолжить;
				
			КонецЕсли;
			
			// Заполним дополнительные свойства документа.
			ДокументОбъект.ДополнительныеСвойства.Вставить("РегламентныеОперации");
			
			РасчетСебестоимостиПрикладныеАлгоритмы.УстановитьПризнакВыполненияРасчетаПартийИСебестоимости(ДокументОбъект);
			
			Если МенеджерВТКэшейРегистров <> Неопределено Тогда
				// Вызвано из партионного учета версии 2.2.
				ДокументОбъект.ДополнительныеСвойства.Вставить("МенеджерВТКэшейРегистров", МенеджерВТКэшейРегистров);
				ДокументОбъект.ДополнительныеСвойства.Вставить("ПериодРасчетаПартий", 	   Период);
			КонецЕсли;
			
			Если НЕ ДокументОбъект.БазаРаспределенияУстанавливаетсяВручную Тогда
				
				Результат = Документы.РаспределениеНДС.ПолучитьБазуРаспределения(ДокументОбъект.Дата, ДокументОбъект.НачалоПериода, ДокументОбъект.Организация);
				
				ЗаполнитьЗначенияСвойств(
					ДокументОбъект, 
					Результат, 
					"ВыручкаНДС, ВыручкаНеРФ, ВыручкаНеНДС, ВыручкаЕНВД, ВыручкаНДС0, ВыручкаНДС0НесырьевыеТовары, ВыручкаНДС0СырьевыеТоварыУслуги");
					
				ДокументОбъект.ДокументыЭкспорт.Загрузить(Результат.ДокументыЭкспорт);
				
			КонецЕсли;
			
			Если ДокументОбъект.ЭтоНовый() Тогда
				// Регламентный документ должен остаться в ИБ независимо от того, удастся его провести или нет.
				ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
			КонецЕсли;
			
			// Проверим корректность заполнения документа.
			СообщенияПроверки = РасчетСебестоимостиПрикладныеАлгоритмы.ПроверитьЗаполнениеОбъектаСПерехватомСообщений(ДокументОбъект);
			
			Если ЗначениеЗаполнено(СообщенияПроверки) Тогда
				
				// Проверка заполнения документа обнаружила ошибки.
				ОшибкиПроверкиЗаполнения = ОшибкиПроверкиЗаполнения	+ ?(ОшибкиПроверкиЗаполнения = "", "", "
					|") + СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
							НСтр("ru = 'При проверке документа ""%1"" были обнаружены ошибки:
								|%2'"),
							СокрЛП(ДокументОбъект),
							РасчетСебестоимостиПротоколРасчета.ПредставлениеМногострочногоТекста(СообщенияПроверки, " - "));
				
				ЗакрытиеМесяцаСервер.ЗарегистрироватьПроблемуВыполненияРасчета(
					ПараметрыРегистрации,
					ТекстРегистрацииОшибки,
					,
					ОшибкиПроверкиЗаполнения,
					ДокументОбъект.Ссылка);
				
			Иначе
				ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
				РезультатРаспределенияНДС.РассчитанныеОрганизации.Добавить(Выборка.Организация); // распределение выполнено успешно
			КонецЕсли;
			
			РезультатРаспределенияНДС.МассивДокументов.Добавить(ДокументОбъект.Ссылка);
			
			ЗафиксироватьТранзакцию();
			
		Исключение
			
			ОтменитьТранзакцию();
			
			ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			ОшибкиПроведения = ОшибкиПроведения + ?(ОшибкиПроведения = "", "", "
				|") + ТекстОшибки;
			
			ЗакрытиеМесяцаСервер.ЗарегистрироватьПроблемуВыполненияРасчета(
				ПараметрыРегистрации,
				ТекстРегистрацииОшибки,
				,
				ТекстОшибки);
			
		КонецПопытки;
		
	КонецЦикла;
	
	// Обработаем информацию об ошибках.
	Если ЗначениеЗаполнено(ОшибкиДатЗапретаИзменения)
	 ИЛИ ЗначениеЗаполнено(ОшибкиПроверкиЗаполнения)
	 ИЛИ ЗначениеЗаполнено(ОшибкиПроведения) Тогда
		
		РезультатРаспределенияНДС.ТекстОшибки = ОшибкиДатЗапретаИзменения;
		
		РезультатРаспределенияНДС.ТекстОшибки =
			?(РезультатРаспределенияНДС.ТекстОшибки = "", "", РезультатРаспределенияНДС.ТекстОшибки + "
				|") + ОшибкиПроверкиЗаполнения;
		
		РезультатРаспределенияНДС.ТекстОшибки =
			?(РезультатРаспределенияНДС.ТекстОшибки = "", "", РезультатРаспределенияНДС.ТекстОшибки + "
				|") + ОшибкиПроведения;
		
		Если ЗначениеЗаполнено(ИмяСобытияЖР) Тогда
			
			ТекстДляЖурнала = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Не удалось выполнить распределение НДС по причине:
					|%1'"),
				РезультатРаспределенияНДС.ТекстОшибки);
			
			ЗаписьЖурналаРегистрации(
				ИмяСобытияЖР,
				УровеньЖурналаРегистрации.Ошибка,
				Метаданные.Документы.РаспределениеНДС,
				,
				ТекстДляЖурнала);
			
		КонецЕсли;
		
 	КонецЕсли;
	
	Возврат РезультатРаспределенияНДС;
	
КонецФункции

Процедура СформироватьЗадание(ПараметрыЗадания) Экспорт
	
	Запись = РегистрыСведений.ЗаданияКЗакрытиюМесяца.СоздатьМенеджерЗаписи();
	ЗаполнитьЗначенияСвойств(Запись, ПараметрыЗадания);
	Запись.Операция = Перечисления.ОперацииЗакрытияМесяца.РаспределениеНДС;
	Запись.НомерЗадания = Константы.НомерЗаданияКЗакрытиюМесяца.Получить();
	Запись.Записать();
	
КонецПроцедуры

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Организация)";

КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Проведение

Функция ДополнительныеИсточникиДанныхДляДвижений(ИмяРегистра) Экспорт

	ИсточникиДанных = Новый Соответствие;

	Возврат ИсточникиДанных; 

КонецФункции

Процедура ИнициализироватьДанныеДокумента(ДокументСсылка, ДополнительныеСвойства, Регистры = Неопределено) Экспорт
	
	Если Регистры <> Неопределено Тогда
		ПроведениеСерверУТ.ЗапретВыборочногоПроведенияПоРегистрам(ДокументСсылка);
	КонецЕсли;
	
	Запрос = Новый Запрос;
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ДанныеДокумента.Ссылка							КАК Ссылка,
	|	ДанныеДокумента.Дата							КАК Период,
	|	ДанныеДокумента.НачалоПериода					КАК НачалоПериода,
	|	КОНЕЦПЕРИОДА(ДанныеДокумента.Дата, МЕСЯЦ)		КАК ПериодБазы,
	|	ДанныеДокумента.Организация						КАК Организация,
	|	ДанныеДокумента.ВыручкаНДС						КАК ВыручкаНДС,
	|	ДанныеДокумента.ВыручкаНеНДС					КАК ВыручкаНеНДС,
	|	ДанныеДокумента.ВыручкаЕНВД						КАК ВыручкаЕНВД,
	|	ДанныеДокумента.ВыручкаНДС0						КАК ВыручкаНДС0,
	|	ДанныеДокумента.ВыручкаНДС0СырьевыеТоварыУслуги	КАК ВыручкаНДС0СырьевыеТоварыУслуги,
	|	ДанныеДокумента.ВыручкаНДС0НесырьевыеТовары		КАК ВыручкаНДС0НесырьевыеТовары,
	|	ДанныеДокумента.СтатьяРасходовНеНДС				КАК СтатьяРасходовНеНДС,
	|	ДанныеДокумента.АналитикаРасходовНеНДС			КАК АналитикаРасходовНеНДС,
	|	ДанныеДокумента.СтатьяРасходовЕНВД				КАК СтатьяРасходовЕНВД,
	|	ДанныеДокумента.АналитикаРасходовЕНВД			КАК АналитикаРасходовЕНВД,
	|	ДанныеДокумента.СписатьНДСПоРасходамАктивамНаСтатьиОтражения КАК СписатьНДСПоРасходамАктивамНаСтатьиОтражения,
	|	ДанныеДокумента.ПрименитьПравило5Процентов		КАК ПрименитьПравило5Процентов
	|ИЗ
	|	Документ.РаспределениеНДС КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", ДокументСсылка);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Выборка.Следующий();
	
	Реквизиты = Новый Структура;
	Реквизиты.Вставить("Ссылка", Выборка.Ссылка);
	Реквизиты.Вставить("Период", Выборка.Период);
	Реквизиты.Вставить("ПериодБазы", Выборка.ПериодБазы);
	Реквизиты.Вставить("Организация", Выборка.Организация);
	Реквизиты.Вставить("ВыручкаНДС", Выборка.ВыручкаНДС);
	Реквизиты.Вставить("ВыручкаНеНДС", Выборка.ВыручкаНеНДС);
	Реквизиты.Вставить("ВыручкаЕНВД", Выборка.ВыручкаЕНВД);
	Реквизиты.Вставить("ВыручкаНДС0", Выборка.ВыручкаНДС0);
	Реквизиты.Вставить("ВыручкаНДС0СырьевыеТоварыУслуги", Выборка.ВыручкаНДС0СырьевыеТоварыУслуги);
	Реквизиты.Вставить("ВыручкаНДС0НесырьевыеТовары", Выборка.ВыручкаНДС0НесырьевыеТовары);
	Реквизиты.Вставить("СтатьяРасходовНеНДС", Выборка.СтатьяРасходовНеНДС);
	Реквизиты.Вставить("АналитикаРасходовНеНДС", Выборка.АналитикаРасходовНеНДС);
	Реквизиты.Вставить("СтатьяРасходовЕНВД", Выборка.СтатьяРасходовЕНВД);
	Реквизиты.Вставить("АналитикаРасходовЕНВД", Выборка.АналитикаРасходовЕНВД);
	Реквизиты.Вставить("СписатьНДСПоРасходамАктивамНаСтатьиОтражения", Выборка.СписатьНДСПоРасходамАктивамНаСтатьиОтражения);
	Реквизиты.Вставить("ПрименитьПравило5Процентов", Выборка.ПрименитьПравило5Процентов);
	
	ПериодОкончание = КонецКвартала(Выборка.Период);
	//++ НЕ УТ
	Если Месяц(Выборка.Период)%3 <> 0 Тогда
		ПериодОкончание = КонецМесяца(Выборка.Период);
	КонецЕсли;
	//-- НЕ УТ
	Реквизиты.Вставить("ВыборкаПоКварталу", (Месяц(Выборка.Период)%3=0));
	Реквизиты.Вставить("ПериодНачало",    Выборка.НачалоПериода);
	Реквизиты.Вставить("ПериодОкончание", ПериодОкончание);
	
	ПараметрыУчетнойПолитики = РегистрыСведений.УчетнаяПолитикаОрганизаций.ПараметрыУчетнойПолитики(Выборка.Организация, ПериодОкончание);
	Реквизиты.Вставить("РаздельныйУчетПостатейныхПроизводственныхЗатратПоНалогообложениюНДС",
		ПараметрыУчетнойПолитики.РаздельныйУчетПостатейныхПроизводственныхЗатратПоНалогообложениюНДС);
	
	СформироватьДвижения(Реквизиты, ДополнительныеСвойства);
	
КонецПроцедуры

Функция ДанныеДляРаспределения(Реквизиты, ДополнительныеСвойства)
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("ВыборкаПоКварталу",  Реквизиты.ВыборкаПоКварталу);
	Запрос.УстановитьПараметр("Период",             Реквизиты.Период);
	Запрос.УстановитьПараметр("ПериодБазы",         Реквизиты.ПериодБазы);
	Запрос.УстановитьПараметр("ПериодНачало",       Реквизиты.ПериодНачало);
	Запрос.УстановитьПараметр("ПериодОкончание",    Реквизиты.ПериодОкончание);
	Запрос.УстановитьПараметр("Организация",        Реквизиты.Организация);
	Запрос.УстановитьПараметр("Граница",            Новый Граница(Реквизиты.ПериодОкончание, ВидГраницы.Включая));
	Запрос.УстановитьПараметр("ДокументСсылка",     Реквизиты.Ссылка);
	Запрос.УстановитьПараметр("РаздельныйУчетПостатейныхПроизводственныхЗатратПоНалогообложениюНДС", 
		Реквизиты.РаздельныйУчетПостатейныхПроизводственныхЗатратПоНалогообложениюНДС);
	
	Если ДополнительныеСвойства.Свойство("МенеджерВТКэшейРегистров") Тогда
		
		// Вызвано из партионного учета версии 2.2.
		// Необходимо скорректировать остатки на конец периода:
		// вычесть из них "расчетные" движения, хранящиеся в ИБ (результаты прошлого расчета партий)
		// и добавить "расчетные" движения, хранящиеся во временной таблице (результаты выполняющего сейчас расчета партий).
		
		Запрос.МенеджерВременныхТаблиц = ДополнительныеСвойства.МенеджерВТКэшейРегистров; // содержит ВТКэшПартииНДСКРаспределению
		
		// Период расчета партий (месяц) может отличаться от периода выборки данных для распределения (месяц или квартал).
		Запрос.УстановитьПараметр("НачалоПериодаРасчетаПартий", НачалоМесяца(ДополнительныеСвойства.ПериодРасчетаПартий));
		Запрос.УстановитьПараметр("КонецПериодаРасчетаПартий",  КонецМесяца(ДополнительныеСвойства.ПериодРасчетаПартий));
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ТОГДА -1
		|		ИНАЧЕ 1
		|	КОНЕЦ                         КАК Знак,
		|	Т.Организация                 КАК Организация,
		|	Т.Подразделение               КАК Подразделение,
		|	Т.СтатьяРасходов              КАК СтатьяРасходов,
		|	Т.АналитикаРасходов           КАК АналитикаРасходов,
		|	Т.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
		|	Т.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
		|	Т.Поставщик                   КАК Поставщик,
		|	Т.ВидЦенности                 КАК ВидЦенности,
		|	Т.НаправлениеДеятельности     КАК НаправлениеДеятельности,
		|	Т.СтавкаНДС                   КАК СтавкаНДС,
		|	Т.ВидДеятельностиНДС          КАК ВидДеятельностиНДС,
		|	Т.СтоимостьРегл               КАК СтоимостьРегл,
		|	Т.НДСРегл                     КАК НДСРегл,
		|	Т.НДСУпр                      КАК НДСУпр
		|ПОМЕСТИТЬ ВТКорректировкаОстатковПартииНДСКРаспределению
		|ИЗ
		|	РегистрНакопления.ПартииНДСКРаспределению КАК Т
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериодаРасчетаПартий И &КонецПериодаРасчетаПартий
		|	И Т.Организация = &Организация
		|	И Т.Активность
		|	И Т.РасчетПартий
		|	И Т.Регистратор <> &ДокументСсылка
		|	И (Т.СтоимостьРегл <> 0 
		|		ИЛИ Т.НДСРегл <> 0)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР КОГДА Т.СлужебноеВидДвиженияПриход
		|		ТОГДА 1
		|		ИНАЧЕ -1
		|	КОНЕЦ                         КАК Знак,
		|	Т.Организация                 КАК Организация,
		|	Т.Подразделение               КАК Подразделение,
		|	Т.СтатьяРасходов              КАК СтатьяРасходов,
		|	Т.АналитикаРасходов           КАК АналитикаРасходов,
		|	Т.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
		|	Т.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
		|	Т.Поставщик                   КАК Поставщик,
		|	Т.ВидЦенности                 КАК ВидЦенности,
		|	Т.НаправлениеДеятельности     КАК НаправлениеДеятельности,
		|	Т.СтавкаНДС                   КАК СтавкаНДС,
		|	Т.ВидДеятельностиНДС          КАК ВидДеятельностиНДС,
		|	Т.СтоимостьРегл               КАК СтоимостьРегл,
		|	Т.НДСРегл                     КАК НДСРегл,
		|	Т.НДСУпр                      КАК НДСУпр
		|ИЗ
		|	ВТКэшПартииНДСКРаспределению КАК Т
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериодаРасчетаПартий И &КонецПериодаРасчетаПартий
		|	И Т.Организация = &Организация
		|	И Т.РасчетПартий
		|	И Т.Регистратор <> &ДокументСсылка
		|	И (Т.СтоимостьРегл <> 0 
		|		ИЛИ Т.НДСРегл <> 0)";
		
	Иначе
		
		// Вызвано не из партионного учета версии 2.2.
		// Корректировать остатки на конец периода не надо - "расчетные" движения хранятся только в ИБ.
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	0                             КАК Знак,
		|	Т.Организация                 КАК Организация,
		|	Т.Подразделение               КАК Подразделение,
		|	Т.СтатьяРасходов              КАК СтатьяРасходов,
		|	Т.АналитикаРасходов           КАК АналитикаРасходов,
		|	Т.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
		|	Т.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
		|	Т.Поставщик                   КАК Поставщик,
		|	Т.ВидЦенности                 КАК ВидЦенности,
		|	Т.НаправлениеДеятельности     КАК НаправлениеДеятельности,
		|	Т.СтавкаНДС                   КАК СтавкаНДС,
		|	Т.ВидДеятельностиНДС          КАК ВидДеятельностиНДС,
		|	Т.СтоимостьРегл               КАК СтоимостьРегл,
		|	Т.НДСРегл                     КАК НДСРегл,
		|	Т.НДСУпр                      КАК НДСУпр
		|ПОМЕСТИТЬ ВТКорректировкаОстатковПартииНДСКРаспределению
		|ИЗ
		|	РегистрНакопления.ПартииНДСКРаспределению КАК Т";
		
	КонецЕсли;
	
	Запрос.Выполнить(); // формируется ВТКорректировкаОстатковПартииНДСКРаспределению
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КОНЕЦПЕРИОДА(ЕСТЬNULL(ДанныеОснованияКорректировки.ДатаРегистратора, &ПериодБазы), КВАРТАЛ)  КАК ПериодБазы,
	|	КорректировкаПриобретения.ДокументОснование  КАК ОснованиеКорректировки,
	|	ПартииНДСКРаспределению.Организация  КАК Организация,
	|	ПартииНДСКРаспределению.Подразделение  КАК Подразделение,
	|	ПартииНДСКРаспределению.СтатьяРасходов  КАК СтатьяРасходов,
	|	ПартииНДСКРаспределению.АналитикаРасходов  КАК АналитикаРасходов,
	|	ПартииНДСКРаспределению.АналитикаАктивовПассивов  КАК АналитикаАктивовПассивов,
	|	ПартииНДСКРаспределению.ДокументПоступленияРасходов  КАК ДокументПоступленияРасходов,
	|	ПартииНДСКРаспределению.Поставщик КАК Поставщик,
	|	ПартииНДСКРаспределению.ВидЦенности КАК ВидЦенности,
	|	ПартииНДСКРаспределению.НаправлениеДеятельности  КАК НаправлениеДеятельности,
	|	ПартииНДСКРаспределению.СтавкаНДС КАК СтавкаНДС,
	|	ПартииНДСКРаспределению.ВидДеятельностиНДС  КАК ВидДеятельностиНДС
	|ПОМЕСТИТЬ ПартииНДСКРаспределениюКорректировка
	|ИЗ
	|	РегистрНакопления.ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК КорректировкаПриобретения
	|	ПО
	|		ПартииНДСКРаспределению.Регистратор = КорректировкаПриобретения.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеОснованияКорректировки
	|	ПО
	|		КорректировкаПриобретения.Организация = ДанныеОснованияКорректировки.Организация
	|		И КорректировкаПриобретения.ДокументОснование = ДанныеОснованияКорректировки.Документ
	|ГДЕ
	|	ПартииНДСКРаспределению.Период МЕЖДУ &ПериодНачало И &ПериодОкончание 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументПоступленияРасходов
	|;
	|
	|//////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.Организация                   КАК Организация,
	|	Т.Подразделение                 КАК Подразделение,
	|	Т.СтатьяРасходов                КАК СтатьяРасходов,
	|	Т.АналитикаРасходов             КАК АналитикаРасходов,
	|	Т.АналитикаАктивовПассивов      КАК АналитикаАктивовПассивов,
	|	Т.ДокументПоступленияРасходов   КАК ДокументПоступленияРасходов,
	|	Т.Поставщик                     КАК Поставщик,
	|	Т.ВидЦенности                   КАК ВидЦенности,
	|	Т.НаправлениеДеятельности       КАК НаправлениеДеятельности,
	|	Т.СтавкаНДС                     КАК СтавкаНДС,
	|	Т.ВидДеятельностиНДС            КАК ВидДеятельностиНДС,
	|	СУММА(Т.Знак * Т.СтоимостьРегл) КАК СтоимостьРегл,
	|	СУММА(Т.Знак * Т.НДСРегл)       КАК НДСРегл,
	|	СУММА(Т.Знак * Т.НДСУпр)        КАК НДСУпр
	|ПОМЕСТИТЬ ПартииНДСКРаспределениюОстатки
	|ИЗ
	|	(ВЫБРАТЬ
	|		1 							  КАК Знак,
	|		Т.Организация                 КАК Организация,
	|		Т.Подразделение               КАК Подразделение,
	|		Т.СтатьяРасходов              КАК СтатьяРасходов,
	|		Т.АналитикаРасходов           КАК АналитикаРасходов,
	|		Т.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
	|		Т.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|		Т.Поставщик                   КАК Поставщик,
	|		Т.ВидЦенности                 КАК ВидЦенности,
	|		Т.НаправлениеДеятельности     КАК НаправлениеДеятельности,
	|		Т.СтавкаНДС                   КАК СтавкаНДС,
	|		Т.ВидДеятельностиНДС          КАК ВидДеятельностиНДС,
	|		Т.СтоимостьРеглОстаток        КАК СтоимостьРегл,
	|		Т.НДСРеглОстаток              КАК НДСРегл,
	|		Т.НДСУпрОстаток               КАК НДСУпр
	|	ИЗ
	|		РегистрНакопления.ПартииНДСКРаспределению.Остатки(&Граница, Организация = &Организация) КАК Т
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		-1 							  КАК Знак,
	|		Т.Организация                 КАК Организация,
	|		Т.Подразделение               КАК Подразделение,
	|		Т.СтатьяРасходов              КАК СтатьяРасходов,
	|		Т.АналитикаРасходов           КАК АналитикаРасходов,
	|		Т.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
	|		Т.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|		Т.Поставщик                   КАК Поставщик,
	|		Т.ВидЦенности                 КАК ВидЦенности,
	|		Т.НаправлениеДеятельности     КАК НаправлениеДеятельности,
	|		Т.СтавкаНДС                   КАК СтавкаНДС,
	|		Т.ВидДеятельностиНДС          КАК ВидДеятельностиНДС,
	|		Т.СтоимостьРеглОборот		  КАК СтоимостьРегл,
	|		Т.НДСРеглОборот			  	  КАК НДСРегл,
	|		Т.НДСУпрОборот                КАК НДСУпр
	|	ИЗ
	|		РегистрНакопления.ПартииНДСКРаспределению.Обороты(&ПериодНачало, &ПериодОкончание,
	|			Регистратор, Организация = &Организация) КАК Т
	|	ГДЕ
	|		Т.Регистратор = &ДокументСсылка
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.Знак						  КАК Знак,
	|		Т.Организация                 КАК Организация,
	|		Т.Подразделение               КАК Подразделение,
	|		Т.СтатьяРасходов              КАК СтатьяРасходов,
	|		Т.АналитикаРасходов           КАК АналитикаРасходов,
	|		Т.АналитикаАктивовПассивов    КАК АналитикаАктивовПассивов,
	|		Т.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|		Т.Поставщик                   КАК Поставщик,
	|		Т.ВидЦенности                 КАК ВидЦенности,
	|		Т.НаправлениеДеятельности     КАК НаправлениеДеятельности,
	|		Т.СтавкаНДС                   КАК СтавкаНДС,
	|		Т.ВидДеятельностиНДС          КАК ВидДеятельностиНДС,
	|		Т.СтоимостьРегл		  		  КАК СтоимостьРегл,
	|		Т.НДСРегл			  	  	  КАК НДСРегл,
	|		Т.НДСУпр			  	  	  КАК НДСУпр
	|	ИЗ
	|		ВТКорректировкаОстатковПартииНДСКРаспределению КАК Т
	|	
	|	) КАК Т
	|
	|СГРУППИРОВАТЬ ПО
	|	Т.Организация,
	|	Т.Подразделение,
	|	Т.СтатьяРасходов,
	|	Т.АналитикаРасходов,
	|	Т.АналитикаАктивовПассивов,
	|	Т.ДокументПоступленияРасходов,
	|	Т.Поставщик,
	|	Т.ВидЦенности,
	|	Т.НаправлениеДеятельности,
	|	Т.СтавкаНДС,
	|	Т.ВидДеятельностиНДС
	|
	|ИМЕЮЩИЕ
	|	СУММА(Т.Знак * Т.СтоимостьРегл) <> 0 
	|	ИЛИ СУММА(Т.Знак * Т.НДСРегл) <> 0
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация,
	|	ДокументПоступленияРасходов
	|;
	|
	|////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаОстатков.Организация                                   КАК Организация,
	|	ТаблицаОстатков.Подразделение                                 КАК Подразделение,
	|	ТаблицаОстатков.НаправлениеДеятельности                       КАК НаправлениеДеятельности,
	|	ТаблицаОстатков.СтатьяРасходов                                КАК СтатьяРасходов,
	|	ТаблицаОстатков.АналитикаРасходов                             КАК АналитикаРасходов,
	|	ТаблицаОстатков.АналитикаАктивовПассивов                      КАК АналитикаАктивовПассивов,
	|	ТаблицаОстатков.ДокументПоступленияРасходов                   КАК ДокументПоступленияРасходов,
	|	ТаблицаОстатков.Поставщик                                     КАК Поставщик,
	|	ТаблицаОстатков.ВидЦенности                                   КАК ВидЦенности,
	|	ТаблицаОстатков.СтавкаНДС                                     КАК СтавкаНДС,
	|	ТаблицаОстатков.ВидДеятельностиНДС                            КАК ВидДеятельностиНДС,
	|	ТаблицаОстатков.ВидДеятельностиНДС                            КАК НалогообложениеНДСПартии,
	|	
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, &Период) КАК ДатаПоступленияРасходов,
	|	
	|	СтатьиРасходов.ВариантРаспределенияРасходовРегл               КАК ВариантРаспределенияРасходовСтатьи,
	|	СтатьиРасходов.ВидЦенностиНДС                                 КАК ВидЦенностиНДССтатьиРасходов,
	|	СтатьиРасходов.ПринятиеКНалоговомуУчету                       КАК ЭтоПринимаемаяСтатьяРасходовНУ,
	|	
	|	ТаблицаОстатков.СтоимостьРегл                                 КАК СтоимостьРегл,
	|	ТаблицаОстатков.НДСРегл                                       КАК НДСРегл,
	|	ТаблицаОстатков.НДСУпр                                        КАК НДСУпр
	|ПОМЕСТИТЬ ТаблицаОстатков
	|ИЗ
	|	ПартииНДСКРаспределениюОстатки КАК ТаблицаОстатков
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ТаблицаОстатков.Организация =  ДанныеПервичныхДокументов.Организация
	|		И ТаблицаОстатков.ДокументПоступленияРасходов = ДанныеПервичныхДокументов.Документ
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|	ПО
	|		ТаблицаОстатков.СтатьяРасходов = СтатьиРасходов.Ссылка
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументПоступленияРасходов
	|;
	|
	|///////////////////////////////////////////////
	|УНИЧТОЖИТЬ ПартииНДСКРаспределениюОстатки
	|;
	|";
	
	Запрос.Выполнить(); // формируются таблицы ПартииНДСКРаспределениюКорректировка, ТаблицаОстатков
	
	//++ НЕ УТ
	// Формируется таблица принятых к учету активов ВтВнеоборотныеАктивы
	Если ВнеоборотныеАктивы.ИспользуетсяУправлениеВНА_2_4(Реквизиты.Период) Тогда
		ВнеоборотныеАктивыЛокализация.СформироватьТаблицуПринятыхКУчетуВнеоборотныхАктивовДляРаспределенияНДС_2_4(
			?(НачалоМесяца(Реквизиты.ПериодНачало) = Реквизиты.ПериодНачало, НачалоМесяца(Реквизиты.ПериодНачало), НачалоМесяца(Реквизиты.ПериодОкончание)), 
			Реквизиты.ПериодОкончание, Запрос.МенеджерВременныхТаблиц);
	ИначеЕсли ПолучитьФункциональнуюОпцию("ИспользоватьВнеоборотныеАктивы2_2") Тогда
		ВнеоборотныеАктивыЛокализация.СформироватьТаблицуПринятыхКУчетуВнеоборотныхАктивовДляРаспределенияНДС_2_2(
			Реквизиты.ПериодНачало, Реквизиты.ПериодОкончание, Запрос.МенеджерВременныхТаблиц);
	Иначе
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДАТАВРЕМЯ(1,1,1) КАК ДатаПринятияКУчету,
		|	""ОС"" КАК ВнеоборотныйАктив,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК Организация,
		|	ЗНАЧЕНИЕ(Справочник.ОбъектыЭксплуатации.ПустаяСсылка) КАК Объект,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК НалогообложениеНДС,
		|	ЛОЖЬ КАК РаспределятьНДС,
		|	ЛОЖЬ КАК ВключаетсяВРасходыНУПриПринятииКУчету,
		|	НЕОПРЕДЕЛЕНО КАК ПодразделениеРасходовНУ,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовНУ,
		|	ЛОЖЬ КАК ЭтоПринимаемаяСтатьяРасходовНУ,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходовНУ
		|ПОМЕСТИТЬ ВтВнеоборотныеАктивы
		|";
		Запрос.Выполнить();
	КонецЕсли;
	//-- НЕ УТ
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ТаблицаОстатков.Организация                      КАК Организация,
	|	ТаблицаОстатков.Подразделение                    КАК Подразделение,
	|	ТаблицаОстатков.НаправлениеДеятельности          КАК НаправлениеДеятельности,
	|	ТаблицаОстатков.СтатьяРасходов                   КАК СтатьяРасходов,
	|	ТаблицаОстатков.АналитикаРасходов                КАК АналитикаРасходов,
	|	ТаблицаОстатков.АналитикаАктивовПассивов         КАК АналитикаАктивовПассивов,
	|	ТаблицаОстатков.ДокументПоступленияРасходов      КАК ДокументПоступленияРасходов,
	|	ТаблицаОстатков.ВидДеятельностиНДС               КАК ВидДеятельностиНДС,
	|
	|	&ОрганизацияПолучатель                           КАК ОрганизацияПолучатель,
	|	
	|	ТаблицаОстатков.Поставщик                        КАК Поставщик,
	|	ТаблицаОстатков.НалогообложениеНДСПартии         КАК НалогообложениеНДСПартии,
	|	ТаблицаОстатков.СтавкаНДС                        КАК СтавкаНДС,
	|	
	|	ТаблицаОстатков.ДатаПоступленияРасходов          КАК ДатаПоступленияРасходов,
	|	
	|	ЛОЖЬ                                             КАК РаспределятьНДС,
	|	
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ПериодБазы, &ПериодБазы) КАК ПериодБазы,
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ОснованиеКорректировки, НЕОПРЕДЕЛЕНО) КАК ОснованиеКорректировки,
	|	
	|	ТаблицаОстатков.НалогообложениеНДСПартии         КАК НовоеНалогообложениеНДС,
	|	""""                                             КАК ВнеоборотныйАктив,
	|	
	|	ЛОЖЬ                                             КАК ВключаетсяВРасходыНУПриПринятииКУчету,
	|	НЕОПРЕДЕЛЕНО                                     КАК ПодразделениеРасходовНУ,
	|	НЕОПРЕДЕЛЕНО                                     КАК СтатьяРасходовНУ,
	|	ТаблицаОстатков.ЭтоПринимаемаяСтатьяРасходовНУ   КАК ЭтоПринимаемаяСтатьяРасходовНУ,
	|	НЕОПРЕДЕЛЕНО                                     КАК АналитикаРасходовНУ,
	|	
	|	ТаблицаОстатков.ВидЦенности                      КАК ВидЦенности,
	|	
	|	ТаблицаОстатков.СтоимостьРегл                    КАК СтоимостьРегл,
	|	ТаблицаОстатков.НДСРегл                          КАК НДСРегл,
	|	ТаблицаОстатков.НДСУпр                           КАК НДСУпр
	|ИЗ
	|	ТаблицаОстатков КАК ТаблицаОстатков
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПартииНДСКРаспределениюКорректировка КАК ПартииНДСКРаспределениюКорректировка
	|	ПО
	|		ТаблицаОстатков.ДокументПоступленияРасходов = ПартииНДСКРаспределениюКорректировка.ДокументПоступленияРасходов
	|		И ТаблицаОстатков.Организация = ПартииНДСКРаспределениюКорректировка.Организация  
	|		И ТаблицаОстатков.Подразделение = ПартииНДСКРаспределениюКорректировка.Подразделение
	|		И ТаблицаОстатков.СтатьяРасходов = ПартииНДСКРаспределениюКорректировка.СтатьяРасходов
	|		И ТаблицаОстатков.АналитикаРасходов = ПартииНДСКРаспределениюКорректировка.АналитикаРасходов
	|		И ТаблицаОстатков.АналитикаАктивовПассивов = ПартииНДСКРаспределениюКорректировка.АналитикаАктивовПассивов
	|		И ТаблицаОстатков.Поставщик = ПартииНДСКРаспределениюКорректировка.Поставщик
	|		И ТаблицаОстатков.ВидЦенности = ПартииНДСКРаспределениюКорректировка.ВидЦенности
	|		И ТаблицаОстатков.НаправлениеДеятельности = ПартииНДСКРаспределениюКорректировка.НаправлениеДеятельности
	|		И ТаблицаОстатков.СтавкаНДС = ПартииНДСКРаспределениюКорректировка.СтавкаНДС
	|		И ТаблицаОстатков.ВидДеятельностиНДС = ПартииНДСКРаспределениюКорректировка.ВидДеятельностиНДС
	|	
	|ГДЕ
	|	ТаблицаОстатков.НалогообложениеНДСПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортСырьевыхТоваровУслуг)
	|
	|ОБЪЕДИНИТЬ ВСЕ 
	|
	|ВЫБРАТЬ
	|	ТаблицаОстатков.Организация                      КАК Организация,
	|	ТаблицаОстатков.Подразделение                    КАК Подразделение,
	|	ТаблицаОстатков.НаправлениеДеятельности          КАК НаправлениеДеятельности,
	|	ТаблицаОстатков.СтатьяРасходов                   КАК СтатьяРасходов,
	|	ТаблицаОстатков.АналитикаРасходов                КАК АналитикаРасходов,
	|	ТаблицаОстатков.АналитикаАктивовПассивов         КАК АналитикаАктивовПассивов,
	|	ТаблицаОстатков.ДокументПоступленияРасходов      КАК ДокументПоступленияРасходов,
	|	ТаблицаОстатков.ВидДеятельностиНДС               КАК ВидДеятельностиНДС,
	|
	|	&ОрганизацияПолучатель                           КАК ОрганизацияПолучатель,
	|	
	|	ТаблицаОстатков.Поставщик                        КАК Поставщик,
	|	ТаблицаОстатков.НалогообложениеНДСПартии         КАК НалогообложениеНДСПартии,
	|	ТаблицаОстатков.СтавкаНДС                        КАК СтавкаНДС,
	|	
	|	ТаблицаОстатков.ДатаПоступленияРасходов          КАК ДатаПоступленияРасходов,
	|	
	|	ИСТИНА                                           КАК РаспределятьНДС,
	|
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ПериодБазы, &ПериодБазы) КАК ПериодБазы,
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ОснованиеКорректировки, НЕОПРЕДЕЛЕНО) КАК ОснованиеКорректировки,
	|
	|	НЕОПРЕДЕЛЕНО                                     КАК НовоеНалогообложениеНДС,
	|	
	|	ВЫБОР КОГДА ТаблицаОстатков.ВидЦенностиНДССтатьиРасходов = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОбъектыНезавершенногоСтроительства)
	|		ТОГДА ""ОбъектСтроительства""
	|	ИНАЧЕ """"
	|	КОНЕЦ                                            КАК ВнеоборотныйАктив,
	|	ЛОЖЬ                                             КАК ВключаетсяВРасходыНУПриПринятииКУчету,
	|	НЕОПРЕДЕЛЕНО                                     КАК ПодразделениеРасходовНУ,
	|	НЕОПРЕДЕЛЕНО                                     КАК СтатьяРасходовНУ,
	|	ТаблицаОстатков.ЭтоПринимаемаяСтатьяРасходовНУ   КАК ЭтоПринимаемаяСтатьяРасходовНУ,
	|	НЕОПРЕДЕЛЕНО                                     КАК АналитикаРасходовНУ,
	|	
	|	ТаблицаОстатков.ВидЦенности                      КАК ВидЦенности,
	|	
	|	ТаблицаОстатков.СтоимостьРегл                    КАК СтоимостьРегл,
	|	ТаблицаОстатков.НДСРегл                          КАК НДСРегл,
	|	ТаблицаОстатков.НДСУпр                           КАК НДСУпр
	|ИЗ
	|	ТаблицаОстатков КАК ТаблицаОстатков
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПартииНДСКРаспределениюКорректировка КАК ПартииНДСКРаспределениюКорректировка
	|	ПО
	|		ТаблицаОстатков.ДокументПоступленияРасходов = ПартииНДСКРаспределениюКорректировка.ДокументПоступленияРасходов
	|		И ТаблицаОстатков.Организация = ПартииНДСКРаспределениюКорректировка.Организация  
	|		И ТаблицаОстатков.Подразделение = ПартииНДСКРаспределениюКорректировка.Подразделение
	|		И ТаблицаОстатков.СтатьяРасходов = ПартииНДСКРаспределениюКорректировка.СтатьяРасходов
	|		И ТаблицаОстатков.АналитикаРасходов = ПартииНДСКРаспределениюКорректировка.АналитикаРасходов
	|		И ТаблицаОстатков.АналитикаАктивовПассивов = ПартииНДСКРаспределениюКорректировка.АналитикаАктивовПассивов
	|		И ТаблицаОстатков.Поставщик = ПартииНДСКРаспределениюКорректировка.Поставщик
	|		И ТаблицаОстатков.ВидЦенности = ПартииНДСКРаспределениюКорректировка.ВидЦенности
	|		И ТаблицаОстатков.НаправлениеДеятельности = ПартииНДСКРаспределениюКорректировка.НаправлениеДеятельности
	|		И ТаблицаОстатков.СтавкаНДС = ПартииНДСКРаспределениюКорректировка.СтавкаНДС
	|		И ТаблицаОстатков.ВидДеятельностиНДС = ПартииНДСКРаспределениюКорректировка.ВидДеятельностиНДС
	|	
	|ГДЕ
	|	ТаблицаОстатков.НалогообложениеНДСПартии <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортСырьевыхТоваровУслуг)
	|	И (ТаблицаОстатков.ВариантРаспределенияРасходовСтатьи В (
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаНаправленияДеятельности),
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаРасходыБудущихПериодов),
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПрочиеАктивы))
	|		ИЛИ ТаблицаОстатков.ВариантРаспределенияРасходовСтатьи = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
	|			И НЕ &РаздельныйУчетПостатейныхПроизводственныхЗатратПоНалогообложениюНДС
	|		ИЛИ (ТаблицаОстатков.НалогообложениеНДСПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОпределяетсяРаспределением)
	|				И ЕСТЬNULL(ТаблицаОстатков.ВариантРаспределенияРасходовСтатьи, ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.ПустаяСсылка)) 
	|						<> ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
	//++ НЕ УТ
	|				И ЕСТЬNULL(ТаблицаОстатков.ВариантРаспределенияРасходовСтатьи, ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.ПустаяСсылка)) 
	|						<> ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	//-- НЕ УТ
	|			))
	//++ НЕ УТ
	|	И &ВыборкаПоКварталу
	|
	|ОБЪЕДИНИТЬ ВСЕ 
	|
	|ВЫБРАТЬ
	|	ТаблицаОстатков.Организация                      КАК Организация,
	|	ТаблицаОстатков.Подразделение                    КАК Подразделение,
	|	ТаблицаОстатков.НаправлениеДеятельности          КАК НаправлениеДеятельности,
	|	ТаблицаОстатков.СтатьяРасходов                   КАК СтатьяРасходов,
	|	ТаблицаОстатков.АналитикаРасходов                КАК АналитикаРасходов,
	|	ТаблицаОстатков.АналитикаАктивовПассивов         КАК АналитикаАктивовПассивов,
	|	ТаблицаОстатков.ДокументПоступленияРасходов      КАК ДокументПоступленияРасходов,
	|	ТаблицаОстатков.ВидДеятельностиНДС               КАК ВидДеятельностиНДС,   
	|
	|	&ОрганизацияПолучатель                           КАК ОрганизацияПолучатель,
	|	
	|	ТаблицаОстатков.Поставщик                        КАК Поставщик,
	|	ТаблицаОстатков.НалогообложениеНДСПартии         КАК НалогообложениеНДСПартии,
	|	ТаблицаОстатков.СтавкаНДС                        КАК СтавкаНДС,
	|	
	|	ТаблицаОстатков.ДатаПоступленияРасходов          КАК ДатаПоступленияРасходов,
	|	
	|	ВнеобАктивы.РаспределятьНДС                      КАК РаспределятьНДС,
	|	
	|	ВЫБОР 
	|		КОГДА НЕ ПартииНДСКРаспределениюКорректировка.ДокументПоступленияРасходов ЕСТЬ NULL
	|			ТОГДА КОНЕЦПЕРИОДА(ВнеобАктивы.ДатаПринятияКУчету, МЕСЯЦ)
	|		ИНАЧЕ &ПериодБазы
	|	КОНЕЦ КАК ПериодБазы,
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ОснованиеКорректировки, НЕОПРЕДЕЛЕНО) КАК ОснованиеКорректировки,
	|	
	|	ВЫБОР 
	|		КОГДА НЕ ВнеобАктивы.РаспределятьНДС
	|			ТОГДА ВнеобАктивы.НалогообложениеНДС
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ                                            КАК НовоеНалогообложениеНДС,
	|	ВнеобАктивы.ВнеоборотныйАктив                    КАК ВнеоборотныйАктив,
	|	
	|	ВнеобАктивы.ВключаетсяВРасходыНУПриПринятииКУчету КАК ВключаетсяВРасходыНУПриПринятииКУчету,
	|	ВнеобАктивы.ПодразделениеРасходовНУ               КАК ПодразделениеРасходовНУ,
	|	ВнеобАктивы.СтатьяРасходовНУ                      КАК СтатьяРасходовНУ,
	|	ЕСТЬNULL(ВнеобАктивы.ЭтоПринимаемаяСтатьяРасходовНУ, ТаблицаОстатков.ЭтоПринимаемаяСтатьяРасходовНУ) КАК ЭтоПринимаемаяСтатьяРасходовНУ,
	|	ВнеобАктивы.АналитикаРасходовНУ                   КАК АналитикаРасходовНУ,
	|	
	|	ТаблицаОстатков.ВидЦенности                      КАК ВидЦенности,
	|	
	|	ТаблицаОстатков.СтоимостьРегл                    КАК СтоимостьРегл,
	|	ТаблицаОстатков.НДСРегл                          КАК НДСРегл,
	|	ТаблицаОстатков.НДСУпр                           КАК НДСУпр
	|ИЗ
	|	ТаблицаОстатков КАК ТаблицаОстатков
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		ВтВнеоборотныеАктивы КАК ВнеобАктивы
	|	ПО 
	|		ТаблицаОстатков.АналитикаРасходов = ВнеобАктивы.Объект
	|		ИЛИ ТаблицаОстатков.АналитикаАктивовПассивов = ВнеобАктивы.Объект 
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПартииНДСКРаспределениюКорректировка КАК ПартииНДСКРаспределениюКорректировка
	|	ПО
	|		ТаблицаОстатков.ДокументПоступленияРасходов = ПартииНДСКРаспределениюКорректировка.ДокументПоступленияРасходов
	|		И ТаблицаОстатков.Организация = ПартииНДСКРаспределениюКорректировка.Организация  
	|		И ТаблицаОстатков.Подразделение = ПартииНДСКРаспределениюКорректировка.Подразделение
	|		И ТаблицаОстатков.СтатьяРасходов = ПартииНДСКРаспределениюКорректировка.СтатьяРасходов
	|		И ТаблицаОстатков.АналитикаРасходов = ПартииНДСКРаспределениюКорректировка.АналитикаРасходов
	|		И ТаблицаОстатков.АналитикаАктивовПассивов = ПартииНДСКРаспределениюКорректировка.АналитикаАктивовПассивов
	|		И ТаблицаОстатков.Поставщик = ПартииНДСКРаспределениюКорректировка.Поставщик
	|		И ТаблицаОстатков.ВидЦенности = ПартииНДСКРаспределениюКорректировка.ВидЦенности
	|		И ТаблицаОстатков.НаправлениеДеятельности = ПартииНДСКРаспределениюКорректировка.НаправлениеДеятельности
	|		И ТаблицаОстатков.СтавкаНДС = ПартииНДСКРаспределениюКорректировка.СтавкаНДС
	|		И ТаблицаОстатков.ВидДеятельностиНДС = ПартииНДСКРаспределениюКорректировка.ВидДеятельностиНДС
	|	
	|ГДЕ
	|	(ТаблицаОстатков.ВариантРаспределенияРасходовСтатьи = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		ИЛИ ТаблицаОстатков.НалогообложениеНДСПартии = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию))
	|
	|ОБЪЕДИНИТЬ ВСЕ 
	|
	|ВЫБРАТЬ
	|	ТаблицаОстатков.Организация                      КАК Организация,
	|	ТаблицаОстатков.Подразделение                    КАК Подразделение,
	|	ТаблицаОстатков.НаправлениеДеятельности          КАК НаправлениеДеятельности,
	|	ТаблицаОстатков.СтатьяРасходов                   КАК СтатьяРасходов,
	|	ТаблицаОстатков.АналитикаРасходов                КАК АналитикаРасходов,
	|	ТаблицаОстатков.АналитикаАктивовПассивов         КАК АналитикаАктивовПассивов,
	|	ТаблицаОстатков.ДокументПоступленияРасходов      КАК ДокументПоступленияРасходов,
	|	ТаблицаОстатков.ВидДеятельностиНДС               КАК ВидДеятельностиНДС,
	|
	|	&ОрганизацияПолучатель                           КАК ОрганизацияПолучатель,
	|	
	|	ТаблицаОстатков.Поставщик                        КАК Поставщик,
	|	ТаблицаОстатков.НалогообложениеНДСПартии         КАК НалогообложениеНДСПартии,
	|	ТаблицаОстатков.СтавкаНДС                        КАК СтавкаНДС,
	|	
	|	ТаблицаОстатков.ДатаПоступленияРасходов          КАК ДатаПоступленияРасходов,
	|	
	|	ИСТИНА                                           КАК РаспределятьНДС,
	|	
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ПериодБазы, &ПериодБазы) КАК ПериодБазы,
	|	ЕСТЬNULL(ПартииНДСКРаспределениюКорректировка.ОснованиеКорректировки, НЕОПРЕДЕЛЕНО) КАК ОснованиеКорректировки,
	|	
	|	НЕОПРЕДЕЛЕНО                                     КАК НовоеНалогообложениеНДС,
	|
	|	""ОбъектСтроительства""                          КАК ВнеоборотныйАктив,
	|	ЛОЖЬ                                             КАК ВключаетсяВРасходыНУПриПринятииКУчету,
	|	НЕОПРЕДЕЛЕНО                                     КАК ПодразделениеРасходовНУ,
	|	НЕОПРЕДЕЛЕНО                                     КАК СтатьяРасходовНУ,
	|	ТаблицаОстатков.ЭтоПринимаемаяСтатьяРасходовНУ   КАК ЭтоПринимаемаяСтатьяРасходовНУ,
	|	НЕОПРЕДЕЛЕНО                                     КАК АналитикаРасходовНУ,
	|
	|	ТаблицаОстатков.ВидЦенности                      КАК ВидЦенности,
	|	
	|	ТаблицаОстатков.СтоимостьРегл                    КАК СтоимостьРегл,
	|	ТаблицаОстатков.НДСРегл                          КАК НДСРегл,
	|	ТаблицаОстатков.НДСУпр                           КАК НДСУпр
	|ИЗ
	|	ТаблицаОстатков КАК ТаблицаОстатков
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПартииНДСКРаспределениюКорректировка КАК ПартииНДСКРаспределениюКорректировка
	|	ПО
	|		ТаблицаОстатков.ДокументПоступленияРасходов = ПартииНДСКРаспределениюКорректировка.ДокументПоступленияРасходов
	|		И ТаблицаОстатков.Организация = ПартииНДСКРаспределениюКорректировка.Организация  
	|		И ТаблицаОстатков.Подразделение = ПартииНДСКРаспределениюКорректировка.Подразделение
	|		И ТаблицаОстатков.СтатьяРасходов = ПартииНДСКРаспределениюКорректировка.СтатьяРасходов
	|		И ТаблицаОстатков.АналитикаРасходов = ПартииНДСКРаспределениюКорректировка.АналитикаРасходов
	|		И ТаблицаОстатков.АналитикаАктивовПассивов = ПартииНДСКРаспределениюКорректировка.АналитикаАктивовПассивов
	|		И ТаблицаОстатков.Поставщик = ПартииНДСКРаспределениюКорректировка.Поставщик
	|		И ТаблицаОстатков.ВидЦенности = ПартииНДСКРаспределениюКорректировка.ВидЦенности
	|		И ТаблицаОстатков.НаправлениеДеятельности = ПартииНДСКРаспределениюКорректировка.НаправлениеДеятельности
	|		И ТаблицаОстатков.СтавкаНДС = ПартииНДСКРаспределениюКорректировка.СтавкаНДС
	|		И ТаблицаОстатков.ВидДеятельностиНДС = ПартииНДСКРаспределениюКорректировка.ВидДеятельностиНДС
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		ВтВнеоборотныеАктивы КАК ВнеобАктивы
	|	ПО 
	|		ТаблицаОстатков.АналитикаРасходов = ВнеобАктивы.Объект
	|
	|ГДЕ
	|	ТаблицаОстатков.ВариантРаспределенияРасходовСтатьи = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	И ТаблицаОстатков.ВидЦенностиНДССтатьиРасходов = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОбъектыНезавершенногоСтроительства)
	|	И ВнеобАктивы.Объект ЕСТЬ NULL
	|	И &ВыборкаПоКварталу
	|;
	|
	|///////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВнеоборотныеАктивы.Организация КАК Организация,
	|	ВнеоборотныеАктивы.Объект КАК Объект
	|ИЗ
	|	ВтВнеоборотныеАктивы КАК ВнеоборотныеАктивы
	//-- НЕ УТ
	|";
	
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОрганизацияПолучатель",
		РегистрыНакопления.ПартииПрочихРасходов.ТекстЗапросаЗначениеПоляОрганизацияПолучатель("ТаблицаОстатков"));
	
	РезультатыЗапроса = Запрос.ВыполнитьПакет();
	
	Результат = Новый Структура;
	
	Результат.Вставить("ПартииНДСКРаспределению", РезультатыЗапроса[0].Выгрузить());
	//++ НЕ УТ
	Результат.Вставить("ВнеоборотныеАктивы",   РезультатыЗапроса[1].Выгрузить());
	//-- НЕ УТ

	// Уничтожим все сформированные временные таблицы.
	// Если этого не сделать, то при вызове этого метода из партионного учета версии 2.2
	// возможно возникновение ошибки вида "Временная таблица уже существует".
	
	Запрос.Текст = "
	//++ НЕ УТ
	|УНИЧТОЖИТЬ ВтВнеоборотныеАктивы
	|;
	//-- НЕ УТ
	|УНИЧТОЖИТЬ ВТКорректировкаОстатковПартииНДСКРаспределению
	|;
	|УНИЧТОЖИТЬ ТаблицаОстатков
	|;
	|УНИЧТОЖИТЬ ПартииНДСКРаспределениюКорректировка
	|";
	
	Запрос.Выполнить();
	
	Возврат Результат;
	
КонецФункции

Функция СформироватьДвижения(Реквизиты, ДополнительныеСвойства)
	
	ТаблицыДляДвижений     = ДополнительныеСвойства.ТаблицыДляДвижений;
	
	ДанныеДляРаспределения = ДанныеДляРаспределения(Реквизиты, ДополнительныеСвойства);
	
	РезультатРаспределения = РаспределитьПартииНДСПоБазе(ДанныеДляРаспределения.ПартииНДСКРаспределению, Реквизиты);
	
	ТаблицыДляДвижений.Вставить("ТаблицаПартииНДСКРаспределению", ТаблицаПартииНДСКРаспределению(РезультатРаспределения, Реквизиты));
	ТаблицаПрочиеРасходы = ТаблицаПрочиеРасходы(РезультатРаспределения, Реквизиты);
	ТаблицыДляДвижений.Вставить("ТаблицаПрочиеРасходы", ТаблицаПрочиеРасходы);
	//++ НЕ УТ
	ОтражениеДокументов = ТаблицаОтражениеДокументовВРеглУчете(ТаблицаПрочиеРасходы, Реквизиты);
	Если ОтражениеДокументов.Количество() > 0 Тогда
		ТаблицыДляДвижений.Вставить("ТаблицаОтражениеДокументовВРеглУчете", ОтражениеДокументов);
	КонецЕсли;
	ТаблицыДляДвижений.Вставить("ТаблицаПараметрыАмортизацииОСБухгалтерскийУчет", Новый ТаблицаЗначений);
	ТаблицыДляДвижений.Вставить("ТаблицаПервоначальныеСведенияОСБухгалтерскийУчет", Новый ТаблицаЗначений);
	ТаблицыДляДвижений.Вставить("ТаблицаПервоначальныеСведенияОСНалоговыйУчет", Новый ТаблицаЗначений);
	ТаблицыДляДвижений.Вставить("ТаблицаПервоначальныеСведенияНМАБухгалтерскийУчет", Новый ТаблицаЗначений);
	ТаблицыДляДвижений.Вставить("ТаблицаПервоначальныеСведенияНМАНалоговыйУчет", Новый ТаблицаЗначений);
	
	ВнеоборотныеАктивыЛокализация.ВключитьВСтоимостьВнеоборотныхАктивовРезультатРаспределенияНДС(
		    ДанныеДляРаспределения.ВнеоборотныеАктивы,
			ТаблицыДляДвижений.ТаблицаПрочиеРасходы, 
			РезультатРаспределения,
			Реквизиты,
			ТаблицыДляДвижений);
	//-- НЕ УТ

КонецФункции

Функция РаспределитьПартииНДСПоБазе(ПартииНДСКРаспределению, Реквизиты)
	
	ТипыНалогообложения = Перечисления.ТипыНалогообложенияНДС;
	
	ПартииНДСКРаспределениюОблагаетсяНДС               = ТаблицаРезультатРаспределения();
	ПартииНДСКРаспределениюНеОблагаетсяНДС             = ТаблицаРезультатРаспределения();
	ПартииНДСКРаспределениюОблагаетсяЕНВД              = ТаблицаРезультатРаспределения();
	ПартииНДСКРаспределениюЭкспорт                     = ТаблицаРезультатРаспределения();
	ПартииНДСКРаспределениюЭкспортНесырьевыхТоваров    = ТаблицаРезультатРаспределения();
	ПартииНДСКРаспределениюЭкспортСырьевыхТоваровУслуг = ТаблицаРезультатРаспределения();
	
	
	
	ТаблицыРаспределения = Новый Соответствие;
	ТаблицыРаспределения.Вставить(ТипыНалогообложения.ПродажаОблагаетсяНДС,        ПартииНДСКРаспределениюОблагаетсяНДС);
	ТаблицыРаспределения.Вставить(ТипыНалогообложения.ПродажаНеОблагаетсяНДС,      ПартииНДСКРаспределениюНеОблагаетсяНДС);
	ТаблицыРаспределения.Вставить(ТипыНалогообложения.ПродажаОблагаетсяЕНВД,       ПартииНДСКРаспределениюОблагаетсяЕНВД);
	ТаблицыРаспределения.Вставить(ТипыНалогообложения.ПродажаНаЭкспорт,            ПартииНДСКРаспределениюЭкспорт);
	ТаблицыРаспределения.Вставить(ТипыНалогообложения.ЭкспортНесырьевыхТоваров,    ПартииНДСКРаспределениюЭкспортНесырьевыхТоваров);
	ТаблицыРаспределения.Вставить(ТипыНалогообложения.ЭкспортСырьевыхТоваровУслуг, ПартииНДСКРаспределениюЭкспортСырьевыхТоваровУслуг);
	
	БазаРаспределения = БазаРаспределения(ПартииНДСКРаспределению, Реквизиты);
	
	Для каждого СтрокаПрочихРасходов Из ПартииНДСКРаспределению Цикл
		
		УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту = УчетНДСРФ.УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту(СтрокаПрочихРасходов.ДатаПоступленияРасходов);
		
		Если СтрокаПрочихРасходов.РаспределятьНДС Тогда
			
			БазаПериода = БазаРаспределения.Найти(СтрокаПрочихРасходов.ПериодБазы, "ПериодБазы");
			
			БараРаспределенияПериода = Новый Соответствие;
			БараРаспределенияПериода.Вставить(ТипыНалогообложения.ПродажаОблагаетсяНДС,   БазаПериода.НДС);
			БараРаспределенияПериода.Вставить(ТипыНалогообложения.ПродажаНеОблагаетсяНДС, БазаПериода.НеНДС);
			БараРаспределенияПериода.Вставить(ТипыНалогообложения.ПродажаОблагаетсяЕНВД,  БазаПериода.ЕНВД);
			Если УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту Тогда
				// Партия поступила после 01.07.2016 - действует упрощенный порядок вычета НДС по несырьевому экспорт.
				БараРаспределенияПериода.Вставить(ТипыНалогообложения.ПродажаНаЭкспорт, 0);
				БараРаспределенияПериода.Вставить(ТипыНалогообложения.ЭкспортНесырьевыхТоваров,    БазаПериода.НДС0НесырьевыеТовары);
				БараРаспределенияПериода.Вставить(ТипыНалогообложения.ЭкспортСырьевыхТоваровУслуг, БазаПериода.НДС0СырьевыеТоварыУслуги);
			Иначе
				// Партия поступила после 01.07.2016 - действует старый порядок вычета НДС по экспорту.
				БараРаспределенияПериода.Вставить(ТипыНалогообложения.ПродажаНаЭкспорт, БазаПериода.НДС0);
				БараРаспределенияПериода.Вставить(ТипыНалогообложения.ЭкспортНесырьевыхТоваров,    0);
				БараРаспределенияПериода.Вставить(ТипыНалогообложения.ЭкспортСырьевыхТоваровУслуг, 0);
			КонецЕсли;
			
			Коэффициенты = Новый Массив;
			Для каждого КлючИЗначение Из БараРаспределенияПериода Цикл
				Коэффициенты.Добавить(КлючИЗначение.Значение);
			КонецЦикла;
			
			РаспределениеСтоимостьРегл = ОбщегоНазначения.РаспределитьСуммуПропорциональноКоэффициентам(СтрокаПрочихРасходов.СтоимостьРегл, Коэффициенты); 
			РаспределениеНДСРегл = ОбщегоНазначения.РаспределитьСуммуПропорциональноКоэффициентам(СтрокаПрочихРасходов.НДСРегл, Коэффициенты);
			РаспределениеНДСУпр = ОбщегоНазначения.РаспределитьСуммуПропорциональноКоэффициентам(СтрокаПрочихРасходов.НДСУпр, Коэффициенты);
			
			Индекс = 0;
			Для каждого КлючИЗначение Из ТаблицыРаспределения Цикл
				
				Налогообложение = КлючИЗначение.Ключ;
				Таблица = КлючИЗначение.Значение;
				
				СтоимостьРегл = ?(РаспределениеСтоимостьРегл <> Неопределено, РаспределениеСтоимостьРегл[Индекс], 0);
				НДСРегл       = ?(РаспределениеНДСРегл       <> Неопределено, РаспределениеНДСРегл[Индекс], 0);
				НДСУпр        = ?(РаспределениеНДСУпр       <> Неопределено, РаспределениеНДСУпр[Индекс], 0);
				
				Индекс = Индекс + 1;
				Если СтоимостьРегл = 0 И НДСРегл = 0 И НДСУпр = 0 Тогда
					Продолжить;
				КонецЕсли;
				
				НоваяСтрока = Таблица.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаПрочихРасходов, , "СтоимостьРегл, НДСРегл");
				НоваяСтрока.СтоимостьРегл = СтоимостьРегл;
				НоваяСтрока.НДСРегл       = НДСРегл;
				НоваяСтрока.НДСУпр        = НДСУпр;
				
				Если ЗначениеЗаполнено(СтрокаПрочихРасходов.ВнеоборотныйАктив) Тогда
					Продолжить;
				КонецЕсли;
				
				Если Налогообложение = Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС Тогда
					Если НЕ БазаПериода.СписатьНДСПоРасходамАктивамНаСтатьиОтражения 
							ИЛИ НоваяСтрока.СтатьяРасходов = Неопределено Тогда
						НоваяСтрока.СтатьяОтраженияРасходов = БазаПериода.СтатьяРасходовНеНДС;
						НоваяСтрока.АналитикаОтраженияРасходов = БазаПериода.АналитикаРасходовНеНДС;
						НоваяСтрока.СтатьяРасходовНУ = БазаПериода.СтатьяРасходовНеНДС;
						НоваяСтрока.ЭтоПринимаемаяСтатьяРасходовНУ = БазаПериода.СтатьяРасходовНеНДС_ПринимаетсяКНУ;
					Иначе
						НоваяСтрока.СтатьяОтраженияРасходов = НоваяСтрока.СтатьяРасходов;
						НоваяСтрока.АналитикаОтраженияРасходов = НоваяСтрока.АналитикаРасходов;
						НоваяСтрока.СтатьяРасходовНУ = НоваяСтрока.СтатьяРасходов;
						НоваяСтрока.ЭтоПринимаемаяСтатьяРасходовНУ = НоваяСтрока.ЭтоПринимаемаяСтатьяРасходовНУ;
					КонецЕсли;
				ИначеЕсли Налогообложение = Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД Тогда
					Если НЕ БазаПериода.СписатьНДСПоРасходамАктивамНаСтатьиОтражения 
							ИЛИ НоваяСтрока.СтатьяРасходов = Неопределено Тогда
						НоваяСтрока.СтатьяОтраженияРасходов = БазаПериода.СтатьяРасходовЕНВД;
						НоваяСтрока.АналитикаОтраженияРасходов = БазаПериода.АналитикаРасходовЕНВД;
						НоваяСтрока.СтатьяРасходовНУ = БазаПериода.СтатьяРасходовЕНВД;
						НоваяСтрока.ЭтоПринимаемаяСтатьяРасходовНУ = БазаПериода.СтатьяРасходовЕНВД_ПринимаетсяКНУ;
					Иначе
						НоваяСтрока.СтатьяОтраженияРасходов = НоваяСтрока.СтатьяРасходов;
						НоваяСтрока.АналитикаОтраженияРасходов = НоваяСтрока.АналитикаРасходов;
						НоваяСтрока.СтатьяРасходовНУ = НоваяСтрока.СтатьяРасходов;
						НоваяСтрока.ЭтоПринимаемаяСтатьяРасходовНУ = НоваяСтрока.ЭтоПринимаемаяСтатьяРасходовНУ;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
		Иначе
			
			Таблица = ТаблицыРаспределения[СтрокаПрочихРасходов.НовоеНалогообложениеНДС];
			Если Таблица = Неопределено Тогда
				ТекстСообщения = СтрШаблон(
					НСтр("ru = 'Неопределено налогообложение по внеоборотному активу %1.'"), 
					СтрокаПрочихРасходов.АналитикаРасходов);
				ВызватьИсключение ТекстСообщения;
			КонецЕсли;
			ЗаполнитьЗначенияСвойств(Таблица.Добавить(), СтрокаПрочихРасходов);
			
		КонецЕсли;
		
	КонецЦикла;
	
	// Если 
	// - распределение выполняется после 01.07.2016
	// - партия поступила ранее 01.07.2016, 
	// то распределение также необходимо выполнить на документы несыерьвого экспорта.
	РаспределятьНаВесьЭкспорт = УчетНДСРФ.УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту(Реквизиты.ПериодБазы);
	РаспределитьПартииНДСКРаспределениюЭкспортПоДокументам(ПартииНДСКРаспределениюЭкспорт, Реквизиты, РаспределятьНаВесьЭкспорт);
	
	РаспределитьПартииНДСКРаспределениюЭкспортПоДокументам(ПартииНДСКРаспределениюЭкспортСырьевыхТоваровУслуг, Реквизиты, Ложь);
	
	Для Каждого КлючИЗначение Из ТаблицыРаспределения Цикл
		Налогообложение = КлючИЗначение.Ключ;
		Таблица = КлючИЗначение.Значение;
		Таблица.ЗаполнитьЗначения(Налогообложение, "КорВидДеятельностиНДС");
	КонецЦикла;
	
	Результат = Новый Структура;
	Результат.Вставить("ПартииНДСКРаспределениюОблагаетсяНДС",               ПартииНДСКРаспределениюОблагаетсяНДС);
	Результат.Вставить("ПартииНДСКРаспределениюНеОблагаетсяНДС",             ПартииНДСКРаспределениюНеОблагаетсяНДС);
	Результат.Вставить("ПартииНДСКРаспределениюОблагаетсяЕНВД",              ПартииНДСКРаспределениюОблагаетсяЕНВД);
	Результат.Вставить("ПартииНДСКРаспределениюЭкспорт",                     ПартииНДСКРаспределениюЭкспорт);
	Результат.Вставить("ПартииНДСКРаспределениюЭкспортНесырьевыхТоваров",    ПартииНДСКРаспределениюЭкспортНесырьевыхТоваров);
	Результат.Вставить("ПартииНДСКРаспределениюЭкспортСырьевыхТоваровУслуг", ПартииНДСКРаспределениюЭкспортСырьевыхТоваровУслуг);
	
	Возврат Результат;
	
КонецФункции

Процедура РаспределитьПартииНДСКРаспределениюЭкспортПоДокументам(ПартииНДСКРаспределениюЭкспорт, Реквизиты, РаспределятьНаВесьЭкспорт)
	
	Если ПартииНДСКРаспределениюЭкспорт.Итог("НДСРегл") = 0 Тогда
		Возврат;
	КонецЕсли;
	
	МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	ИменаКолонок = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьИменаКолонокСтрокой(ПартииНДСКРаспределениюЭкспорт);
	РасчетСебестоимостиПрикладныеАлгоритмы.ПоместитьТаблицуЗначенийВоВременнуюТаблицу(
		МенеджерВременныхТаблиц, "ПартииНДСКРаспределениюЭкспорт", ПартииНДСКРаспределениюЭкспорт, ИменаКолонок);
		
	ПартииНДСКРаспределениюЭкспорт.Очистить();
	
	РаспределитьПартииНДСКРаспределениюЭкспортПоДокументамТекущегоПериода(
		ПартииНДСКРаспределениюЭкспорт, 
		Реквизиты, 
		МенеджерВременныхТаблиц, 
		РаспределятьНаВесьЭкспорт);
		
	РаспределитьПартииНДСКРаспределениюЭкспортПоДокументамПрошлыхПериодов(
		ПартииНДСКРаспределениюЭкспорт, 
		Реквизиты, 
		МенеджерВременныхТаблиц);
	
КонецПроцедуры

Процедура РаспределитьПартииНДСКРаспределениюЭкспортПоДокументамТекущегоПериода(ПартииНДСКРаспределениюЭкспорт, Реквизиты, МенеджерВременныхТаблиц, РаспределятьНаВесьЭкспорт)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументыЭкспорт.Документ             КАК Документ,
	|	ДокументыЭкспорт.СуммаВыручки         КАК СуммаНесырьевыеТовары,
	|	ДокументыЭкспорт.КорректировкаВыручки КАК КорректировкаНесырьевыеТовары
	|ПОМЕСТИТЬ ДокументыЭкспортНесырьевыхТоваров
	|ИЗ
	|	&ДокументыЭкспорт КАК ДокументыЭкспорт
	|ГДЕ
	|	ДокументыЭкспорт.СуммаВыручки > 0
	|;
	|
	|/////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	База.Дата КАК Дата,
	|	База.Документ КАК Документ,
	|	СУММА(База.Сумма) КАК Сумма
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДокументыЭкспорт.Документ.Дата             КАК Дата,
	|		ДокументыЭкспорт.Документ                  КАК Документ,
	|		(ДокументыЭкспорт.СуммаВыручки 
	|			+ ДокументыЭкспорт.КорректировкаВыручки)  КАК Сумма
	|	ИЗ
	|		Документ.РаспределениеНДС.ДокументыЭкспорт КАК ДокументыЭкспорт
	|	ГДЕ
	|		ДокументыЭкспорт.Ссылка = &Ссылка
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		ДокументыЭкспорт.Документ.Дата КАК Дата,
	|		ДокументыЭкспорт.Документ      КАК Документ,
	|		(ДокументыЭкспорт.СуммаНесырьевыеТовары 
	|			+ ДокументыЭкспорт.КорректировкаНесырьевыеТовары) КАК Сумма
	|	ИЗ
	|		ДокументыЭкспортНесырьевыхТоваров КАК ДокументыЭкспорт) База
	|
	|СГРУППИРОВАТЬ ПО
	|	База.Дата,
	|	База.Документ
	|
	|ИМЕЮЩИЕ
	|	СУММА(База.Сумма) > 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Дата
	|;
	|
	|ВЫБРАТЬ
	|	*
	|ИЗ
	|	ПартииНДСКРаспределениюЭкспорт КАК ПартииНДСКРаспределениюЭкспорт
	|ГДЕ
	|	ПартииНДСКРаспределениюЭкспорт.ПериодБазы = &ПериодБазы
	|	И ПартииНДСКРаспределениюЭкспорт.НДСРегл >= 0
	|
	|УПОРЯДОЧИТЬ ПО 
	|	ПартииНДСКРаспределениюЭкспорт.ДатаПоступленияРасходов
	|;
	|
	|ВЫБРАТЬ
	|	*
	|ИЗ
	|	ПартииНДСКРаспределениюЭкспорт КАК ПартииНДСКРаспределениюЭкспорт
	|ГДЕ
	|	ПартииНДСКРаспределениюЭкспорт.ПериодБазы = &ПериодБазы
	|	И ПартииНДСКРаспределениюЭкспорт.НДСРегл < 0
	|
	|УПОРЯДОЧИТЬ ПО 
	|	ПартииНДСКРаспределениюЭкспорт.ДатаПоступленияРасходов
	|";
	
	Запрос.УстановитьПараметр("ПериодБазы", Реквизиты.ПериодБазы);
	Запрос.УстановитьПараметр("Ссылка", Реквизиты.Ссылка);
	Если РаспределятьНаВесьЭкспорт Тогда
		База = ПолучитьБазуРаспределения(Реквизиты.ПериодБазы, Реквизиты.ПериодНачало, Реквизиты.Организация, Истина);
		Запрос.УстановитьПараметр("ДокументыЭкспорт", База.ДокументыЭкспорт);
	Иначе
		ДокументыЭкспорт = Новый ТаблицаЗначений;
		ДокументыЭкспорт.Колонки.Добавить("Документ", Новый ОписаниеТипов("ДокументСсылка.РеализацияТоваровУслуг"));
		ДокументыЭкспорт.Колонки.Добавить("СуммаВыручки", Новый ОписаниеТипов("Число"));
		ДокументыЭкспорт.Колонки.Добавить("КорректировкаВыручки", Новый ОписаниеТипов("Число"));
		Запрос.УстановитьПараметр("ДокументыЭкспорт", ДокументыЭкспорт);
	КонецЕсли;
	
	Результат = Запрос.ВыполнитьПакет();
	
	ДокументыРеализации                         = Результат[Результат.Количество() - 3].Выгрузить();
	ДокументыРеализации.Колонки.Добавить("НДС");
	
	// Положительные и отрицательные остатки распределим отдельно.
	ТаблицыДляРаспределения = Новый Массив;
	ТаблицыДляРаспределения.Добавить(Результат[Результат.Количество() - 2].Выгрузить()); // Положительные суммы по СФ и ИСФ, КСФ
	ТаблицыДляРаспределения.Добавить(Результат[Результат.Количество() - 1].Выгрузить()); // Отрицательные суммы по КСФ
	
	Для Каждого ПартииНДСКРаспределениюЭкспортДляРаспределения Из ТаблицыДляРаспределения Цикл
	
		Если ПартииНДСКРаспределениюЭкспортДляРаспределения.Количество() = 0 Тогда
			Возврат;
		КонецЕсли;
		
		Если ДокументыРеализации.Количество() = 0 Тогда
			// Нет документов для распределения, вернет таблицу как есть
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ПартииНДСКРаспределениюЭкспортДляРаспределения, ПартииНДСКРаспределениюЭкспорт);
			Возврат;
		КонецЕсли;
		
		НДСВсего         = ПартииНДСКРаспределениюЭкспортДляРаспределения.Итог("НДСРегл");
		Коэффициенты     = ДокументыРеализации.ВыгрузитьКолонку("Сумма");
		НДСПоРеализациям = ОбщегоНазначения.РаспределитьСуммуПропорциональноКоэффициентам(НДСВсего, Коэффициенты); 
		
		ДокументыРеализации.ЗагрузитьКолонку(НДСПоРеализациям, "НДС");
		
		Для Каждого СтрокаДокумент Из ДокументыРеализации Цикл
			
			НДСОсталосьРаспределить = СтрокаДокумент.НДС;
			
			РаспределенныеПартии = Новый Массив();
			
			Для Каждого ПартияПрочихРасходов Из ПартииНДСКРаспределениюЭкспортДляРаспределения Цикл
				
				Если НДСОсталосьРаспределить = 0 Тогда
					Прервать;
				КонецЕсли;
				
				Если ПартияПрочихРасходов.НДСРегл = 0 Тогда
					
					Если ПартияПрочихРасходов.СтоимостьРегл > 0 Тогда
						// Распределять по реализациям не требуется, но остаток по регитстру необходимо закрыть.
						НоваяСтрока = ПартииНДСКРаспределениюЭкспорт.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрока, ПартияПрочихРасходов);
					КонецЕсли;
					
					РаспределенныеПартии.Добавить(ПартияПрочихРасходов);
					
					Продолжить;
					
				КонецЕсли;
				
				Если НДСОсталосьРаспределить < 0 Тогда
					НДСРегл = Макс(НДСОсталосьРаспределить, ПартияПрочихРасходов.НДСРегл);
				Иначе
					НДСРегл = Мин(НДСОсталосьРаспределить, ПартияПрочихРасходов.НДСРегл);
				КонецЕсли;
				 
				СтоимостьРегл = Окр(ПартияПрочихРасходов.СтоимостьРегл * НДСРегл / ПартияПрочихРасходов.НДСРегл, 2);
				НДСУпр =  Окр(ПартияПрочихРасходов.НДСУпр * НДСРегл / ПартияПрочихРасходов.НДСРегл, 2);
				
				НоваяСтрока = ПартииНДСКРаспределениюЭкспорт.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, ПартияПрочихРасходов, , "НДСРегл, СтоимостьРегл");
				
				НоваяСтрока.ДокументРеализации = СтрокаДокумент.Документ;
				
				НоваяСтрока.НДСРегл = НДСРегл;
				НоваяСтрока.СтоимостьРегл = СтоимостьРегл;
				НоваяСтрока.НДСУпр = НДСУпр;
				
				ПартияПрочихРасходов.НДСРегл = ПартияПрочихРасходов.НДСРегл - НДСРегл;
				ПартияПрочихРасходов.СтоимостьРегл = ПартияПрочихРасходов.СтоимостьРегл - СтоимостьРегл;
				ПартияПрочихРасходов.НДСУпр = ПартияПрочихРасходов.НДСУпр - НДСУпр;
				
				НДСОсталосьРаспределить = НДСОсталосьРаспределить - НДСРегл;
				
			КонецЦикла;
			
			Для Каждого РаспределеннаяПартия Из РаспределенныеПартии Цикл
				ПартииНДСКРаспределениюЭкспортДляРаспределения.Удалить(РаспределеннаяПартия);
			КонецЦикла;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура РаспределитьПартииНДСКРаспределениюЭкспортПоДокументамПрошлыхПериодов(ПартииНДСКРаспределениюЭкспорт, Реквизиты, МенеджерВременныхТаблиц)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ПартииНДСКРаспределениюЭкспорт.ПериодБазы                  КАК ПериодБазы,
	|	ПартииНДСКРаспределениюЭкспорт.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|	ПартииНДСКРаспределениюЭкспорт.ОснованиеКорректировки      КАК ОснованиеКорректировки
	|ПОМЕСТИТЬ ПартииПоДокументамПрошлыхПериодов
	|ИЗ
	|	ПартииНДСКРаспределениюЭкспорт КАК ПартииНДСКРаспределениюЭкспорт
	|ГДЕ
	|	ПартииНДСКРаспределениюЭкспорт.ПериодБазы < &ПериодБазы
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПериодБазы,
	|	ОснованиеКорректировки
	|;
	|
	|ВЫБРАТЬ
	|	ПартииПоДокументамПрошлыхПериодов.ДокументПоступленияРасходов КАК ДокументПоступленияРасходов,
	|	ПартииНДСКРаспределению.ДокументРеализации КАК ДокументРеализации,
	|	ПартииНДСКРаспределению.НДСРегл КАК Сумма
	|ИЗ
	|	ПартииПоДокументамПрошлыхПериодов КАК ПартииПоДокументамПрошлыхПериодов
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПартииНДСКРаспределению КАК ПартииНДСКРаспределению
	|	ПО
	|		КОНЕЦПЕРИОДА(ПартииНДСКРаспределению.Период, МЕСЯЦ) = ПартииПоДокументамПрошлыхПериодов.ПериодБазы
	|		И ПартииНДСКРаспределению.Регистратор ССЫЛКА Документ.РаспределениеНДС 
	|		И ПартииНДСКРаспределению.ДокументПоступленияРасходов = ПартииПоДокументамПрошлыхПериодов.ОснованиеКорректировки
	|		И ПартииНДСКРаспределению.ДокументРеализации <> НЕОПРЕДЕЛЕНО
	|;
	|
	|ВЫБРАТЬ
	|	*
	|ИЗ
	|	ПартииНДСКРаспределениюЭкспорт КАК ПартииНДСКРаспределениюЭкспорт
	|ГДЕ
	|	ПартииНДСКРаспределениюЭкспорт.ПериодБазы < &ПериодБазы
	|";
	
	Запрос.УстановитьПараметр("ПериодБазы", Реквизиты.ПериодБазы);
	Запрос.УстановитьПараметр("Ссылка", Реквизиты.Ссылка);
	
	Результат = Запрос.ВыполнитьПакет();
	
	ДокументыРеализации                         = Результат[Результат.Количество() - 2].Выгрузить();
	ПартииНДСКРаспределениюЭкспортДляРаспределения = Результат[Результат.Количество() - 1].Выгрузить();
	
	Если ПартииНДСКРаспределениюЭкспортДляРаспределения.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	ДокументыРеализации.Индексы.Добавить("ДокументПоступленияРасходов");
	ОтборДокументов = Новый Структура("ДокументПоступленияРасходов");
	
	Для Каждого Партия Из ПартииНДСКРаспределениюЭкспортДляРаспределения Цикл
		
		ЗаполнитьЗначенияСвойств(ОтборДокументов, Партия);
		ДокументыПоПартии = ДокументыРеализации.НайтиСтроки(ОтборДокументов);
		
		Если ДокументыПоПартии.Количество() = 0 Тогда
			// Не удалось найти документы реализации, добавим строку без распределения по документам.
			НоваяСтрока = ПартииНДСКРаспределениюЭкспорт.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, Партия); 
			Продолжить;
		КонецЕсли;
		
		МассивКоэффициентов = Новый Массив();
		Для Каждого Документ Из ДокументыПоПартии Цикл
			МассивКоэффициентов.Добавить(Документ.Сумма);
		КонецЦикла;
		
		РаспределениеСтоимостьРегл = ОбщегоНазначенияКлиентСервер.РаспределитьСуммуПропорциональноКоэффициентам(Партия.СтоимостьРегл, МассивКоэффициентов);
		РаспределениеНДСРегл = ОбщегоНазначенияКлиентСервер.РаспределитьСуммуПропорциональноКоэффициентам(Партия.НДСРегл, МассивКоэффициентов);
		РаспределениеНДСУпр = ОбщегоНазначенияКлиентСервер.РаспределитьСуммуПропорциональноКоэффициентам(Партия.НДСУпр, МассивКоэффициентов);
			
		Индекс = 0;
		Для Каждого Документ Из ДокументыПоПартии Цикл
			
			СтоимостьРегл = ?(РаспределениеСтоимостьРегл <> Неопределено, РаспределениеСтоимостьРегл[Индекс], 0);
			НДСРегл       = ?(РаспределениеНДСРегл       <> Неопределено, РаспределениеНДСРегл[Индекс], 0);
			НДСУпр        = ?(РаспределениеНДСУпр       <> Неопределено, РаспределениеНДСУпр[Индекс], 0);

			НоваяСтрока = ПартииНДСКРаспределениюЭкспорт.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, Партия);
			НоваяСтрока.СтоимостьРегл = СтоимостьРегл;
			НоваяСтрока.НДСРегл = НДСРегл;
			НоваяСтрока.НДСУпр = НДСУпр;
			НоваяСтрока.ДокументРеализации = Документ.ДокументРеализации;
			
			Индекс = Индекс + 1;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

Функция БазаРаспределения(ПартииНДСКРаспределению, Реквизиты)
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ПериодыБазы.ПериодБазы
	|ПОМЕСТИТЬ ПериодыБазы
	|ИЗ
	|	&ПериодыБазы КАК ПериодыБазы
	|;
	|
	|////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПериодыБазы.ПериодБазы,
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(РаспределениеНДС.ПрименитьПравило5Процентов, &ПрименитьПравило5Процентов) ТОГДА
	|			ЕСТЬNULL(РаспределениеНДС.ВыручкаНДС,   &ВыручкаНДС)
	|				+ ЕСТЬNULL(РаспределениеНДС.ВыручкаНеНДС, &ВыручкаНеНДС)
	|				+ ЕСТЬNULL(РаспределениеНДС.ВыручкаЕНВД,  &ВыручкаЕНВД)
	|			ИНАЧЕ ЕСТЬNULL(РаспределениеНДС.ВыручкаНДС, &ВыручкаНДС)
	|	КОНЕЦ КАК НДС,
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(РаспределениеНДС.ПрименитьПравило5Процентов, &ПрименитьПравило5Процентов)
	|			ТОГДА 0
	|			ИНАЧЕ ЕСТЬNULL(РаспределениеНДС.ВыручкаНеНДС, &ВыручкаНеНДС)
	|	КОНЕЦ КАК НеНДС,
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(РаспределениеНДС.ПрименитьПравило5Процентов, &ПрименитьПравило5Процентов)
	|			ТОГДА 0
	|			ИНАЧЕ ЕСТЬNULL(РаспределениеНДС.ВыручкаЕНВД, &ВыручкаЕНВД)
	|	КОНЕЦ КАК ЕНВД,
	|	ЕСТЬNULL(РаспределениеНДС.ВыручкаНДС0, &ВыручкаНДС0) КАК НДС0,
	|	ЕСТЬNULL(РаспределениеНДС.ВыручкаНДС0СырьевыеТоварыУслуги, &ВыручкаНДС0СырьевыеТоварыУслуги) КАК НДС0СырьевыеТоварыУслуги,
	|	ЕСТЬNULL(РаспределениеНДС.ВыручкаНДС0НесырьевыеТовары, &ВыручкаНДС0НесырьевыеТовары) КАК НДС0НесырьевыеТовары,
	|	
	|	ЕСТЬNULL(РаспределениеНДС.СписатьНДСПоРасходамАктивамНаСтатьиОтражения, 
	|				&СписатьНДСПоРасходамАктивамНаСтатьиОтражения) КАК СписатьНДСПоРасходамАктивамНаСтатьиОтражения,
	|	ЕСТЬNULL(РаспределениеНДС.СтатьяРасходовНеНДС, 
	|				&СтатьяРасходовНеНДС) КАК СтатьяРасходовНеНДС,
	|	ЕСТЬNULL(РаспределениеНДС.АналитикаРасходовНеНДС, 
	|				&АналитикаРасходовНеНДС) КАК АналитикаРасходовНеНДС,
	|	ЕСТЬNULL(РаспределениеНДС.СтатьяРасходовЕНВД, 
	|				&СтатьяРасходовЕНВД) КАК СтатьяРасходовЕНВД,
	|	ЕСТЬNULL(РаспределениеНДС.АналитикаРасходовЕНВД, 
	|				&АналитикаРасходовЕНВД) КАК АналитикаРасходовЕНВД,
	|	
	|	ВЫРАЗИТЬ(ЕСТЬNULL(РаспределениеНДС.СтатьяРасходовНеНДС, 
	|				&СтатьяРасходовНеНДС) КАК ПланВидовХарактеристик.СтатьиРасходов).ПринятиеКналоговомуУчету КАК СтатьяРасходовНеНДС_ПринимаетсяКНУ,
	|	ВЫРАЗИТЬ(ЕСТЬNULL(РаспределениеНДС.СтатьяРасходовЕНВД, 
	|				&СтатьяРасходовЕНВД) КАК ПланВидовХарактеристик.СтатьиРасходов).ПринятиеКналоговомуУчету КАК СтатьяРасходовЕНВД_ПринимаетсяКНУ
	|ИЗ
	|	ПериодыБазы КАК ПериодыБазы
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.РаспределениеНДС КАК РаспределениеНДС
	|	ПО
	|		ПериодыБазы.ПериодБазы = КОНЕЦПЕРИОДА(РаспределениеНДС.Дата, МЕСЯЦ)
	|		И РаспределениеНДС.Организация = &Организация 
	|		И РаспределениеНДС.Проведен
	|";
	
	ПериодыБазы = ПартииНДСКРаспределению.Скопировать();
	ПериодыБазы.Свернуть("ПериодБазы");
	
	Запрос.УстановитьПараметр("ПериодыБазы",                     ПериодыБазы);
	Запрос.УстановитьПараметр("Организация",                     Реквизиты.Организация);
	Запрос.УстановитьПараметр("ПрименитьПравило5Процентов",      Реквизиты.ПрименитьПравило5Процентов);
	Запрос.УстановитьПараметр("ВыручкаНДС",                      Реквизиты.ВыручкаНДС);
	Запрос.УстановитьПараметр("ВыручкаНеНДС",                    Реквизиты.ВыручкаНеНДС);
	Запрос.УстановитьПараметр("ВыручкаЕНВД",                     Реквизиты.ВыручкаЕНВД);
	Запрос.УстановитьПараметр("ВыручкаНДС0",                     Реквизиты.ВыручкаНДС0);
	Запрос.УстановитьПараметр("ВыручкаНДС0СырьевыеТоварыУслуги", Реквизиты.ВыручкаНДС0СырьевыеТоварыУслуги);
	Запрос.УстановитьПараметр("ВыручкаНДС0НесырьевыеТовары",     Реквизиты.ВыручкаНДС0НесырьевыеТовары);
	
	Запрос.УстановитьПараметр("СписатьНДСПоРасходамАктивамНаСтатьиОтражения", Реквизиты.СписатьНДСПоРасходамАктивамНаСтатьиОтражения);
	Запрос.УстановитьПараметр("СтатьяРасходовНеНДС",                          Реквизиты.СтатьяРасходовНеНДС);
	Запрос.УстановитьПараметр("АналитикаРасходовНеНДС",                       Реквизиты.АналитикаРасходовНеНДС);
	Запрос.УстановитьПараметр("СтатьяРасходовЕНВД",                           Реквизиты.СтатьяРасходовЕНВД);
	Запрос.УстановитьПараметр("АналитикаРасходовЕНВД",                        Реквизиты.АналитикаРасходовЕНВД);
	
	Результат = Запрос.Выполнить().Выгрузить();
	
	Возврат Результат;
	
КонецФункции

Функция ТаблицаРезультатРаспределения()
	
	НаборЗаписей = РегистрыНакопления.ПартииНДСКРаспределению.СоздатьНаборЗаписей();
	Результат = НаборЗаписей.ВыгрузитьКолонки();
	
	Результат.Колонки.Удалить("Активность");
	Результат.Колонки.Удалить("МоментВремени");
	
	Результат.Колонки.Добавить("ОснованиеКорректировки",  Метаданные.Документы.КорректировкаПриобретения.Реквизиты.ДокументОснование.Тип);
	Результат.Колонки.Добавить("ДатаПоступленияРасходов", Новый ОписаниеТипов("Дата"));
	
	Результат.Колонки.Добавить("НалогообложениеНДСПартии",         Новый ОписаниеТипов("ПеречислениеСсылка.ТипыНалогообложенияНДС"));
	Результат.Колонки.Добавить("ОрганизацияПолучатель",            Новый ОписаниеТипов("СправочникСсылка.Организации"));
	
	Результат.Колонки.Добавить("ВнеоборотныйАктив",                     Новый ОписаниеТипов("Строка"));
	Результат.Колонки.Добавить("ВключаетсяВРасходыНУПриПринятииКУчету", Новый ОписаниеТипов("Булево"));
	Результат.Колонки.Добавить("ПодразделениеРасходовНУ",               Новый ОписаниеТипов("СправочникСсылка.СтруктураПредприятия"));
	Результат.Колонки.Добавить("СтатьяРасходовНУ",                      Новый ОписаниеТипов("ПланВидовХарактеристикСсылка.СтатьиРасходов"));
	Результат.Колонки.Добавить("ЭтоПринимаемаяСтатьяРасходовНУ",        Новый ОписаниеТипов("Булево"));
	Результат.Колонки.Добавить("АналитикаРасходовНУ",                   Новый ОписаниеТипов(Метаданные.ПланыВидовХарактеристик.СтатьиРасходов.Тип, "NULL"));
	
	Возврат Результат;
	
КонецФункции

Функция ТаблицаПартииНДСКРаспределению(РезультатРаспределения, Реквизиты)
	
	ПартииНДСКРаспределению = РегистрыНакопления.ПартииНДСКРаспределению.СоздатьНаборЗаписей().ВыгрузитьКолонки();
	ПартииНДСКРаспределению.Колонки.Удалить("Активность");
	
	Для каждого ТаблицаРаспределения Из РезультатРаспределения Цикл
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределения.Значение, ПартииНДСКРаспределению);
	КонецЦикла;
	
	ПартииНДСКРаспределению.ЗаполнитьЗначения(ВидДвиженияНакопления.Расход, "ВидДвижения");
	ПартииНДСКРаспределению.ЗаполнитьЗначения(Реквизиты.Период,             "Период");
	
	Возврат ПартииНДСКРаспределению;
	
КонецФункции

Функция ТаблицаПрочиеРасходы(РезультатРаспределения, Реквизиты)
	
	ПрочиеРасходы = РегистрыНакопления.ПрочиеРасходы.СоздатьНаборЗаписей().ВыгрузитьКолонки();
	ПрочиеРасходы.Колонки.Удалить("Активность");
	
	ПрочиеРасходыДобавитьСтрокиВключениеВСтоимость(ПрочиеРасходы, РезультатРаспределения.ПартииНДСКРаспределениюНеОблагаетсяНДС, Реквизиты, Ложь);
	ПрочиеРасходыДобавитьСтрокиВключениеВСтоимость(ПрочиеРасходы, РезультатРаспределения.ПартииНДСКРаспределениюОблагаетсяЕНВД,  Реквизиты, Истина);
	
	ПрочиеРасходыДобавитьСтрокиИсключениеИзСтоимости(ПрочиеРасходы, РезультатРаспределения.ПартииНДСКРаспределениюОблагаетсяНДС, Реквизиты);
	ПрочиеРасходыДобавитьСтрокиИсключениеИзСтоимости(ПрочиеРасходы, РезультатРаспределения.ПартииНДСКРаспределениюЭкспорт,       Реквизиты);
	ПрочиеРасходыДобавитьСтрокиИсключениеИзСтоимости(ПрочиеРасходы, РезультатРаспределения.ПартииНДСКРаспределениюЭкспортНесырьевыхТоваров, Реквизиты);
	ПрочиеРасходыДобавитьСтрокиИсключениеИзСтоимости(ПрочиеРасходы, РезультатРаспределения.ПартииНДСКРаспределениюЭкспортСырьевыхТоваровУслуг, Реквизиты);
	
	Возврат ПрочиеРасходы;
	
КонецФункции

Процедура ПрочиеРасходыДобавитьСтрокиВключениеВСтоимость(ПрочиеРасходы, ТаблицаИсточник, Реквизиты, ЭтоРасходыЕНВД = Ложь)
	
	ИспользоватьВНА2_2 = ПолучитьФункциональнуюОпцию("ИспользоватьВнеоборотныеАктивы2_2");
	ИспользоватьВНА2_4 = Ложь;
	//++ НЕ УТ
	ИспользоватьВНА2_4 = ВнеоборотныеАктивы.ИспользуетсяУправлениеВНА_2_4(Реквизиты.Период);
	//-- НЕ УТ
	
	Для каждого Строка Из ТаблицаИсточник Цикл
		
		Если НЕ ПустаяСтрока(Строка.ВнеоборотныйАктив) 
			 И НЕ Строка.ВключаетсяВРасходыНУПриПринятииКУчету
			 И ИспользоватьВНА2_2 И НЕ ИспользоватьВНА2_4 Тогда 
			// В учете внеоборотные активов версии 2.2 данные хранятся в проводках
			Продолжить;
		КонецЕсли;
		
		Если Строка.НалогообложениеНДСПартии = Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС
				ИЛИ Строка.НалогообложениеНДСПартии = Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД Тогда
			// Уже в расходах
			Продолжить;
		КонецЕсли;
		
		Если НЕ ПустаяСтрока(Строка.ВнеоборотныйАктив) И Строка.ВключаетсяВРасходыНУПриПринятииКУчету Тогда
			Подразделение       = Строка.ПодразделениеРасходовНУ;
			СтатьяРасходов		= Строка.СтатьяРасходовНУ;
			АналитикаРасходов	= Строка.АналитикаРасходовНУ;
		ИначеЕсли ЗначениеЗаполнено(Строка.СтатьяОтраженияРасходов) Тогда
			Подразделение		= Строка.Подразделение;
			СтатьяРасходов		= Строка.СтатьяОтраженияРасходов;
			АналитикаРасходов	= Строка.АналитикаОтраженияРасходов;
		Иначе
			Подразделение		= Строка.Подразделение;
			СтатьяРасходов		= Строка.СтатьяРасходов;
			АналитикаРасходов	= Строка.АналитикаРасходов;
		КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(СтатьяРасходов) 
				ИЛИ ТипЗнч(СтатьяРасходов) <> Тип("ПланВидовХарактеристикСсылка.СтатьиРасходов") Тогда
			// Это не расходы
			Продолжить;
		КонецЕсли;
		
		НоваяСтрока = ПрочиеРасходы.Добавить();
		НоваяСтрока.Период					= Реквизиты.Период;
		НоваяСтрока.Организация				= Реквизиты.Организация;
		НоваяСтрока.ХозяйственнаяОперация	= Перечисления.ХозяйственныеОперации.РаспределениеНДС;
		НоваяСтрока.НаправлениеДеятельности = Строка.НаправлениеДеятельности;
		НоваяСтрока.Подразделение			= Подразделение;
		НоваяСтрока.СтатьяРасходов			= СтатьяРасходов;
		НоваяСтрока.АналитикаРасходов		= АналитикаРасходов;
		
		Если НЕ ПустаяСтрока(Строка.ВнеоборотныйАктив) И Строка.ВключаетсяВРасходыНУПриПринятииКУчету Тогда
			НоваяСтрока.ВременнаяРазница = -Строка.НДСРегл;
		Иначе
			НоваяСтрока.СуммаРегл = Строка.НДСРегл;
		КонецЕсли;
		Если НЕ Строка.ЭтоПринимаемаяСтатьяРасходовНУ Тогда
			НоваяСтрока.ПостояннаяРазница = Строка.НДСРегл;
		КонецЕсли;
		НоваяСтрока.СуммаУпр = Строка.НДСУпр;
		
		Если ЗначениеЗаполнено(Строка.ОрганизацияПолучатель)
		 И Строка.ОрганизацияПолучатель <> Строка.Организация Тогда
		 
			НоваяСтрокаУпр = ПрочиеРасходы.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрокаУпр, НоваяСтрока);
			НоваяСтрокаУпр.СуммаРегл = 0;
			НоваяСтрокаУпр.ПостояннаяРазница = 0;
			НоваяСтрокаУпр.ВременнаяРазница = 0;
			НоваяСтрокаУпр.СуммаУпр = -Строка.НДСУпр;
			НоваяСтрокаУпр.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторнированиеРасходовУУ;
			
			НоваяСтрокаУпр = ПрочиеРасходы.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрокаУпр, НоваяСтрока);
			НоваяСтрокаУпр.Организация = Строка.ОрганизацияПолучатель;
			НоваяСтрокаУпр.СуммаРегл = 0;
			НоваяСтрокаУпр.ПостояннаяРазница = 0;
			НоваяСтрокаУпр.ВременнаяРазница = 0;
			НоваяСтрокаУпр.СуммаУпр = Строка.НДСУпр;
			НоваяСтрокаУпр.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РегистрацияРасходовУУ;
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ПрочиеРасходыДобавитьСтрокиИсключениеИзСтоимости(ПрочиеРасходы, ТаблицаИсточник, Реквизиты)
	
	ИспользоватьВНА2_2 = ПолучитьФункциональнуюОпцию("ИспользоватьВнеоборотныеАктивы2_2");
	ИспользоватьВНА2_4 = Ложь;
	//++ НЕ УТ
	ИспользоватьВНА2_4 = ВнеоборотныеАктивы.ИспользуетсяУправлениеВНА_2_4(Реквизиты.Период);
	//-- НЕ УТ
	
	Для каждого Строка Из ТаблицаИсточник Цикл
		
		Если Не ПустаяСтрока(Строка.ВнеоборотныйАктив)
			 И ИспользоватьВНА2_2 И НЕ ИспользоватьВНА2_4 Тогда 
			// В учете внеоборотные активов версии 2.2 данные хранятся в проводках
			// Внеоборотные активы хранят данные в проводках
			Продолжить;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(Строка.СтатьяРасходов) Тогда
			// Это не расходы
			Продолжить;
		КонецЕсли;
		
		Если Строка.НалогообложениеНДСПартии <> Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС
			И Строка.НалогообложениеНДСПартии <> Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД Тогда
			Продолжить;
		КонецЕсли;
		
		НоваяСтрока = ПрочиеРасходы.Добавить();
		НоваяСтрока.Период					= Реквизиты.Период;
		НоваяСтрока.Организация				= Реквизиты.Организация;
		НоваяСтрока.Подразделение			= Строка.Подразделение;
		НоваяСтрока.НаправлениеДеятельности = Строка.НаправлениеДеятельности;
		НоваяСтрока.ХозяйственнаяОперация	= Перечисления.ХозяйственныеОперации.РаспределениеНДС;
		НоваяСтрока.СтатьяРасходов			= Строка.СтатьяРасходов;
		НоваяСтрока.АналитикаРасходов		= Строка.АналитикаРасходов;
		
		НоваяСтрока.СуммаРегл = -Строка.НДСРегл;
		Если НЕ Строка.ЭтоПринимаемаяСтатьяРасходовНУ Тогда
			НоваяСтрока.ПостояннаяРазница = -Строка.НДСРегл;
		КонецЕсли;
		НоваяСтрока.СуммаУпр = -Строка.НДСУпр;
		
		Если ЗначениеЗаполнено(Строка.ОрганизацияПолучатель)
		 И Строка.ОрганизацияПолучатель <> Строка.Организация Тогда
		 
			НоваяСтрокаУпр = ПрочиеРасходы.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрокаУпр, НоваяСтрока);
			НоваяСтрокаУпр.СуммаРегл = 0;
			НоваяСтрокаУпр.ПостояннаяРазница = 0;
			НоваяСтрокаУпр.ВременнаяРазница = 0;
			НоваяСтрокаУпр.СуммаУпр = Строка.НДСУпр;
			НоваяСтрокаУпр.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторнированиеРасходовУУ;
			
			НоваяСтрокаУпр = ПрочиеРасходы.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрокаУпр, НоваяСтрока);
			НоваяСтрокаУпр.Организация = Строка.ОрганизацияПолучатель;
			НоваяСтрокаУпр.СуммаРегл = 0;
			НоваяСтрокаУпр.ПостояннаяРазница = 0;
			НоваяСтрокаУпр.ВременнаяРазница = 0;
			НоваяСтрокаУпр.СуммаУпр = -Строка.НДСУпр;
			НоваяСтрокаУпр.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РегистрацияРасходовУУ;
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

//++ НЕ УТ

Функция ТаблицаОтражениеДокументовВРеглУчете(ПрочиеРасходы, Реквизиты)
	
	ОтражениеДокументов = РегистрыСведений.ОтражениеДокументовВРеглУчете.СоздатьНаборЗаписей().ВыгрузитьКолонки();
	
	Организации = ПрочиеРасходы.Скопировать(,"Период, Организация");
	Организации.Свернуть("Период, Организация");
	
	Для Каждого Строка Из Организации Цикл
		НоваяСтрока = ОтражениеДокументов.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка, "Период, Организация");
		НоваяСтрока.ДатаОтражения = НачалоДня(Строка.Период);
	КонецЦикла;
		
	Возврат ОтражениеДокументов;
	
КонецФункции

//-- НЕ УТ

#КонецОбласти

#Область ИнициализацияИЗаполнение

Функция ЗаполнитьПравилаСписанияНДС(Организация = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	|	ДанныеДокумента.СписатьНДСПоРасходамАктивамНаСтатьиОтражения КАК СписатьНДСПоРасходамАктивамНаСтатьиОтражения,
	|	ДанныеДокумента.СтатьяРасходовНеНДС КАК СтатьяРасходовНеНДС,
	|	ДанныеДокумента.АналитикаРасходовНеНДС КАК АналитикаРасходовНеНДС,
	|	ДанныеДокумента.СтатьяРасходовЕНВД КАК СтатьяРасходовЕНВД,
	|	ДанныеДокумента.АналитикаРасходовЕНВД КАК АналитикаРасходовЕНВД
	|ИЗ
	|	Документ.РаспределениеНДС КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.Проведен
	|	И (ВЫБОР
	|		КОГДА &Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ДанныеДокумента.Организация = &Организация
	|	КОНЕЦ)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеДокумента.Дата УБЫВ
	|";
	
	Запрос.УстановитьПараметр("Организация",?(Организация = Неопределено,Справочники.Организации.ПустаяСсылка(),Организация));
	
	Выборка = Запрос.Выполнить().Выбрать();
	ПравилаСписания = Новый Структура("СписатьНДСПоРасходамАктивамНаСтатьиОтражения,СтатьяРасходовНеНДС,АналитикаРасходовНеНДС,СтатьяРасходовЕНВД,АналитикаРасходовЕНВД");
	
	Если Выборка.Следующий() Тогда
		ЗаполнитьЗначенияСвойств(ПравилаСписания,Выборка);
	Иначе
		ПравилаСписания.СписатьНДСПоРасходамАктивамНаСтатьиОтражения	= 1;
	КонецЕсли;
	
	Возврат ПравилаСписания
	
КонецФункции

Функция ПолучитьБазуРаспределения(Дата, НачалоПериода, Организация, ВключатьВсеДокументыЭкспорта = Ложь) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ДанныеОснованийСчетовФактур.Организация КАК Организация,
	|	ВЫБОР 
	|		КОГДА ДанныеОснованийСчетовФактур.ИсправлениеОшибок ИЛИ ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон
	|			ТОГДА ДанныеОснованийСчетовФактур.КорректируемыйДокумент
	|		ИНАЧЕ ДанныеОснованийСчетовФактур.Регистратор
	|	КОНЕЦ КАК Документ,
	|	СУММА(ВЫБОР
	|		КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортНесырьевыхТоваров)
	|				И НЕ (ДанныеОснованийСчетовФактур.ИсправлениеОшибок ИЛИ ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон)
	|			ТОГДА ДанныеОснованийСчетовФактур.БазаНДСРегл 
	|		ИНАЧЕ 0
	|	КОНЕЦ) КАК СуммаНесырьевыеТовары,
	|	СУММА(ВЫБОР
	|		КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС В (
	|						ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортСырьевыхТоваровУслуг),
	|						ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНаЭкспорт))
	|				И НЕ (ДанныеОснованийСчетовФактур.ИсправлениеОшибок ИЛИ ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон)
	|			ТОГДА ДанныеОснованийСчетовФактур.БазаНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ)                               КАК СуммаСырьевыеТоварыУслуги,
	|	СУММА(ВЫБОР
	|		КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортНесырьевыхТоваров)
	|				И (ДанныеОснованийСчетовФактур.ИсправлениеОшибок ИЛИ ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон)
	|			ТОГДА ДанныеОснованийСчетовФактур.БазаНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ)                               КАК КорректировкаНесырьевыеТовары,
	|	СУММА(ВЫБОР
	|		КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС В (
	|						ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортСырьевыхТоваровУслуг),
	|						ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНаЭкспорт))
	|				И (ДанныеОснованийСчетовФактур.ИсправлениеОшибок ИЛИ ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон)
	|			ТОГДА ДанныеОснованийСчетовФактур.БазаНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ)                               КАК КорректировкаСырьевыеТоварыУслуги
	|ПОМЕСТИТЬ ДокументыЭкспорт
	|ИЗ
	|	РегистрСведений.ДанныеОснованийСчетовФактур КАК ДанныеОснованийСчетовФактур
	|ГДЕ
	|	ДанныеОснованийСчетовФактур.Период МЕЖДУ &ПериодНачало И &ПериодОкончание
	|	И ДанныеОснованийСчетовФактур.Организация В (&Организация)
	|	И ДанныеОснованийСчетовФактур.НалогообложениеНДС В (ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНаЭкспорт),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортНесырьевыхТоваров),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ЭкспортСырьевыхТоваровУслуг))
	|СГРУППИРОВАТЬ ПО
	|	ДанныеОснованийСчетовФактур.Организация,
	|	ВЫБОР
	|		КОГДА ДанныеОснованийСчетовФактур.ИсправлениеОшибок ИЛИ ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон
	|			ТОГДА ДанныеОснованийСчетовФактур.КорректируемыйДокумент
	|		ИНАЧЕ ДанныеОснованийСчетовФактур.Регистратор
	|	КОНЕЦ
	|;
	|
	|///////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаДанных.Организация КАК Организация,
	|	СУММА(ТаблицаДанных.ВыручкаНДС) КАК ВыручкаНДС,
	|	СУММА(ТаблицаДанных.ВыручкаНеРФ) КАК ВыручкаНеРФ,
	|	СУММА(ТаблицаДанных.ВыручкаНеНДС) КАК ВыручкаНеНДС,
	|	СУММА(ТаблицаДанных.ВыручкаЕНВД) КАК ВыручкаЕНВД,
	|	СУММА(ТаблицаДанных.ВыручкаНДС0) КАК ВыручкаНДС0,
	|	СУММА(ТаблицаДанных.ВыручкаНДС0СырьевыеТоварыУслуги) КАК ВыручкаНДС0СырьевыеТоварыУслуги,
	|	СУММА(ТаблицаДанных.ВыручкаНДС0НесырьевыеТовары) КАК ВыручкаНДС0НесырьевыеТовары
	|ИЗ
	|	(ВЫБРАТЬ
	|		НДСЗаписиКнигиПродажОбороты.Организация КАК Организация,
	|		ЕСТЬNULL(НДСЗаписиКнигиПродажОбороты.СуммаБезНДСОборот,0) КАК ВыручкаНДС,
	|		0 КАК ВыручкаНеРФ,
	|		0 КАК ВыручкаНеНДС,
	|		0 КАК ВыручкаЕНВД,
	|		0 КАК ВыручкаНДС0,
	|		0 КАК ВыручкаНДС0СырьевыеТоварыУслуги,
	|		0 КАК ВыручкаНДС0НесырьевыеТовары
	|	ИЗ
	|		РегистрНакопления.НДСЗаписиКнигиПродаж.Обороты(
	|				&ПериодНачало,
	|				&ПериодОкончание,
	|				Квартал,
	|				Организация В (&Организация)
	|					И Событие В (ЗНАЧЕНИЕ(Перечисление.СобытияПоНДСПродажи.Реализация), 
	|								ЗНАЧЕНИЕ(Перечисление.СобытияПоНДСПродажи.НалогИсчисляетПокупатель))
	|					И НЕ ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.АвансыПолученные)
	|					И НЕ СтавкаНДС В (ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС0), ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС))) КАК НДСЗаписиКнигиПродажОбороты
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НДСЗаписиКнигиПродажОбороты.Организация,
	|		ЕСТЬNULL(НДСЗаписиКнигиПродажОбороты.СуммаБезНДСОборот,0),
	|		ЕСТЬNULL(НДСЗаписиКнигиПродажОбороты.СуммаБезНДСОборот,0),
	|		0,
	|		0,
	|		0,
	|		0,
	|		0
	|	ИЗ
	|		РегистрНакопления.НДСЗаписиКнигиПродаж.Обороты(
	|				&ПериодНачало,
	|				&ПериодОкончание,
	|				Квартал,
	|				Организация В (&Организация)
	|					И ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.УслугиНеНаТерриторииРФ)) КАК НДСЗаписиКнигиПродажОбороты
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НДСЗаписиКнигиПродажОбороты.Организация,
	|		0,
	|		0,
	|		ЕСТЬNULL(НДСЗаписиКнигиПродажОбороты.СуммаБезНДСОборот,0),
	|		0,
	|		0,
	|		0,
	|		0
	|	ИЗ
	|		РегистрНакопления.НДСЗаписиКнигиПродаж.Обороты(
	|				&ПериодНачало,
	|				&ПериодОкончание,
	|				Квартал,
	|				Организация В (&Организация)
	|					И Событие = ЗНАЧЕНИЕ(Перечисление.СобытияПоНДСПродажи.Реализация)
	|					И ВидЦенности <> ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.УслугиНеНаТерриторииРФ)
	|					И СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)) КАК НДСЗаписиКнигиПродажОбороты
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	// На основании корректировов ""Без НДС"" ИСФ и КСФ могут не создаваться, поэтому получим данные документов
	|	ВЫБРАТЬ
	|		ДанныеОснованийСчетовФактур.Организация,
	|		ВЫБОР
	|			КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.РеализацияРаботУслугНаЭкспорт)
	|				ТОГДА ДанныеОснованийСчетовФактур.БазаНДСРегл
	|			ИНАЧЕ 0
	|		КОНЕЦ,
	|		ВЫБОР
	|			КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.РеализацияРаботУслугНаЭкспорт)
	|				ТОГДА ДанныеОснованийСчетовФактур.БазаНДСРегл
	|			ИНАЧЕ 0
	|		КОНЕЦ,
	|		ВЫБОР
	|			КОГДА ДанныеОснованийСчетовФактур.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.РеализацияРаботУслугНаЭкспорт)
	|				ТОГДА 0
	|			ИНАЧЕ ДанныеОснованийСчетовФактур.БазаНДСРегл
	|		КОНЕЦ,
	|		0,
	|		0,
	|		0,
	|		0
	|	ИЗ
	|		РегистрСведений.ДанныеОснованийСчетовФактур КАК ДанныеОснованийСчетовФактур
	|		ЛЕВОЕ СОЕДИНЕНИЕ
	|			Документ.СчетФактураВыданный.ДокументыОснования КАК СчетФактураВыданныйДокументОснования
	|		ПО
	|			ДанныеОснованийСчетовФактур.Регистратор = СчетФактураВыданныйДокументОснования.ДокументОснование
	|			И ДанныеОснованийСчетовФактур.Организация = СчетФактураВыданныйДокументОснования.Ссылка.Организация
	|			И СчетФактураВыданныйДокументОснования.Ссылка.Проведен
	|	ГДЕ
	|		ДанныеОснованийСчетовФактур.Период МЕЖДУ &ПериодНачало И &ПериодОкончание
	|		И ДанныеОснованийСчетовФактур.Организация В (&Организация)
	|		И (ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон 
	|			ИЛИ ДанныеОснованийСчетовФактур.ИсправлениеОшибок)
	|		И ДанныеОснованийСчетовФактур.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
	|		И ДанныеОснованийСчетовФактур.ТипЗапасов В (&ТипЗапасовСобственные)
	|		И ДанныеОснованийСчетовФактур.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НачисленияПоЗаймамВыданным.Организация,
	|		0,
	|		0,
	|		НачисленияПоЗаймамВыданным.СуммаРеглОборот,
	|		0,
	|		0,
	|		0,
	|		0
	|	ИЗ
	|		РегистрНакопления.ДвиженияКонтрагентДоходыРасходы.Обороты(
	|			&ПериодНачало, 
	|			&ПериодОкончание,
	|			Квартал,
	|			ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачисленияПоЗаймамВыданным)
	|				И Организация В (&Организация)) КАК НачисленияПоЗаймамВыданным
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НачисленияПоЗаймамВыданным.Организация,
	|		0,
	|		0,
	|		НачисленияПоЗаймамВыданным.СуммаРеглОборот,
	|		0,
	|		0,
	|		0,
	|		0
	|	ИЗ
	|		РегистрНакопления.ДвиженияДоходыРасходыПрочиеАктивыПассивы.Обороты(
	|			&ПериодНачало, 
	|			&ПериодОкончание,
	|			Квартал,
	|			ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачисленияПоЗаймамВыданным)
	|				И Организация В (&Организация)) КАК НачисленияПоЗаймамВыданным
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		АналитикаПоПартнерам.Организация,
	|		0,
	|		0,
	|		0,
	|		ЕСТЬNULL(ВыручкаИСебестоимостьПродаж.СуммаВыручкиРегл,0),
	|		0,
	|		0,
	|		0
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ВыручкаИСебестоимостьПродаж
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|			Справочник.КлючиАналитикиУчетаПоПартнерам КАК АналитикаПоПартнерам
	|		ПО 
	|			ВыручкаИСебестоимостьПродаж.АналитикаУчетаПоПартнерам = АналитикаПоПартнерам.Ссылка
	|	ГДЕ
	|		АналитикаПоПартнерам.Организация В (&Организация)
	|		И ВыручкаИСебестоимостьПродаж.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|		И ВыручкаИСебестоимостьПродаж.Период МЕЖДУ &ПериодНачало И &ПериодОкончание
	|		И ВыручкаИСебестоимостьПродаж.Активность
	|		И ВыручкаИСебестоимостьПродаж.ТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДокументыЭкспорт.Организация КАК Организация,
	|		0 КАК ВыручкаНДС,
	|		0 КАК ВыручкаНеРФ,
	|		0 КАК ВыручкаНеНДС,
	|		0 КАК ВыручкаЕНВД,
	|		(ДокументыЭкспорт.СуммаНесырьевыеТовары             
	|			+ ДокументыЭкспорт.СуммаСырьевыеТоварыУслуги         
	|			+ ДокументыЭкспорт.КорректировкаНесырьевыеТовары     
	|			+ ДокументыЭкспорт.КорректировкаСырьевыеТоварыУслуги) КАК ВыручкаНДС0,
	|		(ДокументыЭкспорт.СуммаСырьевыеТоварыУслуги 
	|			+ ДокументыЭкспорт.КорректировкаСырьевыеТоварыУслуги) КАК ВыручкаНДС0СырьевыеТоварыУслуги,
	|		(ДокументыЭкспорт.СуммаНесырьевыеТовары
	|			+ ДокументыЭкспорт.КорректировкаНесырьевыеТовары)     КАК ВыручкаНДС0НесырьевыеТовары
	|	ИЗ
	|		ДокументыЭкспорт КАК ДокументыЭкспорт
	|	) КАК ТаблицаДанных
	|
	|СГРУППИРОВАТЬ ПО
	|	ТаблицаДанных.Организация
	|;
	|
	|ВЫБРАТЬ
	|	ДокументыЭкспорт.Организация   КАК Организация,
	|	ДокументыЭкспорт.Документ      КАК Документ,
	|	ВЫБОР 
	|		КОГДА &УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту И НЕ &ВключатьВсеДокументыЭкспорта
	|			ТОГДА СУММА(ДокументыЭкспорт.СуммаСырьевыеТоварыУслуги)
	|			ИНАЧЕ СУММА(ДокументыЭкспорт.СуммаНесырьевыеТовары + ДокументыЭкспорт.СуммаСырьевыеТоварыУслуги) 
	|	КОНЕЦ КАК СуммаВыручки,
	|	ВЫБОР 
	|		КОГДА &УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту И НЕ &ВключатьВсеДокументыЭкспорта
	|			ТОГДА СУММА(ДокументыЭкспорт.КорректировкаСырьевыеТоварыУслуги)
	|			ИНАЧЕ СУММА(ДокументыЭкспорт.КорректировкаНесырьевыеТовары + ДокументыЭкспорт.КорректировкаСырьевыеТоварыУслуги) 
	|	КОНЕЦ КАК КорректировкаВыручки
	|ИЗ
	|	ДокументыЭкспорт КАК ДокументыЭкспорт
	|
	|СГРУППИРОВАТЬ ПО
	|	ДокументыЭкспорт.Организация,
	|	ДокументыЭкспорт.Документ
	|
	|ИМЕЮЩИЕ
	|	ВЫБОР 
	|		КОГДА &УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту И НЕ &ВключатьВсеДокументыЭкспорта
	|			ТОГДА СУММА(ДокументыЭкспорт.СуммаСырьевыеТоварыУслуги)
	|			ИНАЧЕ СУММА(ДокументыЭкспорт.СуммаНесырьевыеТовары + ДокументыЭкспорт.СуммаСырьевыеТоварыУслуги) 
	|	КОНЕЦ <> 0
	|	ИЛИ ВЫБОР 
	|		КОГДА &УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту И НЕ &ВключатьВсеДокументыЭкспорта
	|			ТОГДА СУММА(ДокументыЭкспорт.КорректировкаСырьевыеТоварыУслуги)
	|			ИНАЧЕ СУММА(ДокументыЭкспорт.КорректировкаНесырьевыеТовары + ДокументыЭкспорт.КорректировкаСырьевыеТоварыУслуги) 
	|	КОНЕЦ <> 0
	|";
	
	ПериодНачало = НачалоПериода;
	ПериодОкончание = КонецКвартала(Дата);
	//++ НЕ УТ
	Если Месяц(Дата)%3 <> 0 Тогда
		ПериодОкончание = КонецМесяца(Дата);
	КонецЕсли;
	//-- НЕ УТ
	
	Запрос.УстановитьПараметр("ПериодНачало", ПериодНачало);
	Запрос.УстановитьПараметр("ПериодОкончание", ПериодОкончание);
	
	Запрос.УстановитьПараметр("ТипЗапасовСобственные", УчетНДСУПСлужебный.ТипыЗапасовСобственные());
	
	Если ТипЗнч(Организация) = Тип("СправочникСсылка.Организации") Тогда
		МассивОрганизаций = Новый Массив();
		МассивОрганизаций.Добавить(Организация);
		Запрос.УстановитьПараметр("Организация", МассивОрганизаций);
	Иначе
		Запрос.УстановитьПараметр("Организация", Организация)
	КонецЕсли;
	
	УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту = УчетНДСРФ.УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту(Дата);
	Запрос.УстановитьПараметр("УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту", УпрощенныйПорядокВычетаНДСПоНесырьевомуЭкспорту);
	Запрос.УстановитьПараметр("ВключатьВсеДокументыЭкспорта", ВключатьВсеДокументыЭкспорта);
	
	Результат = Запрос.ВыполнитьПакет();
	
	ТаблицаВыручка          = Результат[1].Выгрузить(); 
	ТаблицаДокументыЭкспорт = Результат[2].Выгрузить();
	
	Результат = Новый Структура;
	Результат.Вставить("ВыручкаНДС",                      ТаблицаВыручка.Итог("ВыручкаНДС"));
	Результат.Вставить("ВыручкаНеРФ",                     ТаблицаВыручка.Итог("ВыручкаНеРФ"));
	Результат.Вставить("ВыручкаНеНДС",                    ТаблицаВыручка.Итог("ВыручкаНеНДС"));
	Результат.Вставить("ВыручкаЕНВД",                     ТаблицаВыручка.Итог("ВыручкаЕНВД"));
	Результат.Вставить("ВыручкаНДС0",                     ТаблицаВыручка.Итог("ВыручкаНДС0"));
	Результат.Вставить("ВыручкаНДС0НесырьевыеТовары",     ТаблицаВыручка.Итог("ВыручкаНДС0НесырьевыеТовары"));
	Результат.Вставить("ВыручкаНДС0СырьевыеТоварыУслуги", ТаблицаВыручка.Итог("ВыручкаНДС0СырьевыеТоварыУслуги"));
	
	Результат.Вставить("ДокументыЭкспорт", ТаблицаДокументыЭкспорт);
	
	Возврат Результат
	
КонецФункции

Функция ПолучитьНачалоРасширенногоНалоговогоПериода(Дата, Организация) Экспорт
	
	БлижайшийНалоговыйПериод = УчетНДСПереопределяемый.БлижайшийНалоговыйПериод(
		Организация,
		Дата);
	
	Если БлижайшийНалоговыйПериод.Начало <> БлижайшийНалоговыйПериод.Период Тогда
		НачалоНалоговогоПериода = БлижайшийНалоговыйПериод.Начало;
	Иначе
		НачалоНалоговогоПериода = НачалоКвартала(Дата);
	КонецЕсли;
	
	Если НачалоКвартала(Дата) < НачалоНалоговогоПериода Тогда
		НачалоПериода = НачалоКвартала(Дата);
	Иначе
		Если НачалоМесяца(Дата) = НачалоКвартала(Дата) Тогда
			// В первом месяце квартала производится распределение НДС по ОС и НМА
			// принятым к учету в этом месяце.
			// В случае расширенного налогового периода по НДС (п.2 ст.55 НК) необходимо
			// учесть ОС и НМА, приобретенные с момента регистрации до конца предыдущего квартала.
			НачалоПериода = НачалоНалоговогоПериода;
		ИначеЕсли КонецМесяца(Дата) <> КонецКвартала(Дата) Тогда
			// Во втором месяце квартала производится распределение НДС по ОС и НМА
			// принятым к учету в этом месяце. 
			// Для распределения необходимо учитывать выручку за месяц ввода в эксплуатацию.
			НачалоПериода = НачалоМесяца(Дата);
		Иначе
			НачалоПериода = НачалоНалоговогоПериода;
		КонецЕсли;
	КонецЕсли;
	
	Возврат НачалоПериода;

КонецФункции

#КонецОбласти

#Область ОбновлениеИнформационнойБазы

#КонецОбласти

#КонецОбласти

#КонецЕсли
