
#Область ПрограммныйИнтерфейс

#Область ОбработчикиСобытий

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый документ.
//  Отказ - Булево - Признак проведения документа.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то проведение документа выполнено не будет.
//  РежимПроведения - РежимПроведенияДокумента - В данный параметр передается текущий режим проведения.
//
Процедура ОбработкаПроведения(Объект, Отказ, РежимПроведения) Экспорт
	
	Движения = Объект.Движения;
	ДополнительныеСвойства = Объект.ДополнительныеСвойства;
	//++ Локализация
	//++ НЕ УТ
	РеглУчетПроведениеСервер.ЗарегистрироватьКОтражению(Объект, ДополнительныеСвойства, Движения, Отказ);
	УчетУСНСервер.ОтразитьДоходКУДиР(ДополнительныеСвойства, Движения, Отказ);
	//-- НЕ УТ
	//-- Локализация
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то будет выполнен отказ от продолжения работы после выполнения проверки заполнения.
//  ПроверяемыеРеквизиты - Массив - Массив путей к реквизитам, для которых будет выполнена проверка заполнения.
//
Процедура ОбработкаПроверкиЗаполнения(Объект, Отказ, ПроверяемыеРеквизиты) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект.
//  ДанныеЗаполнения - Произвольный - Значение, которое используется как основание для заполнения.
//  СтандартнаяОбработка - Булево - В данный параметр передается признак выполнения стандартной (системной) обработки события.
//
Процедура ОбработкаЗаполнения(Объект, ДанныеЗаполнения, СтандартнаяОбработка) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Признак отказа от записи.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то запись выполнена не будет и будет вызвано исключение.
//
Процедура ОбработкаУдаленияПроведения(Объект, Отказ) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Признак отказа от записи.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то запись выполнена не будет и будет вызвано исключение.
//  РежимЗаписи - РежимЗаписиДокумента - В параметр передается текущий режим записи документа. Позволяет определить в теле процедуры режим записи.
//  РежимПроведения - РежимПроведенияДокумента - В данный параметр передается текущий режим проведения.
//
Процедура ПередЗаписью(Объект, Отказ, РежимЗаписи, РежимПроведения) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Признак отказа от записи.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина, то запись выполнена не будет и будет вызвано исключение.
//
Процедура ПриЗаписи(Объект, Отказ) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  ОбъектКопирования - ДокументОбъект.<Имя документа> - Исходный документ, который является источником копирования.
//
Процедура ПриКопировании(Объект, ОбъектКопирования) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#Область ПодключаемыеКоманды

// Определяет список команд создания на основании.
//
// Параметры:
//   КомандыСозданияНаОсновании - ТаблицаЗначений - Таблица с командами создания на основании. Для изменения.
//       См. описание 1 параметра процедуры СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании().
//   Параметры - Структура - Вспомогательные параметры. Для чтения.
//       См. описание 2 параметра процедуры СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании().
//
Процедура ДобавитьКомандыСозданияНаОсновании(КомандыСозданияНаОсновании, Параметры) Экспорт
	
	
КонецПроцедуры

// Добавляет команду создания документа "Авансовый отчет".
//
// Параметры:
//   КомандыСозданияНаОсновании - ТаблицаЗначений - Таблица с командами создания на основании. Для изменения.
//       См. описание 1 параметра процедуры СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании().
//
Процедура ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании) Экспорт


КонецПроцедуры

// Определяет список команд отчетов.
//
// Параметры:
//   КомандыОтчетов - ТаблицаЗначений - Таблица с командами отчетов. Для изменения.
//       См. описание 1 параметра процедуры ВариантыОтчетовПереопределяемый.ПередДобавлениемКомандОтчетов().
//   Параметры - Структура - Вспомогательные параметры. Для чтения.
//       См. описание 2 параметра процедуры ВариантыОтчетовПереопределяемый.ПередДобавлениемКомандОтчетов().
//
Процедура ДобавитьКомандыОтчетов(КомандыОтчетов, Параметры) Экспорт
	
	
КонецПроцедуры

// Заполняет список команд печати.
//
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати.
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#Область Печать

// Формирует печатные формы.
//
// Параметры:
//  МассивОбъектов  - Массив    - ссылки на объекты, которые нужно распечатать;
//  ПараметрыПечати - Структура - дополнительные настройки печати;
//  КоллекцияПечатныхФорм - ТаблицаЗначений - сформированные табличные документы (выходной параметр)
//  ОбъектыПечати         - СписокЗначений  - значение - ссылка на объект;
//                                            представление - имя области в которой был выведен объект (выходной параметр);
//  ПараметрыВывода       - Структура       - дополнительные параметры сформированных табличных документов (выходной параметр).
//
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

//++ НЕ УТ

#Область ПроводкиРегУчета

// Функция возвращает текст запроса для отражения документа в регламентированном учете.
//
// Возвращаемое значение:
//	Строка - Текст запроса
//
Функция ТекстОтраженияВРеглУчете() Экспорт
	
	//++ Локализация
	
#Область ВзаимозачетСФилиалами // (Дт 6Х.ХХ :: Кт 79.02), (Дт 79.02 :: Кт 6Х.ХХ)

	ТекстВзаимозачетаСФилиалами = ТекстВзаимозачетаСФилиалами();

#КонецОбласти

#Область ВзаимозачетЧерез76    // (Дт 6Х.ХХ :: Кт 76.Х9), (Дт 76.Х9 :: Кт 6Х.ХХ)

	ТекстВзаимозачетаЧерез76 = 
	"
	|ВЫБРАТЬ // Дт 6Х.ХХ - Кт 76.Х9
	|	ДвиженияКК.Регистратор,
	|	ДвиженияКК.Период,
	|	ДвиженияКК.Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ДвиженияКК.СуммаРегл КАК Сумма,	
	|	ДвиженияКК.Сумма	 КАК СуммаУУ,
	|	
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация = ВЫРАЗИТЬ(ДвиженияКК.КорКонтрагент КАК Справочник.Организации).ГоловнаяОрганизация
	|				ИЛИ ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.КорКонтрагент
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ТИПЗНАЧЕНИЯ(ДвиженияКК.КорОбъектРасчетов) = ТИП(Документ.ВозвратТоваровПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыПоПретензиям)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансВыданный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансПолученный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыПолученные)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгКлиента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСКлиентами)
	|	КОНЕЦ КАК ВидСчетаДт,
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация <> ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Организация, ДвиженияКК.Организация)
	|		ТОГДА ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ДвиженияКК.КорВалютаВзаиморасчетов КАК ВалютаДт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеДт,
	|	ДвиженияКК.КорНаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация = ВЫРАЗИТЬ(ДвиженияКК.КорКонтрагент КАК Справочник.Организации).ГоловнаяОрганизация
	|				ИЛИ ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.КорКонтрагент
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоТекущимОперациям)
	|		ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|	КОНЕЦ КАК СчетДт,
	|	
	|	ДвиженияКК.КорКонтрагент КАК СубконтоДт1,
	|	ДвиженияКК.КорДоговор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	ДвиженияКК.КорСуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	ДвиженияКК.КорВалютаВзаиморасчетов КАК ВалютаКт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|
	|	ВЫБОР КОГДА ДвиженияКК.КорВалютаВзаиморасчетов = Константы.ВалютаРегламентированногоУчета ТОГДА
	|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПрочиеРасчетыСРазнымиДебиторамиИКредиторами)
	|	ИНАЧЕ
	|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПрочиеРасчетыСРазнымиДебиторамиИКредиторамиУЕ)
	|	КОНЕЦ КАК СчетКт,
	|	
	|	ДвиженияКК.КорКонтрагент КАК СубконтоКт1,
	|	ДвиженияКК.КорДоговор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	ДвиженияКК.КорСуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Взаимозачет задолженности через транзитный счет"" КАК Содержание
	|	
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВзаимозачетЗадолженности КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.ДвиженияКонтрагентКонтрагент КАК ДвиженияКК
	|	ПО
	|		Операция.Ссылка = ДвиженияКК.Регистратор
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		втУчетнаяПолитика КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		ДвиженияКК.Регистратор = УчетнаяПолитикаОрганизаций.Ссылка
	|		И ДвиженияКК.Организация.ГоловнаяОрганизация = УчетнаяПолитикаОрганизаций.Организация.ГоловнаяОрганизация
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Константы КАК Константы
	|	ПО 
	|		ИСТИНА
	|ГДЕ
	|	ДвиженияКК.Организация.ГоловнаяОрганизация <> ЕСТЬNULL(ДвиженияКК.Контрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|	И ДвиженияКК.Организация.ГоловнаяОрганизация <> ЕСТЬNULL(ДвиженияКК.КорКонтрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|	И ДвиженияКК.ТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И ДвиженияКК.КорТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И ЕСТЬNULL(УчетнаяПолитикаОрганизаций.УчетнаяПолитика.ВзаимозачетЧерезСчет76, ЛОЖЬ)
	|	
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ // Дт 76.Х9 - Кт 6Х.ХХ
	|	ДвиженияКК.Регистратор,
	|	ДвиженияКК.Период,
	|	ДвиженияКК.Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ДвиженияКК.СуммаРегл КАК Сумма,	
	|	ДвиженияКК.Сумма	 КАК СуммаУУ,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ДвиженияКК.КорВалютаВзаиморасчетов КАК ВалютаДт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеДт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР КОГДА ДвиженияКК.КорВалютаВзаиморасчетов = Константы.ВалютаРегламентированногоУчета ТОГДА
	|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПрочиеРасчетыСРазнымиДебиторамиИКредиторами)
	|	ИНАЧЕ
	|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПрочиеРасчетыСРазнымиДебиторамиИКредиторамиУЕ)
	|	КОНЕЦ КАК СчетДт,
	|	
	|	ДвиженияКК.КорКонтрагент КАК СубконтоДт1,
	|	ДвиженияКК.КорДоговор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	ДвиженияКК.КорСуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация = ВЫРАЗИТЬ(ДвиженияКК.Контрагент КАК Справочник.Организации).ГоловнаяОрганизация
	|				ИЛИ ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.Контрагент
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ТИПЗНАЧЕНИЯ(ДвиженияКК.ОбъектРасчетов) = ТИП(Документ.ВозвратТоваровПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыПоПретензиям)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансВыданный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансПолученный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыПолученные)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгКлиента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСКлиентами)
	|	КОНЕЦ КАК ВидСчетаКт,
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация <> ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.Организация, ДвиженияКК.Организация)
	|		ТОГДА ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|	КОНЕЦ КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	ДвиженияКК.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеКт,
	|	ДвиженияКК.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация = ВЫРАЗИТЬ(ДвиженияКК.Контрагент КАК Справочник.Организации).ГоловнаяОрганизация
	|				ИЛИ ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.Контрагент
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоТекущимОперациям)
	|		ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|	КОНЕЦ КАК СчетКт,
	|	
	|	ДвиженияКК.Контрагент КАК СубконтоКт1,
	|	ДвиженияКК.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	ДвиженияКК.СуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Взаимозачет задолженности через транзитный счет"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВзаимозачетЗадолженности КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.ДвиженияКонтрагентКонтрагент КАК ДвиженияКК
	|	ПО 
	|		Операция.Ссылка = ДвиженияКК.Регистратор
	|		
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		втУчетнаяПолитика КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		ДвиженияКК.Регистратор = УчетнаяПолитикаОрганизаций.Ссылка
	|		И ДвиженияКК.Организация.ГоловнаяОрганизация = УчетнаяПолитикаОрганизаций.Организация.ГоловнаяОрганизация
	|		
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		Константы КАК Константы
	|	ПО 
	|		ИСТИНА
	|ГДЕ
	|	ДвиженияКК.Организация.ГоловнаяОрганизация <> ЕСТЬNULL(ДвиженияКК.Контрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|	И ДвиженияКК.Организация.ГоловнаяОрганизация <> ЕСТЬNULL(ДвиженияКК.КорКонтрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|	И ДвиженияКК.ТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И ДвиженияКК.КорТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И ЕСТЬNULL(УчетнаяПолитикаОрганизаций.УчетнаяПолитика.ВзаимозачетЧерезСчет76, ЛОЖЬ)
	|";
	
#КонецОбласти

#Область ВзаимозачетНапрямую   // (Дт 6Х.ХХ :: Кт 6Х.ХХ)

	ТекстВзаимозачетаНапрямую = 
	"
	|ВЫБРАТЬ // Дт 6Х.ХХ - Кт 6Х.ХХ
	|	ДвиженияКК.Регистратор,
	|	ДвиженияКК.Период,
	|	ДвиженияКК.Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ДвиженияКК.СуммаРегл КАК Сумма,	
	|	ДвиженияКК.Сумма	 КАК СуммаУУ,
	|	
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДвиженияКК.КорОбъектРасчетов) = ТИП(Документ.ВозвратТоваровПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыПоПретензиям)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансВыданный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансПолученный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыПолученные)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгКлиента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСКлиентами)
	|	КОНЕЦ КАК ВидСчетаДт,
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация <> ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Организация, ДвиженияКК.Организация)
	|		ТОГДА ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ДвиженияКК.КорВалютаВзаиморасчетов КАК ВалютаДт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеДт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	ДвиженияКК.КорКонтрагент КАК СубконтоДт1,
	|	ДвиженияКК.КорДоговор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	ДвиженияКК.КорСуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДвиженияКК.ОбъектРасчетов) = ТИП(Документ.ВозвратТоваровПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыПоПретензиям)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансВыданный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансПолученный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыПолученные)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгКлиента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСКлиентами)
	|	КОНЕЦ КАК ВидСчетаКт,
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация <> ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.Организация, ДвиженияКК.Организация)
	|		ТОГДА ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|	КОНЕЦ КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	ДвиженияКК.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеКт,
	|	ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	
	|	ДвиженияКК.Контрагент КАК СубконтоКт1,
	|	ДвиженияКК.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	ДвиженияКК.СуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Взаимозачет задолженности"" КАК Содержание
	|ИЗ  
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВзаимозачетЗадолженности КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|		
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.ДвиженияКонтрагентКонтрагент КАК ДвиженияКК
	|	ПО 
	|		Операция.Ссылка = ДвиженияКК.Регистратор
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		втУчетнаяПолитика КАК УчетнаяПолитикаОрганизаций
	|	ПО 
	|		ДвиженияКК.Регистратор = УчетнаяПолитикаОрганизаций.Ссылка
	|		И ДвиженияКК.Организация.ГоловнаяОрганизация = УчетнаяПолитикаОрганизаций.Организация.ГоловнаяОрганизация
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Константы КАК Константы
	|	ПО
	|		ИСТИНА
	|ГДЕ
	|	ДвиженияКК.Организация.ГоловнаяОрганизация <> ЕСТЬNULL(ДвиженияКК.Контрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|	И ДвиженияКК.Организация.ГоловнаяОрганизация <> ЕСТЬNULL(ДвиженияКК.КорКонтрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|	И ДвиженияКК.ТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И ДвиженияКК.КорТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.УчетнаяПолитика.ВзаимозачетЧерезСчет76, ЛОЖЬ)
	|";
	
#КонецОбласти

	ТекстыОтражения = Новый Массив;
	ТекстыОтражения.Добавить(ТекстВзаимозачетаСФилиалами);
	ТекстыОтражения.Добавить(ТекстВзаимозачетаЧерез76);
	ТекстыОтражения.Добавить(ТекстВзаимозачетаНапрямую);
	
	Возврат СтрСоединить(ТекстыОтражения, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
	//-- Локализация
	Возврат "";
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц,
// необходимых для отражения в регламентированном учете
//
// Возвращаемое значение:
//   Строка - сформированный текст запроса.
//
Функция ТекстЗапросаВТОтраженияВРеглУчете() Экспорт
	
	//++ Локализация
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ВсеДокументы.Ссылка КАК Ссылка,
	|	ВсеДокументы.Организация КАК Организация,
	|	ВсеДокументы.Дата КАК Дата
	|ПОМЕСТИТЬ втДокументы
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВзаимозачетЗадолженности КАК ВсеДокументы
	|	ПО ДокументыКОтражению.Ссылка = ВсеДокументы.Ссылка
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ВсеДокументы.Ссылка,
	|	ВсеДокументы.КонтрагентДебитор,
	|	ВсеДокументы.Дата
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВзаимозачетЗадолженности КАК ВсеДокументы
	|	ПО ДокументыКОтражению.Ссылка = ВсеДокументы.Ссылка
	|	И ТИПЗНАЧЕНИЯ(ВсеДокументы.КонтрагентДебитор) = ТИП(Справочник.Организации)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ВсеДокументы.Ссылка,
	|	ВсеДокументы.КонтрагентКредитор,
	|	ВсеДокументы.Дата
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		Документ.ВзаимозачетЗадолженности КАК ВсеДокументы
	|	ПО 
	|		ДокументыКОтражению.Ссылка = ВсеДокументы.Ссылка
	|		И ТИПЗНАЧЕНИЯ(ВсеДокументы.КонтрагентКредитор) = ТИП(Справочник.Организации)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ВсеДокументы.Ссылка,
	|	ВсеДокументы.ОрганизацияКредитор,
	|	ВсеДокументы.Дата
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		Документ.ВзаимозачетЗадолженности КАК ВсеДокументы
	|	ПО 
	|		ДокументыКОтражению.Ссылка = ВсеДокументы.Ссылка
	|		И ВсеДокументы.ОрганизацияКредитор <> ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втДокументы.Ссылка,
	|	втДокументы.Организация,
	|	МАКСИМУМ(УчетнаяПолитикаОрганизаций.Период) КАК Период
	|ПОМЕСТИТЬ втПериодыУчетнойПолитики
	|ИЗ
	|	втДокументы КАК втДокументы
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО 
	|		втДокументы.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И втДокументы.Дата >= УчетнаяПолитикаОрганизаций.Период
	|
	|СГРУППИРОВАТЬ ПО
	|	втДокументы.Ссылка,
	|	втДокументы.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	втДокументы.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втДокументы.Ссылка КАК Ссылка,
	|	втДокументы.Организация КАК Организация,
	|	ЕСТЬNULL(УчетнаяПолитикаОрганизаций.УчетнаяПолитика, ЗНАЧЕНИЕ(Справочник.УчетныеПолитикиОрганизаций.ПустаяСсылка)) КАК УчетнаяПолитика
	|	
	|ПОМЕСТИТЬ втУчетнаяПолитика
	|ИЗ
	|	втДокументы КАК втДокументы
	|	ЛЕВОЕ СОЕДИНЕНИЕ втПериодыУчетнойПолитики КАК ПериодыУчетнойПолитики
	|	ПО 
	|		втДокументы.Ссылка = ПериодыУчетнойПолитики.Ссылка
	|		И втДокументы.Организация = ПериодыУчетнойПолитики.Организация
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		ПериодыУчетнойПолитики.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И ПериодыУчетнойПолитики.Период = УчетнаяПолитикаОрганизаций.Период
	|		
	|ИНДЕКСИРОВАТЬ ПО
	|	втДокументы.Ссылка,
	|	втДокументы.Организация"
	+"
	|;
	|";
	
	Возврат ТекстЗапроса;
	
	//-- Локализация
	Возврат "";
	
КонецФункции

//++ Локализация

// Функция возвращает текст запроса для отражения взаимозачета между филиалами.
// Проводки вида Дт 6Х.ХХ :: Кт 79.02, Дт 79.02 :: Кт 6Х.ХХ.
//
// Параметры:
//  ИмяДокумента - Строка - Имя документа для которого необходимо сформировать запрос получения проводок.
//
// Возвращаемое значение:
//	Строка - Текст запроса
//
Функция ТекстВзаимозачетаСФилиалами(ИмяДокумента = "") Экспорт
	
	ТекстЗапроса =
	"
	|ВЫБРАТЬ // ВзаимозачетСФилиалами (Дт 6Х.ХХ :: Кт 79.02), (Дт 79.02 :: Кт 6Х.ХХ)
	|	ДвиженияКК.Регистратор КАК Ссылка,
	|	ДвиженияКК.Период,
	|	ДвиженияКК.Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ДвиженияКК.СуммаРегл КАК Сумма,	
	|	ДвиженияКК.Сумма	 КАК СуммаУУ,
	|	
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.КорКонтрагент.ГоловнаяОрганизация
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансВыданный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансПолученный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыПолученные)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|		КОГДА ДвиженияКК.КорТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгКлиента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСКлиентами)
	|	КОНЕЦ КАК ВидСчетаДт,
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация <> ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Организация, ДвиженияКК.Организация)
	|			И НЕ (ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя ЕСТЬ NULL)
	|		ТОГДА ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ДвиженияКК.КорВалютаВзаиморасчетов КАК ВалютаДт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеДт,
	|	ЕСТЬNULL(ДвиженияКК.КорОбъектРасчетов.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.КорКонтрагент.ГоловнаяОрганизация
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоТекущимОперациям)
	|		ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|	КОНЕЦ КАК СчетДт,
	|	
	|	ДвиженияКК.КорКонтрагент КАК СубконтоДт1,
	|	ДвиженияКК.КорДоговор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	ДвиженияКК.КорСуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.Контрагент.ГоловнаяОрганизация
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансВыданный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.АвансПолученный)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыПолученные)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|		КОГДА ДвиженияКК.ТипСуммы = ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ДолгКлиента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСКлиентами)
	|	КОНЕЦ КАК ВидСчетаКт,
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация <> ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.Организация, ДвиженияКК.Организация)
	|			И НЕ (ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя ЕСТЬ NULL)
	|		ТОГДА ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчетаПолучателя, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаРасчетов.ПустаяСсылка))
	|	КОНЕЦ КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	ДвиженияКК.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеКт,
	|	ЕСТЬNULL(ДвиженияКК.ОбъектРасчетов.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиКт,
	|
	|	ВЫБОР
	|		КОГДА ДвиженияКК.Организация.ГоловнаяОрганизация = ДвиженияКК.Контрагент.ГоловнаяОрганизация
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоТекущимОперациям)
	|		ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|	КОНЕЦ КАК СчетКт,
	|	
	|	ДвиженияКК.Контрагент КАК СубконтоКт1,
	|	ДвиженияКК.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	ДвиженияКК.СуммаВВалютеВзаиморасчетов КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Взаимозачет задолженности с филиалом"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВзаимозачетЗадолженности КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|		
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.ДвиженияКонтрагентКонтрагент КАК ДвиженияКК
	|	ПО 
	|		Операция.Ссылка = ДвиженияКК.Регистратор
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		Константы КАК Константы
	|	ПО
	|		ИСТИНА
	|ГДЕ
	|	(ДвиженияКК.Организация.ГоловнаяОрганизация = ЕСТЬNULL(ДвиженияКК.Контрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО)
	|		ИЛИ ДвиженияКК.Организация.ГоловнаяОрганизация = ЕСТЬNULL(ДвиженияКК.КорКонтрагент.ГоловнаяОрганизация, НЕОПРЕДЕЛЕНО))
	|	И ДвиженияКК.ТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|	И ДвиженияКК.КорТипСуммы <> ЗНАЧЕНИЕ(Перечисление.ТипыСуммЗадолженности.ПустаяСсылка)
	|";
	
	Если НЕ ПустаяСтрока(ИмяДокумента) Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВзаимозачетЗадолженности", ИмяДокумента);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

//-- Локализация

#КонецОбласти
//-- НЕ УТ

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Проведение

// Процедура дополняет тексты запросов проведения документа.
//
// Параметры:
//  Запрос - Запрос - Общий запрос проведения документа.
//  ТекстыЗапроса - СписокЗначений - Список текстов запроса проведения.
//  Регистры - Строка, Структура - Список регистров проведения документа через запятую или в ключах структуры.
//
Процедура ДополнитьТекстыЗапросовПроведения(Запрос, ТекстыЗапроса, Регистры) Экспорт
	
	//++ Локализация
	//++ НЕ УТ
	ТекстЗапросаТаблицаКУДиР(Запрос, ТекстыЗапроса, Регистры);
	ТекстЗапросаТаблицаОтражениеДокументовВРеглУчете(Запрос, ТекстыЗапроса, Регистры);
	//-- НЕ УТ
	//-- Локализация
	
КонецПроцедуры
//++ Локализация
//++ НЕ УТ

Функция ТекстЗапросаТаблицаКУДиР(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "КнигаУчетаДоходовИРасходов";
	
	Если НЕ ПроведениеСерверУТ.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли; 
	
	Документы.ВзаимозачетЗадолженности.ИнициализироватьВтДебиторскаяКредиторскаяЗадолженность(Запрос);
	Документы.ВзаимозачетЗадолженности.УстановитьПараметрыЗапросаКоэффициентыВалют(Запрос);
	ОрганизацииНаУСН = УчетнаяПолитикаПереопределяемый.ОрганизацииНаУСНЗаПериод(НачалоМесяца(Запрос.Параметры.Период), КонецМесяца(Запрос.Параметры.Период));
	Запрос.УстановитьПараметр("ОрганизацииНаУСН", ОрганизацииНаУСН);
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	&Период КАК Период,
	|	&Ссылка КАК Регистратор,
	|	Задолженность.Организация КАК Организация,
	|	&Ссылка КАК ДокументВозникновенияДоходовРасходов,
	|	СУММА(ВЫБОР КОГДА Задолженность.ВалютаВзаиморасчетов = &ВалютаРегламентированногоУчета
	|		ТОГДА Задолженность.СуммаВзаиморасчетов
	|		ИНАЧЕ ВЫРАЗИТЬ(Задолженность.Сумма * &КоэффициентПересчетаВВалютуРегл КАК ЧИСЛО(31,2))
	|	КОНЕЦ) КАК Графа4,
	|	СУММА(ВЫБОР КОГДА Задолженность.ВалютаВзаиморасчетов = &ВалютаРегламентированногоУчета
	|		ТОГДА Задолженность.СуммаВзаиморасчетов
	|		ИНАЧЕ ВЫРАЗИТЬ(Задолженность.Сумма * &КоэффициентПересчетаВВалютуРегл КАК ЧИСЛО(31,2))
	|	КОНЕЦ) КАК Графа5,
	|	0 КАК Графа6,
	|	0 КАК Графа7,
	|	0 КАК НДС,
	|	0 КАК ДоходЕНВД,
	|	&РеквизитыПервичногоДокумента КАК РеквизитыПервичногоДокумента,
	|	&Содержание КАК Содержание
	|	
	|ИЗ
	|	ВтДебиторскаяЗадолженность КАК Задолженность
	|
	|ГДЕ
	|	Задолженность.Организация В (&ОрганизацииНаУСН)
	|	И &ТипДебитора <> &ТипКредитора
	|
	|СГРУППИРОВАТЬ ПО
	|	Задолженность.Организация
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период КАК Период,
	|	&Ссылка КАК Регистратор,
	|	&КонтрагентДебитор КАК Организация,
	|	&Ссылка КАК ДокументВозникновенияДоходовРасходов,
	|	СУММА(ВЫБОР КОГДА Задолженность.ВалютаВзаиморасчетов = &ВалютаРегламентированногоУчета
	|		ТОГДА Задолженность.СуммаВзаиморасчетов
	|		ИНАЧЕ ВЫРАЗИТЬ(Задолженность.Сумма * &КоэффициентПересчетаВВалютуРегл КАК ЧИСЛО(31,2))
	|	КОНЕЦ) КАК Графа4,
	|	СУММА(ВЫБОР КОГДА Задолженность.ВалютаВзаиморасчетов = &ВалютаРегламентированногоУчета
	|		ТОГДА Задолженность.СуммаВзаиморасчетов
	|		ИНАЧЕ ВЫРАЗИТЬ(Задолженность.Сумма * &КоэффициентПересчетаВВалютуРегл КАК ЧИСЛО(31,2))
	|	КОНЕЦ) КАК Графа5,
	|	0 КАК Графа6,
	|	0 КАК Графа7,
	|	0 КАК НДС,
	|	0 КАК ДоходЕНВД,
	|	&РеквизитыПервичногоДокумента КАК РеквизитыПервичногоДокумента,
	|	&Содержание КАК Содержание
	|	
	|ИЗ
	|	ВтКредиторскаяЗадолженность КАК Задолженность
	|
	|ГДЕ
	|	&РасчетыМеждуОрганизациямиДебитор
	|	И &КонтрагентДебитор В (&ОрганизацииНаУСН)
	|	И &ТипДебитора <> &ТипКредитора
	|
	|СГРУППИРОВАТЬ ПО
	|	Задолженность.Организация";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции
Функция ТекстЗапросаТаблицаОтражениеДокументовВРеглУчете(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ОтражениеДокументовВРеглУчете";
	
	Если Не ПроведениеСерверУТ.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	Документы.ВзаимозачетЗадолженности.ИнициализироватьВтДебиторскаяКредиторскаяЗадолженность(Запрос);
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	&Период      КАК Период,
	|	&Организация КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	&Период            КАК Период,
	|	&КонтрагентДебитор КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|ГДЕ
	|	&РасчетыМеждуОрганизациямиДебитор
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	&Период             КАК Период,
	|	&КонтрагентКредитор КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|ГДЕ
	|	&РасчетыМеждуОрганизациямиКредитор
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	&Период                              КАК Период,
	|	ДебиторскаяЗадолженность.Организация КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|ИЗ
	|	ВтДебиторскаяЗадолженность КАК ДебиторскаяЗадолженность
	|ГДЕ
	|	ДебиторскаяЗадолженность.Организация <> &Организация
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	&Период                               КАК Период,
	|	КредиторскаяЗадолженность.Организация КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|ИЗ
	|	ВтКредиторскаяЗадолженность КАК КредиторскаяЗадолженность
	|ГДЕ
	|	КредиторскаяЗадолженность.Организация <> &Организация";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	
	Возврат ТекстЗапроса;
	
КонецФункции
//-- НЕ УТ
//-- Локализация

#КонецОбласти

#КонецОбласти
