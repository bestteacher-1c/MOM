
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт
	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Владелец)";
КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// Формирует таблицу с составом семьи.
// Члены семьи упорядочиваются по коду степени родства и возрасту и отделяются переносом строки.
//
// Параметры:
//  ФизическоеЛицо	 - СправочникСсылка.ФизическиеЛица - человек, состав семьи которого формируется.
// 
// Возвращаемое значение:
//  ТаблицаЗначений - таблица с колонками
//		Ссылка - СправочникСсылка.РодственникиФизическихЛиц - ссылка на члена семьи,
//		Наименование - Строка - наименование элемента справочника родственников,
//		СтепеньРодства - СправочникСсылка.СтепениРодстваФизическихЛиц - степени родства физических лиц,
//		ДатаРождения - Дата - дата рождения родственника,
//		НаИждивении - Булево - признак того, что родственник находится на иждивении,
//		СкрыватьВТ2 - Булево - признак того, что родственник скрывается из формы Т-2.
//
Функция СоставСемьи(ФизическоеЛицо) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ФизическоеЛицо", ФизическоеЛицо);
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РодственникиФизическихЛиц.Ссылка КАК Ссылка,
		|	РодственникиФизическихЛиц.Наименование КАК Наименование,
		|	РодственникиФизическихЛиц.СтепеньРодства КАК СтепеньРодства,
		|	РодственникиФизическихЛиц.ДатаРождения КАК ДатаРождения,
		|	РодственникиФизическихЛиц.НаИждивении КАК НаИждивении,
		|	РодственникиФизическихЛиц.СкрыватьВТ2 КАК СкрыватьВТ2,
		|	РодственникиФизическихЛиц.СтепеньРодства.Код КАК СтепеньРодстваКод
		|ИЗ
		|	Справочник.РодственникиФизическихЛиц КАК РодственникиФизическихЛиц
		|ГДЕ
		|	РодственникиФизическихЛиц.Владелец = &ФизическоеЛицо
		|	И НЕ РодственникиФизическихЛиц.ПометкаУдаления
		|
		|УПОРЯДОЧИТЬ ПО
		|	СтепеньРодстваКод";
	Возврат Запрос.Выполнить().Выгрузить();
	
КонецФункции

// Формирует строку с представлением состава семьи.
//
// Параметры:
//  ФизическоеЛицо	 - СправочникСсылка.ФизическиеЛица - человек, состав семьи которого формируется.
//  ВключатьСкрытыхИзТ2	 - Булево - необязательный, по умолчанию Ложь.
//		Если установлено, то состав семьи будет сформирован с учетом лиц, скрываемых из формы Т-2.
// 
// Возвращаемое значение:
//  Строка - представление состава семьи.
//
// Пример:
//	Муж: Виктор, 51 год
//	Сын: Орлов Александр, 29 лет
//	Дочь: Орлова Мария, 26 лет
//
Функция ПредставлениеСоставаСемьи(ФизическоеЛицо, ВключатьСкрытыхИзТ2 = Ложь) Экспорт
	
	Представление = "";
	
	СоставСемьи = СоставСемьи(ФизическоеЛицо);
	Для Каждого ЧленСемьи Из СоставСемьи Цикл
		Если Не ВключатьСкрытыхИзТ2 И ЧленСемьи.СкрыватьВТ2 Тогда
			Продолжить;
		КонецЕсли;
		Если Не ПустаяСтрока(Представление) Тогда
			Представление = Представление + Символы.ПС;
		КонецЕсли;
		Если ЗначениеЗаполнено(ЧленСемьи.СтепеньРодства) Тогда
			Представление = Представление + Строка(ЧленСемьи.СтепеньРодства) + ": ";
		КонецЕсли;
		Представление = Представление + СокрЛП(Строка(ЧленСемьи.Наименование));
		Если ЗначениеЗаполнено(ЧленСемьи.ДатаРождения) Тогда
			Представление = Представление + ", " + ФизическиеЛицаЗарплатаКадры.ПредставлениеВозраста(ЧленСемьи.ДатаРождения);
		КонецЕсли;
	КонецЦикла;
	
	Возврат Представление;
	
КонецФункции

#КонецОбласти

#КонецЕсли
