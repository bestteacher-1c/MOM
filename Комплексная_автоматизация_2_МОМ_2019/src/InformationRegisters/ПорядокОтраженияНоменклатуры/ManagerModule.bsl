#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Организация)";

КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Возвращает результат выполнения анализатора отражения номенклатуры с настроенными счетами.
//	
//	Параметры:
//		МассивОрганизаций - Массив - СправочникСсылка.Организации - отбор по организациям;
//		Период - СтандартныйПериод - период с датой начала и окончания анализа.
//	ВозвращаемоеЗначение:
//		РезультатЗапроса - список всех операций, удовлетворяющий входным параметрам с настроенными для них счетами.
//
Функция РезультатЗапросаПоНастройкамОтраженияВУчете(МассивОрганизаций, Период) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запрос = Новый Запрос;
	ПараметрыАнализатора = Новый Структура("МассивОрганизаций, НачалоПериода, КонецПериода", МассивОрганизаций, Период.ДатаНачала, Период.ДатаОкончания);
	Запрос.МенеджерВременныхТаблиц = ВременнаяТаблицаДанныхПоСуществующимОперациям(ПараметрыАнализатора);
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ДвиженияНоменклатуры.Организация КАК Организация,
	|	ДвиженияНоменклатуры.Склад КАК Склад,
	|	ДвиженияНоменклатуры.ГруппаФинансовогоУчета КАК ГруппаФинансовогоУчета,
	|
	|	ДвиженияНоменклатуры.ЕстьСобственныеТовары КАК ЕстьСобственныеТовары,
	|	ДвиженияНоменклатуры.ЕстьРеализацияБезПереходаПраваСобственности КАК ЕстьРеализацияБезПереходаПраваСобственности,
	|	ДвиженияНоменклатуры.ЕстьПродажаСобственныхТоваров КАК ЕстьПродажаСобственныхТоваров,
	|	ДвиженияНоменклатуры.ЕстьПродажаУслуг КАК ЕстьПродажаУслуг,
	|	ДвиженияНоменклатуры.ЕстьПродажаСНДС КАК ЕстьПродажаСНДС,
	|	ДвиженияНоменклатуры.ЕстьПродажаЕНВД КАК ЕстьПродажаЕНВД,
	|	
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаНаСкладе
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаНаСкладе
	|	КОНЕЦ КАК СчетУчетаНаСкладе,
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаНаСкладе, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаНаСкладеПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаВПути
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаВПути
	|	КОНЕЦ КАК СчетУчетаВПути,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаВПутиПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаВыручкиОтПродаж
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродаж
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродаж,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродажПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаСебестоимостиПродаж
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродаж
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродаж,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродажПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродажЕНВД
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродажЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродажЕНВД
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродажЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаНДСПриПродаже
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаНДСПриПродаже
	|	КОНЕЦ КАК СчетУчетаНДСПриПродаже,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаНДСПриПродаже, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаНДСПриПродажеПоУмолчанию,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаНДСВПути
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаНДСВПути
	|	КОНЕЦ КАК СчетУчетаНДСВПути,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаНДСВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаНДСВПутиПоУмолчанию,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ПорядокОтражения.СтатьяДоходовОСНО
	|		ИНАЧЕ ГруппыФинансовогоУчета.СтатьяДоходовОСНО
	|	КОНЕЦ КАК СтатьяДоходовОСНО,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО, &ПустаяСтатья) = &ПустаяСтатья
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СтатьяДоходовОСНО, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СтатьяДоходовОСНОПоУмолчанию,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ПорядокОтражения.СтатьяДоходовЕНВД
	|		ИНАЧЕ ГруппыФинансовогоУчета.СтатьяДоходовЕНВД
	|	КОНЕЦ КАК СтатьяДоходовЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД, &ПустаяСтатья) = &ПустаяСтатья
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СтатьяДоходовЕНВД, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СтатьяДоходовЕНВДПоУмолчанию
	|
	|ИЗ
	|	ДвиженияНоменклатуры КАК ДвиженияНоменклатуры
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ПорядокОтраженияНоменклатуры КАК ПорядокОтражения
	|	ПО
	|		ДвиженияНоменклатуры.Организация = ПорядокОтражения.Организация
	|		И ДвиженияНоменклатуры.Склад = ПорядокОтражения.Склад
	|		И ДвиженияНоменклатуры.ГруппаФинансовогоУчета = ПорядокОтражения.ГруппаФинансовогоУчета
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ГруппыФинансовогоУчетаНоменклатуры КАК ГруппыФинансовогоУчета
	|	ПО
	|		ДвиженияНоменклатуры.ГруппаФинансовогоУчета = ГруппыФинансовогоУчета.Ссылка
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПорядокОтражения.Организация КАК Организация,
	|	ПорядокОтражения.Склад КАК Склад,
	|	ПорядокОтражения.ГруппаФинансовогоУчета КАК ГруппаФинансовогоУчета,
	|
	|	ЛОЖЬ КАК ЕстьСобственныеТовары,
	|	ЛОЖЬ КАК ЕстьРеализацияБезПереходаПраваСобственности,
	|	ЛОЖЬ КАК ЕстьПродажаСобственныхТоваров,
	|	ЛОЖЬ КАК ЕстьПродажаУслуг,
	|	ЛОЖЬ КАК ЕстьПродажаСНДС,
	|	ЛОЖЬ КАК ЕстьПродажаЕНВД,
	|	
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаНаСкладе
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаНаСкладе
	|	КОНЕЦ КАК СчетУчетаНаСкладе,
	|	ВЫБОР 
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаНаСкладе, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаНаСкладеПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаВПути
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаВПути
	|	КОНЕЦ КАК СчетУчетаВПути,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаВПутиПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаВыручкиОтПродаж
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродаж
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродаж,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродажПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаСебестоимостиПродаж
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродаж
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродаж,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродаж, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродажПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродажЕНВД
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродажЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродажЕНВД
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродажЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаНДСПриПродаже
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаНДСПриПродаже
	|	КОНЕЦ КАК СчетУчетаНДСПриПродаже,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаНДСПриПродаже, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаНДСПриПродажеПоУмолчанию,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ПорядокОтражения.СчетУчетаНДСВПути
	|		ИНАЧЕ ГруппыФинансовогоУчета.СчетУчетаНДСВПути
	|	КОНЕЦ КАК СчетУчетаНДСВПути,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет) = &ПустойСчет
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СчетУчетаНДСВПути, &ПустойСчет) <> &ПустойСчет
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СчетУчетаНДСВПутиПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ПорядокОтражения.СтатьяДоходовОСНО
	|		ИНАЧЕ ГруппыФинансовогоУчета.СтатьяДоходовОСНО
	|	КОНЕЦ КАК СтатьяДоходовОСНО,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО, &ПустаяСтатья) = &ПустаяСтатья
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СтатьяДоходовОСНО, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СтатьяДоходовОСНОПоУмолчанию,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ПорядокОтражения.СтатьяДоходовЕНВД
	|		ИНАЧЕ ГруппыФинансовогоУчета.СтатьяДоходовЕНВД
	|	КОНЕЦ КАК СтатьяДоходовЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД, &ПустаяСтатья) = &ПустаяСтатья
	|				И ЕСТЬNULL(ГруппыФинансовогоУчета.СтатьяДоходовЕНВД, &ПустаяСтатья) <> &ПустаяСтатья
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СтатьяДоходовЕНВДПоУмолчанию
	|
	|ИЗ
	|	РегистрСведений.ПорядокОтраженияНоменклатуры КАК ПорядокОтражения
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ДвиженияНоменклатуры КАК ДвиженияНоменклатуры
	|	ПО
	|		ПорядокОтражения.Организация = ДвиженияНоменклатуры.Организация
	|		И ПорядокОтражения.Склад = ДвиженияНоменклатуры.Склад
	|		И ПорядокОтражения.ГруппаФинансовогоУчета = ДвиженияНоменклатуры.ГруппаФинансовогоУчета
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ГруппыФинансовогоУчетаНоменклатуры КАК ГруппыФинансовогоУчета
	|	ПО
	|		ПорядокОтражения.ГруппаФинансовогоУчета = ГруппыФинансовогоУчета.Ссылка
	|	
	|ГДЕ
	|	ПорядокОтражения.Организация В (&Организации)
	|	И ДвиженияНоменклатуры.Организация ЕСТЬ NULL
	|	
	|УПОРЯДОЧИТЬ ПО
	|	Организация Возр,
	|	Склад Возр,
	|	ГруппаФинансовогоУчета ВОЗР";
	
	Запрос.УстановитьПараметр("ПустойСчет", ПланыСчетов.Хозрасчетный.ПустаяСсылка());
	Запрос.УстановитьПараметр("ПустаяСтатья", ПланыВидовХарактеристик.СтатьиДоходов.ПустаяСсылка());
		
	РезультатЗапроса = Запрос.Выполнить();
	
	Возврат РезультатЗапроса;
	
КонецФункции // РезультатЗапросаПоНастройкамОтраженияВУчете()

Функция ВременнаяТаблицаДанныхПоСуществующимОперациям(ПараметрыАнализатора)
	
	РежимАнализа = Неопределено;
	ПараметрыАнализатора.Свойство("РежимАнализа", РежимАнализа);
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеРегистра.Организация КАК Организация,
	|	ДанныеРегистра.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ДанныеРегистра.ВидЗапасов КАК ВидЗапасов,
	|	ДанныеРегистра.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути) КАК ЕстьРеализацияБезПереходаПраваСобственности
	|ПОМЕСТИТЬ ДвиженияРегистраСебестоимости
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК ДанныеРегистра
	|ГДЕ
	|	&УсловиеДляРегистра
	|	И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеРегистра.ТипЗапасов КАК ТипЗапасов,
	|	ДанныеРегистра.ВидЗапасов КАК ВидЗапасов,
	|	КлючиПартнеров.Организация КАК Организация,
	|	КлючиНоменклатуры.СкладскаяТерритория КАК Склад,
	|	КлючиНоменклатуры.Номенклатура КАК Номенклатура,
	|	ДанныеРегистра.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности) КАК ЕстьРеализацияБезПереходаПраваСобственности,
	|	ДанныеРегистра.НалогообложениеНДС В (&НалогообложениеСНДС) КАК ЕстьПродажаСНДС,
	|	ДанныеРегистра.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД) КАК ЕстьПродажаЕНВД,
	|	ДанныеРегистра.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД) КАК ЕстьПродажаОСНО
	|ПОМЕСТИТЬ ДвиженияРегистраВыручки
	|ИЗ РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК КлючиПартнеров
	|			ПО КлючиПартнеров.Ссылка = ДанныеРегистра.АналитикаУчетаПоПартнерам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КлючиНоменклатуры
	|			ПО КлючиНоменклатуры.Ссылка = ДанныеРегистра.АналитикаУчетаНоменклатуры
	|ГДЕ
	|	&ОрганизацияИзРегистраСведений_УсловиеДляРегистра
	|	И (КлючиНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|		ИЛИ КлючиНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеРегистра.ВидЗапасов.ТипЗапасов,
	|	ДанныеРегистра.ВидЗапасов,
	|	КлючиПартнеров.Организация,
	|	ДанныеРегистра.АналитикаУчетаНоменклатуры.СкладскаяТерритория КАК Склад,
	|	ДанныеРегистра.КорАналитикаУчетаНоменклатуры.Номенклатура,
	|	ИСТИНА КАК ЕстьРеализацияБезПереходаПраваСобственности,
	|	ДанныеРегистра.ВидДеятельностиНДС В (&НалогообложениеСНДС) КАК ЕстьПродажаСНДС,
	|	ДанныеРегистра.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД) КАК ЕстьПродажаЕНВД,
	|	ДанныеРегистра.ВидДеятельностиНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД) КАК ЕстьПродажаОСНО
	|ИЗ РегистрНакопления.СебестоимостьТоваров КАК ДанныеРегистра
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК КлючиПартнеров
	|			ПО КлючиПартнеров.Ссылка = ДанныеРегистра.АналитикаУчетаПоПартнерам
	|ГДЕ
	|	&ОрганизацияИзРегистраСведений_УсловиеДляРегистра
	|	И ДанныеРегистра.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И ДанныеРегистра.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|	И (ДанныеРегистра.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|		ИЛИ ДанныеРегистра.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияРегистраСебестоимости.Организация КАК Организация,
	|	Склады.Ссылка КАК Склад,
	|	ВЫБОР КОГДА НЕ &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета ТОГДА
	|		НоменклатураСпр.ГруппаФинансовогоУчета
	|	ИНАЧЕ
	|		ЕСТЬNULL(ВидыЗапасовСпр.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка))
	|	КОНЕЦ КАК ГруппаФинансовогоУчета,
	|	ИСТИНА КАК ЕстьСобственныеТовары,
	|	ДвиженияРегистраСебестоимости.ЕстьРеализацияБезПереходаПраваСобственности,
	|	ЛОЖЬ КАК ЕстьПродажаСобственныхТоваров,
	|	ЛОЖЬ КАК ЕстьПродажаУслуг,
	|	ЛОЖЬ КАК ЕстьПродажаСНДС,
	|	ЛОЖЬ КАК ЕстьПродажаЕНВД,
	|	ЛОЖЬ КАК ЕстьПродажаОСНО
	|ПОМЕСТИТЬ ТаблицаДвиженийБезГруппировки
	|ИЗ ДвиженияРегистраСебестоимости КАК ДвиженияРегистраСебестоимости
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|			ПО Аналитика.Ссылка = ДвиженияРегистраСебестоимости.АналитикаУчетаНоменклатуры
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
	|			ПО Склады.Ссылка = Аналитика.МестоХранения
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК НоменклатураСпр
	|			ПО НоменклатураСпр.Ссылка = Аналитика.Номенклатура
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасовСпр
	|			ПО ВидыЗапасовСпр.Ссылка = ДвиженияРегистраСебестоимости.ВидЗапасов
	|
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияРегистраВыручки.Организация,
	|	ВЫБОР КОГДА ДвиженияРегистраВыручки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга) ТОГДА
	|		ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка)
	|	ИНАЧЕ
	|		ЕСТЬNULL(ДвиженияРегистраВыручки.Склад, ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка))
	|	КОНЕЦ КАК Склад,
	|	ВЫБОР КОГДА НЕ &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|		ИЛИ ДвиженияРегистраВыручки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга)
	|	ТОГДА
	|		НоменклатураСпр.ГруппаФинансовогоУчета
	|	ИНАЧЕ
	|		ЕСТЬNULL(ВидыЗапасовСпр.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка))
	|	КОНЕЦ КАК ГруппаФинансовогоУчета,
	|	ДвиженияРегистраВыручки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.АгентскаяУслуга) КАК ЕстьСобственныеТовары,
	|	ДвиженияРегистраВыручки.ЕстьРеализацияБезПереходаПраваСобственности,
	|	ДвиженияРегистраВыручки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ИЛИ ДвиженияРегистраВыручки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.АгентскаяУслуга)
	|		ИЛИ НоменклатураСпр.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа) КАК ЕстьПродажаСобственныхТоваров, 
	|	ДвиженияРегистраВыручки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга) КАК ЕстьПродажаУслуг,	
	|	ДвиженияРегистраВыручки.ЕстьПродажаСНДС,
	|	ДвиженияРегистраВыручки.ЕстьПродажаЕНВД,
	|	ДвиженияРегистраВыручки.ЕстьПродажаОСНО
	|ИЗ ДвиженияРегистраВыручки КАК ДвиженияРегистраВыручки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК НоменклатураСпр
	|			ПО НоменклатураСпр.Ссылка = ДвиженияРегистраВыручки.Номенклатура
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасовСпр
	|			ПО ВидыЗапасовСпр.Ссылка = ДвиженияРегистраВыручки.ВидЗапасов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Склад КАК Склад,
	|	ВложенныйЗапрос.ГруппаФинансовогоУчета КАК ГруппаФинансовогоУчета,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьСобственныеТовары) КАК ЕстьСобственныеТовары,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьРеализацияБезПереходаПраваСобственности) КАК ЕстьРеализацияБезПереходаПраваСобственности,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьПродажаСобственныхТоваров) КАК ЕстьПродажаСобственныхТоваров,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьПродажаУслуг) КАК ЕстьПродажаУслуг,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьПродажаСНДС) КАК ЕстьПродажаСНДС,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьПродажаЕНВД) КАК ЕстьПродажаЕНВД,
	|	МАКСИМУМ(ВложенныйЗапрос.ЕстьПродажаОСНО) КАК ЕстьПродажаОСНО
	|ПОМЕСТИТЬ ТаблицаДвижений
	|ИЗ ТаблицаДвиженийБезГруппировки КАК ВложенныйЗапрос
	|	
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.Склад,
	|	ВложенныйЗапрос.ГруппаФинансовогоУчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|	УНИЧТОЖИТЬ ДвиженияРегистраСебестоимости
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|	УНИЧТОЖИТЬ ДвиженияРегистраВыручки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|	УНИЧТОЖИТЬ ТаблицаДвиженийБезГруппировки";
	
	НалогообложениеСНДС = Новый Массив;
	НалогообложениеСНДС.Добавить(Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС);
	НалогообложениеСНДС.Добавить(Перечисления.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя);
	НалогообложениеСНДС.Добавить(Перечисления.ТипыНалогообложенияНДС.РеализацияРаботУслугНаЭкспорт);
	НалогообложениеСНДС.Добавить(Перечисления.ТипыНалогообложенияНДС.ПродажаНаЭкспорт);
	НалогообложениеСНДС.Добавить(Перечисления.ТипыНалогообложенияНДС.ПроизводствоСДЦ);
	Запрос.УстановитьПараметр("НалогообложениеСНДС", НалогообложениеСНДС);
	Запрос.УстановитьПараметр("ФормироватьВидыЗапасовПоГруппамФинансовогоУчета",
		ПолучитьФункциональнуюОпцию("ФормироватьВидыЗапасовПоГруппамФинансовогоУчета"));
		
	УсловиеВхожденияВРегистр = "ГДЕ" + Символы.ПС + Символы.Таб + "&УсловиеДляРегистра";
	УсловиеВхожденияВРегистрССоединениемПоОрганизации = "ГДЕ" + Символы.ПС + Символы.Таб + "&ОрганизацияИзРегистраСведений_УсловиеДляРегистра";
	УсловиеВхожденияВДокумент = "ГДЕ" + Символы.ПС + Символы.Таб + "&УсловиеДляДокумента";
	ТекстСоединенияСТаблицейДокументов = "		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТаблицаДокументов КАК ТаблицаДокументов
	|		ПО ДанныеРегистра.Организация = ТаблицаДокументов.Организация
	|			И ДанныеРегистра.Регистратор = ТаблицаДокументов.Документ";
	ТекстУсловийПоОрганизацииИПериоду = "ГДЕ
	|	ДанныеРегистра.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
	|	И ДанныеРегистра.Организация В (&Организации)";
	
	Если РежимАнализа = "ПоНеотраженным" Тогда
		
		Статусы = Новый Массив;
		Статусы.Добавить(Перечисления.СтатусыОтраженияДокументовВРеглУчете.НеУказаныСчетаУчета);
		Статусы.Добавить(Перечисления.СтатусыОтраженияДокументовВРеглУчете.КОтражениюВРеглУчете);
		РегистрыСведений.ОтражениеДокументовВРеглУчете.ДобавитьВременнуюТаблицуДокументовСОтборомПоСтатусуОтражения(
			Запрос.МенеджерВременныхТаблиц,
			ПараметрыАнализатора.МассивОрганизаций,
			Статусы);
	
		ТекстУсловий = ТекстСоединенияСТаблицейДокументов;
		Запрос.Текст = СтрЗаменить(Запрос.Текст, УсловиеВхожденияВРегистр, ТекстУсловий);
		ТекстУсловий = СтрЗаменить(ТекстУсловий, "Регистратор", "Ссылка");
		ТекстУсловий = СтрЗаменить(ТекстУсловий, "ДанныеРегистра", "ДанныеДокумента");
		Запрос.Текст = СтрЗаменить(Запрос.Текст, УсловиеВхожденияВДокумент, ТекстУсловий);
		ТекстУсловий = ТекстСоединенияСТаблицейДокументов;
		ТекстУсловий = СтрЗаменить(ТекстУсловий, "ДанныеРегистра.Организация", "КлючиПартнеров.Организация");
		Запрос.Текст = СтрЗаменить(Запрос.Текст, УсловиеВхожденияВРегистрССоединениемПоОрганизации, ТекстУсловий);
	Иначе
		ТекстУсловий = ТекстУсловийПоОрганизацииИПериоду;
		Запрос.УстановитьПараметр("Организации", ПараметрыАнализатора.МассивОрганизаций);
		Запрос.УстановитьПараметр("ДатаНачала", ПараметрыАнализатора.НачалоПериода);
		Запрос.УстановитьПараметр("ДатаОкончания", ПараметрыАнализатора.КонецПериода);
		Запрос.Текст = СтрЗаменить(Запрос.Текст, УсловиеВхожденияВРегистр, ТекстУсловий);
		ТекстУсловий = СтрЗаменить(ТекстУсловий, "Период", "Дата");
		ТекстУсловий = СтрЗаменить(ТекстУсловий, "ДанныеРегистра", "ДанныеДокумента");
		ТекстУсловий = ТекстУсловий + "И ДанныеДокумента.Проведен" + Символы.ПС + Символы.Таб;
		Запрос.Текст = СтрЗаменить(Запрос.Текст, УсловиеВхожденияВДокумент, ТекстУсловий);
		ТекстУсловий = ТекстУсловийПоОрганизацииИПериоду;		
		ТекстУсловий = СтрЗаменить(ТекстУсловий, "ДанныеРегистра.Организация", "КлючиПартнеров.Организация");
		Запрос.Текст = СтрЗаменить(Запрос.Текст, УсловиеВхожденияВРегистрССоединениемПоОрганизации, ТекстУсловий);
	КонецЕсли;
		
	Запрос.Выполнить();
	
	Возврат Запрос.МенеджерВременныхТаблиц;
	
КонецФункции

Функция ВременнаяТаблицаДвиженийСоСчетами(ВременнаяТаблицаДвижений)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = ВременнаяТаблицаДвижений;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДвиженияНоменклатуры.Организация КАК Организация,
	|	ДвиженияНоменклатуры.Склад КАК МестоУчета,
	|	ДвиженияНоменклатуры.ГруппаФинансовогоУчета КАК АналитикаУчета,
	|	ДвиженияНоменклатуры.ЕстьСобственныеТовары КАК ЕстьСобственныеТовары,
	|	ДвиженияНоменклатуры.ЕстьРеализацияБезПереходаПраваСобственности КАК ЕстьРеализацияБезПереходаПраваСобственности,
	|	ДвиженияНоменклатуры.ЕстьПродажаСобственныхТоваров КАК ЕстьПродажаСобственныхТоваров,
	|	ДвиженияНоменклатуры.ЕстьПродажаУслуг КАК ЕстьПродажаУслуг,
	|	ДвиженияНоменклатуры.ЕстьПродажаСНДС КАК ЕстьПродажаСНДС,
	|	ДвиженияНоменклатуры.ЕстьПродажаЕНВД КАК ЕстьПродажаЕНВД,
	|	ДвиженияНоменклатуры.ЕстьПродажаОСНО КАК ЕстьПродажаОСНО,
	|
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаНаСкладе, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНаСкладе, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаНаСкладе КОНЕЦ КАК СчетУчетаНаСкладе,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаВПути, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВПути, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаВПути КОНЕЦ КАК СчетУчетаВПути,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаВыручкиОтПродаж, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВыручкиОтПродаж, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаВыручкиОтПродаж КОНЕЦ КАК СчетУчетаВыручкиОтПродаж,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаСебестоимостиПродаж, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаСебестоимостиПродаж, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаСебестоимостиПродаж КОНЕЦ КАК СчетУчетаСебестоимостиПродаж,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаВыручкиОтПродажЕНВД, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД КОНЕЦ КАК СчетУчетаВыручкиОтПродажЕНВД,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаСебестоимостиПродажЕНВД, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД КОНЕЦ КАК СчетУчетаСебестоимостиПродажЕНВД,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаНДСПриПродаже, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНДСПриПродаже, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаНДСПриПродаже КОНЕЦ КАК СчетУчетаНДСПриПродаже,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет) = &ПустойСчет
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СчетУчетаНДСВПути, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНДСВПути, &ПустойСчет))
	|		ИНАЧЕ ПорядокОтражения.СчетУчетаНДСВПути КОНЕЦ КАК СчетУчетаНДСВПути,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО, ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)) = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СтатьяДоходовОСНО, ЕСТЬNULL(ОбщаяНастройка.СтатьяДоходовОСНО, ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)))
	|		ИНАЧЕ ПорядокОтражения.СтатьяДоходовОСНО КОНЕЦ КАК СтатьяДоходовОСНО,
	|	ВЫБОР КОГДА ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД, ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)) = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)
	|		ТОГДА ЕСТЬNULL(АналитикаУчета.СтатьяДоходовЕНВД, ЕСТЬNULL(ОбщаяНастройка.СтатьяДоходовЕНВД, ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)))
	|		ИНАЧЕ ПорядокОтражения.СтатьяДоходовЕНВД КОНЕЦ КАК СтатьяДоходовЕНВД,
	|
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаНаСкладе, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНаСкладе, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаНаСкладе, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНаСкладе, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаНаСкладе, &ПустойСчет) = &ПустойСчет КАК СчетУчетаНаСкладеПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаВПути, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВПути, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаВПути, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВПути, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаВПути, &ПустойСчет) = &ПустойСчет КАК СчетУчетаВПутиПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаВыручкиОтПродаж, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВыручкиОтПродаж, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаВыручкиОтПродаж, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВыручкиОтПродаж, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродаж, &ПустойСчет) = &ПустойСчет КАК СчетУчетаВыручкиОтПродажПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаСебестоимостиПродаж, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаСебестоимостиПродаж, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаСебестоимостиПродаж, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаСебестоимостиПродаж, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродаж, &ПустойСчет) = &ПустойСчет КАК СчетУчетаСебестоимостиПродажПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаВыручкиОтПродажЕНВД, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаВыручкиОтПродажЕНВД, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаВыручкиОтПродажЕНВД, &ПустойСчет) = &ПустойСчет КАК СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаСебестоимостиПродажЕНВД, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаСебестоимостиПродажЕНВД, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаСебестоимостиПродажЕНВД, &ПустойСчет) = &ПустойСчет КАК СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаНДСПриПродаже, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНДСПриПродаже, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаНДСПриПродаже, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНДСПриПродаже, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСПриПродаже, &ПустойСчет) = &ПустойСчет КАК СчетУчетаНДСПриПродажеПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СчетУчетаНДСВПути, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНДСВПути, &ПустойСчет))
	|		= ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет)
	|		ИЛИ ЕСТЬNULL(АналитикаУчета.СчетУчетаНДСВПути, ЕСТЬNULL(ОбщаяНастройка.СчетУчетаНДСВПути, &ПустойСчет)) <> &ПустойСчет
	|		И ЕСТЬNULL(ПорядокОтражения.СчетУчетаНДСВПути, &ПустойСчет) = &ПустойСчет КАК СчетУчетаНДСВПутиПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СтатьяДоходовОСНО, ЕСТЬNULL(ОбщаяНастройка.СтатьяДоходовОСНО,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка))) = ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)) ИЛИ ЕСТЬNULL(АналитикаУчета.СтатьяДоходовОСНО,
	|		ЕСТЬNULL(ОбщаяНастройка.СтатьяДоходовОСНО, ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка))) <>
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) И ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовОСНО,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)) = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) КАК СтатьяДоходовОСНОПоУмолчанию,
	|	ЕСТЬNULL(АналитикаУчета.СтатьяДоходовЕНВД, ЕСТЬNULL(ОбщаяНастройка.СтатьяДоходовЕНВД,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка))) = ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)) ИЛИ ЕСТЬNULL(АналитикаУчета.СтатьяДоходовЕНВД,
	|		ЕСТЬNULL(ОбщаяНастройка.СтатьяДоходовЕНВД, ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка))) <>
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) И ЕСТЬNULL(ПорядокОтражения.СтатьяДоходовЕНВД,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)) = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) КАК СтатьяДоходовЕНВДПоУмолчанию
	|
	|ПОМЕСТИТЬ ТаблицаДвиженийСоСчетами
	|ИЗ
	|	ТаблицаДвижений КАК ДвиженияНоменклатуры
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОтраженияНоменклатуры КАК ПорядокОтражения
	|		ПО ДвиженияНоменклатуры.Организация = ПорядокОтражения.Организация
	|			И ДвиженияНоменклатуры.Склад = ПорядокОтражения.Склад
	|			И ДвиженияНоменклатуры.ГруппаФинансовогоУчета = ПорядокОтражения.ГруппаФинансовогоУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ГруппыФинансовогоУчетаНоменклатуры КАК АналитикаУчета
	|		ПО ДвиженияНоменклатуры.ГруппаФинансовогоУчета = АналитикаУчета.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОтраженияНоменклатуры КАК ОбщаяНастройка
	|		ПО ОбщаяНастройка.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			И ОбщаяНастройка.Склад = ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка)
	|			И ОбщаяНастройка.ГруппаФинансовогоУчета = ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)";
	
	Запрос.УстановитьПараметр("ПустойСчет", ПланыСчетов.Хозрасчетный.ПустаяСсылка());
	Запрос.Выполнить();
	
	Возврат Запрос.МенеджерВременныхТаблиц;
	
КонецФункции

// Выполняет анализ всех неотраженных операций отражения номенклатуры,
//	ищет для них ненастроенные счета учета и заносит эти данные в регистр ненастроенных счетов учета.
//	
//	ПараметрыАнализатора - Структура, содержащая следующие значения:
//			* МассивОрганизаций - Массив - СправочникСсылка.Организации - отбор по организациям, операции которых будут анализироваться;
//			* РежимАнализа - Строка - строка вида "ПоНеотраженным" -
//					необходимо для того, чтобы анализатор работал только по документам, неотраженным в регл. учете.
//
Процедура ЗаполнитьРегистрТребующихНастройкиНаОснованииАнализаНеотраженныхОпераций(ПараметрыАнализатора) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	ВременнаяТаблицаДвижений = ВременнаяТаблицаДанныхПоСуществующимОперациям(ПараметрыАнализатора);
	ВременнаяТаблицаДвиженийСоСчетами = ВременнаяТаблицаДвиженийСоСчетами(ВременнаяТаблицаДвижений);
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = ВременнаяТаблицаДвиженийСоСчетами;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НаСкладе) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.ЕстьСобственныеТовары
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаНаСкладе = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РеализацияБезПереходаПраваСобственности) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.ЕстьРеализацияБезПереходаПраваСобственности
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаВПути = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСПриОтгрузкеБезПереходаПраваСобственности) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.ЕстьРеализацияБезПереходаПраваСобственности
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСВПути = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ВыручкаОтПродаж) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	(ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров ИЛИ ДвиженияНоменклатурыСоСчетами.ЕстьПродажаУслуг)
	|	И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаОСНО
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродаж = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ВыручкаОтПродажЕНВД) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	(ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров ИЛИ ДвиженияНоменклатурыСоСчетами.ЕстьПродажаУслуг)
	|	И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаЕНВД
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродажЕНВД = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСПриПродаже) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСНДС
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСПриПродаже = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СебестоимостьПродаж) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаОСНО
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродаж = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СебестоимостьПродажЕНВД) КАК ВидСчета
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаЕНВД
	|	И ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродажЕНВД = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)";
	
	МассивРезультатов = Запрос.ВыполнитьПакет();
	
	СтруктураВидовСчетовИРезультатаЗапроса = Новый Соответствие;
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.НаСкладе, МассивРезультатов.Получить(0));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.РеализацияБезПереходаПраваСобственности, МассивРезультатов.Получить(1));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.НДСПриОтгрузкеБезПереходаПраваСобственности, МассивРезультатов.Получить(2));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.ВыручкаОтПродаж, МассивРезультатов.Получить(3));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.ВыручкаОтПродажЕНВД, МассивРезультатов.Получить(4));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.НДСПриПродаже, МассивРезультатов.Получить(5));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.СебестоимостьПродаж, МассивРезультатов.Получить(6));
	СтруктураВидовСчетовИРезультатаЗапроса.Вставить(Перечисления.ВидыСчетовРеглУчета.СебестоимостьПродажЕНВД, МассивРезультатов.Получить(7));
	
	ИмяСобытия = НСтр("ru = 'Анализ порядка отражения номенклатуры, требующего настройки'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка());
	РегистрыСведений.СчетаРеглУчетаТребующиеНастройки.ЗаполнитьЗаписиРегистраПоВидамСчетов(СтруктураВидовСчетовИРезультатаЗапроса, ИмяСобытия);

КонецПроцедуры

// Выполняет анализ операций отражения номенклатуры, в зависимости от параметров и дополняет исходную таблицу операций
// новыми строками.
//	
//	Параметры:
//		ПараметрыАнализа - Структура - содержит настройки анализатора со следующими свойствами:
//			* РежимАнализа - Строка - принимает значения вида "ПоНеотраженным" и "ЗаПериод". Причем если не задана, значение по умолчанию "ЗаПериод".
//			* КонецПериода - Дата - по эту дату анализируются операции, причем если режим анализа "ПоНеотраженным" не актуальна;
//			* НачалоПериода - Дата - начиная с этой даты анализируются операции, причем если режим анализа "ПоНеотраженным" не актуальна;
//			* МассивОрганизаций - Массив - СправочникСсылка.Организации - отбор по организациям, операции которых будут анализироваться;
//		АдресХранилища - Строка - адрес сохранения результата работы метода (ТаблицаЗначений).
//
Процедура ДополнитьТаблицуНаОснованииАнализаОпераций(ПараметрыАнализа, АдресХранилища) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	ВременнаяТаблицаДвижений = ВременнаяТаблицаДанныхПоСуществующимОперациям(ПараметрыАнализа);
	 
	ВременнаяТаблицаДвиженийСоСчетами = ВременнаяТаблицаДвиженийСоСчетами(ВременнаяТаблицаДвижений);
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Таблица", ПараметрыАнализа.ЗаполняемаяТаблица);
	Запрос.МенеджерВременныхТаблиц = ВременнаяТаблицаДвиженийСоСчетами;
	 
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ТекущаяТаблицаСчетовУчета.Организация,
	|	ТекущаяТаблицаСчетовУчета.Склад,
	|	ТекущаяТаблицаСчетовУчета.ГруппаФинансовогоУчета,
	|
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладе,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродаж,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродаж,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродаже,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВПути,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПути,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовОСНО,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовЕНВД,
	|
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладеПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродажеПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВПутиПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПутиПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовОСНОПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовЕНВДПоУмолчанию,
	|
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаНаСкладе,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаВыручкиОтПродаж,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаСебестоимостиПродаж,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаВыручкиОтПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаСебестоимостиПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаНДСПриПродаже,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаВПути,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаНДСВПути,
	|
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройка,
	|	ТекущаяТаблицаСчетовУчета.ИзмененныеДанные
	|
	|ПОМЕСТИТЬ ТекущаяТаблицаСчетовУчета
	|ИЗ
	|	&Таблица КАК ТекущаяТаблицаСчетовУчета;
	|
	|///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДвиженияНоменклатурыСоСчетами.Организация,
	|	ДвиженияНоменклатурыСоСчетами.МестоУчета КАК Склад,
	|	ДвиженияНоменклатурыСоСчетами.АналитикаУчета КАК ГруппаФинансовогоУчета,
	|
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладе, ДвиженияНоменклатурыСоСчетами.СчетУчетаНаСкладе) КАК СчетУчетаНаСкладе,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродаж, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродаж) КАК СчетУчетаВыручкиОтПродаж,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродаж, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродаж) КАК СчетУчетаСебестоимостиПродаж,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВД, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродажЕНВД) КАК СчетУчетаВыручкиОтПродажЕНВД,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВД, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродажЕНВД) КАК СчетУчетаСебестоимостиПродажЕНВД,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродаже, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСПриПродаже) КАК СчетУчетаНДСПриПродаже,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВПути, ДвиженияНоменклатурыСоСчетами.СчетУчетаВПути) КАК СчетУчетаВПути,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПути, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСВПути) КАК СчетУчетаНДСВПути,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СтатьяДоходовОСНО, ДвиженияНоменклатурыСоСчетами.СтатьяДоходовОСНО) КАК СтатьяДоходовОСНО,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СтатьяДоходовЕНВД, ДвиженияНоменклатурыСоСчетами.СтатьяДоходовЕНВД) КАК СтатьяДоходовЕНВД,
	|
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладеПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаНаСкладеПоУмолчанию) КАК СчетУчетаНаСкладеПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродажПоУмолчанию) КАК СчетУчетаВыручкиОтПродажПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродажПоУмолчанию) КАК СчетУчетаСебестоимостиПродажПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию) КАК СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию) КАК СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродажеПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСПриПродажеПоУмолчанию) КАК СчетУчетаНДСПриПродажеПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВПутиПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаВПутиПоУмолчанию) КАК СчетУчетаВПутиПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПутиПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСВПутиПоУмолчанию) КАК СчетУчетаНДСВПутиПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СтатьяДоходовОСНОПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СтатьяДоходовОСНОПоУмолчанию) КАК СтатьяДоходовОСНОПоУмолчанию,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СтатьяДоходовЕНВДПоУмолчанию, ДвиженияНоменклатурыСоСчетами.СтатьяДоходовЕНВДПоУмолчанию) КАК СтатьяДоходовЕНВДПоУмолчанию,
	|
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладе, ДвиженияНоменклатурыСоСчетами.СчетУчетаНаСкладе) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьСобственныеТовары КАК ТребуетсяНастройкаСчетУчетаНаСкладе,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродаж, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродаж) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И (ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров ИЛИ ДвиженияНоменклатурыСоСчетами.ЕстьПродажаУслуг) И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаОСНО КАК ТребуетсяНастройкаСчетУчетаВыручкиОтПродаж,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродаж, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродаж) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаОСНО КАК ТребуетсяНастройкаСчетУчетаСебестоимостиПродаж,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВД, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродажЕНВД) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И (ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров ИЛИ ДвиженияНоменклатурыСоСчетами.ЕстьПродажаУслуг) И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаЕНВД КАК ТребуетсяНастройкаСчетУчетаВыручкиОтПродажЕНВД,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВД, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродажЕНВД) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаЕНВД КАК ТребуетсяНастройкаСчетУчетаСебестоимостиПродажЕНВД,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродаже, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСПриПродаже) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСНДС КАК ТребуетсяНастройкаСчетУчетаНДСПриПродаже,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВПути, ДвиженияНоменклатурыСоСчетами.СчетУчетаВПути) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьРеализацияБезПереходаПраваСобственности КАК ТребуетсяНастройкаСчетУчетаВПути,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПути, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСВПути) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьРеализацияБезПереходаПраваСобственности КАК ТребуетсяНастройкаСчетУчетаНДСВПути,
	|
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладе, ДвиженияНоменклатурыСоСчетами.СчетУчетаНаСкладе) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьСобственныеТовары) ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВПути, ДвиженияНоменклатурыСоСчетами.СчетУчетаВПути) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьРеализацияБезПереходаПраваСобственности) ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПути, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСВПути) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьРеализацияБезПереходаПраваСобственности) ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродаж, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродаж) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И (ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров ИЛИ ДвиженияНоменклатурыСоСчетами.ЕстьПродажаУслуг)) И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаОСНО ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВД, ДвиженияНоменклатурыСоСчетами.СчетУчетаВыручкиОтПродажЕНВД) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И (ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров ИЛИ ДвиженияНоменклатурыСоСчетами.ЕстьПродажаУслуг)) И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаЕНВД ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродаже, ДвиженияНоменклатурыСоСчетами.СчетУчетаНДСПриПродаже) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСНДС) ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродаж, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродаж) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаОСНО) ИЛИ
	|	(ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВД, ДвиженияНоменклатурыСоСчетами.СчетУчетаСебестоимостиПродажЕНВД) = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|		И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаСобственныхТоваров И ДвиженияНоменклатурыСоСчетами.ЕстьПродажаЕНВД) КАК ТребуетсяНастройка,
	|	ЕСТЬNULL(ТекущаяТаблицаСчетовУчета.ИзмененныеДанные, ""СчетУчетаНаСкладе, СчетУчетаВыручкиОтПродаж, СчетУчетаСебестоимостиПродаж, СчетУчетаНДСПриПродаже, СчетУчетаВПути, СчетУчетаНДСВПути"") КАК ИзмененныеДанные
	|
	|ИЗ
	|	ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ТекущаяТаблицаСчетовУчета КАК ТекущаяТаблицаСчетовУчета
	|	ПО
	|		ДвиженияНоменклатурыСоСчетами.Организация = ТекущаяТаблицаСчетовУчета.Организация
	|		И ДвиженияНоменклатурыСоСчетами.МестоУчета = ТекущаяТаблицаСчетовУчета.Склад
	|		И ДвиженияНоменклатурыСоСчетами.АналитикаУчета = ТекущаяТаблицаСчетовУчета.ГруппаФинансовогоУчета
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ТекущаяТаблицаСчетовУчета.Организация,
	|	ТекущаяТаблицаСчетовУчета.Склад,
	|	ТекущаяТаблицаСчетовУчета.ГруппаФинансовогоУчета,
	|
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладе,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродаж,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродаж,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродаже,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВПути,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПути,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовОСНО,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовЕНВД,
	|
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНаСкладеПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВыручкиОтПродажЕНВДПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаСебестоимостиПродажЕНВДПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСПриПродажеПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаВПутиПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СчетУчетаНДСВПутиПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовОСНОПоУмолчанию,
	|	ТекущаяТаблицаСчетовУчета.СтатьяДоходовЕНВДПоУмолчанию,
	|
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаНаСкладе,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаВыручкиОтПродаж,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаСебестоимостиПродаж,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаВыручкиОтПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаСебестоимостиПродажЕНВД,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаНДСПриПродаже,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаВПути,
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройкаСчетУчетаНДСВПути,
	|
	|	ТекущаяТаблицаСчетовУчета.ТребуетсяНастройка,
	|	ТекущаяТаблицаСчетовУчета.ИзмененныеДанные
	|ИЗ
	|	ТекущаяТаблицаСчетовУчета КАК ТекущаяТаблицаСчетовУчета
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ТаблицаДвиженийСоСчетами КАК ДвиженияНоменклатурыСоСчетами
	|	ПО
	|		ТекущаяТаблицаСчетовУчета.Организация = ДвиженияНоменклатурыСоСчетами.Организация
	|		И ТекущаяТаблицаСчетовУчета.Склад = ДвиженияНоменклатурыСоСчетами.МестоУчета
	|		И ТекущаяТаблицаСчетовУчета.ГруппаФинансовогоУчета = ДвиженияНоменклатурыСоСчетами.АналитикаУчета
	|ГДЕ
	|	ДвиженияНоменклатурыСоСчетами.Организация ЕСТЬ NULL";
	
	Таблица = Запрос.Выполнить().Выгрузить();
	
	ПоместитьВоВременноеХранилище(Новый Структура("СчетаУчетаНоменклатуры", Таблица), АдресХранилища);
	
КонецПроцедуры

Процедура НайтиДокументыСоответствующиеНастройкам(ТаблицаНастроек, Дата, ТаблицаДокументов) Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запрос = Новый Запрос("
	|ВЫБРАТЬ
	|	ИсходнаяТаблица.Организация КАК Организация,
	|	ИсходнаяТаблица.Склад КАК Склад,
	|	ИсходнаяТаблица.ГруппаФинансовогоУчета КАК ГруппаФинансовогоУчета
	|
	|ПОМЕСТИТЬ ТаблицаНастроек
	|ИЗ
	|	&ИсходнаяТаблица КАК ИсходнаяТаблица
	|ГДЕ
	|	ИсходнаяТаблица.ИзмененныеДанные <> """"
	|;
	|/////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ТаблицаНастроек.Организация КАК Организация,
	|	Аналитика.КлючАналитики КАК АналитикаУчетаНоменклатуры
	|
	|ПОМЕСТИТЬ ВтАналитика
	|ИЗ
	|	РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ТаблицаНастроек КАК ТаблицаНастроек
	|	ПО
	|		Аналитика.МестоХранения = ТаблицаНастроек.Склад
	|		И Аналитика.Номенклатура.ГруппаФинансовогоУчета = ТаблицаНастроек.ГруппаФинансовогоУчета
	|;
	|/////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеРегистра.Регистратор КАК Документ,
	|	ОтражениеДокументовВРеглУчете.ДатаОтражения КАК ДатаОтражения,
	|	ОтражениеДокументовВРеглУчете.Организация КАК Организация
	|ИЗ
	|	РегистрНакопления.ТоварыОрганизаций.Обороты(, &ДатаОкончания, Регистратор,
	|		(Организация, АналитикаУчетаНоменклатуры) В (
	|			ВЫБРАТЬ
	|				Аналитика.Организация,
	|				Аналитика.АналитикаУчетаНоменклатуры
	|			ИЗ
	|				ВтАналитика КАК Аналитика
	|		)
	|	) КАК ДанныеРегистра
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ОтражениеДокументовВРеглУчете КАК ОтражениеДокументовВРеглУчете
	|	ПО
	|		ДанныеРегистра.Регистратор = ОтражениеДокументовВРеглУчете.Регистратор
	|		И ОтражениеДокументовВРеглУчете.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыОтраженияДокументовВРеглУчете.ОтраженоВРеглУчете)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеРегистра.Регистратор КАК Документ,
	|	ОтражениеДокументовВРеглУчете.ДатаОтражения КАК ДатаОтражения,
	|	ОтражениеДокументовВРеглУчете.Организация КАК Организация
	|ИЗ
	|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(, &ДатаОкончания, Регистратор,
	|		ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга)
	|		И (АналитикаУчетаПоПартнерам.Организация, АналитикаУчетаНоменклатуры) В (
	|			ВЫБРАТЬ
	|				Аналитика.Организация,
	|				Аналитика.АналитикаУчетаНоменклатуры
	|			ИЗ
	|				ВтАналитика КАК Аналитика
	|		)
	|	) КАК ДанныеРегистра
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ОтражениеДокументовВРеглУчете КАК ОтражениеДокументовВРеглУчете
	|	ПО
	|		ДанныеРегистра.Регистратор = ОтражениеДокументовВРеглУчете.Регистратор
	|		И ОтражениеДокументовВРеглУчете.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыОтраженияДокументовВРеглУчете.ОтраженоВРеглУчете)
	|
	|УПОРЯДОЧИТЬ ПО
	|	Документ
	|;");
	ИсходнаяТаблица = ТаблицаНастроек.Выгрузить(, "Организация, Склад, ГруппаФинансовогоУчета, ИзмененныеДанные");
	Запрос.УстановитьПараметр("ИсходнаяТаблица", ИсходнаяТаблица);
	Запрос.УстановитьПараметр("ДатаОкончания", Дата);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		НоваяСтрока = ТаблицаДокументов.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
		
	КонецЦикла;
	
КонецПроцедуры

#Область ОбновлениеИнформационнойБазы

#КонецОбласти

#КонецОбласти

#КонецЕсли
